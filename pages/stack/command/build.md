---
title: stack build
date: 2018/07/30
---

## stack build 時に良く利用するオプション

基本的には `--fast` と `--file-watch` を常用していることが多い

```shell
$ stack build --fast --file-watch
```

CI の設定では以下のように `--pedantic` を使ってチェックしています。(`pedantic` オプションを常時使っていると効率が悪いため、CIのみにしています)

```shell
$ stack buld --pedantic --fast
```

### オプションの簡単な説明

オプション | 説明
-----------|--------
`--fast` | 最適化を無効にする
`--file-watch` | ファイルの変更を検知して自動的に再ビルドする
`--pedantic` | GHCの警告をエラーとして報告する

## フラグの指定方法

あまり利用することが無いかもしれませんが、パッケージによってはフラグが指定されていることがあります。

基本的には以下の書式でフラグを有効化できます。

```shell
$ stack build --flag <package_name>:<flag_name>
```

## 並列ビルドについて

`stack` では自動的にビルドが並列化される (現在のCPUのコア数を自動的に設定する) ため、明示的に `-j` オプションを渡す必要はありません。(むしろ、現状は間違ったコア数を渡してしまうとパフォーマスに悪影響を及ぼすバグがあるため、現状は**非推奨**です。)

並列化オプションとして `-jN` が提供されていますが、以下のようにコア数を**抑制したい**場合にのみ、利用した方が良いでしょう。(`-j` はエラーになります)

### 並列化してビルド

```shell
$ stack build
```

### コア数1でビルド

```shell
$ stack build -j1
```

### stack.yaml に設定する方法

```yaml
# stack.yaml
jobs: 1
```