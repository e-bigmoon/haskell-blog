version: 2
jobs:
  build:
    working_directory: ~/haskell-blog
    docker:
      - image: fpco/stack-build
    steps:
      - checkout
      - restore_cache:
          key: cache
      - run:
          name: build when PR
          command: ./.circleci/build.hs
      - save_cache:
          key: cache
          paths:
            - ~/.stack/
            - .stack-work/
      - store_artifacts:
          path: _site
      - run:
          name: Send Artifacts URL to GitHub when PR
          command: ./.circleci/preview.hs