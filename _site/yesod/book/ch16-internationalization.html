<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">

  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
  <!-- MUST in hex format, may the same as header-color. This color is for android chrome browser. -->
  <meta name="theme-color" content="#5c6bc0">

  <!-- Metadata. -->
  <meta name="keywords" content="haskell,blog,bigmoon" />
  <title>国際化</title>
  <meta name="description" content="BIG MOON">
  <link rel="canonical" href="../../yesod/book/ch16-internationalization.html">
  <link rel="alternate" type="application/atom+xml" title="国際化" href="../../feed.xml" />
  <link rel="shortcut icon" href="../../images/favicon.ico" />
  <meta name="google-site-verification" content="X2YNboLvzw3_bclXLMvohyJDqj68D06_hPDMukRbgTs" />

  <!-- Stylesheets. -->
  <link rel="stylesheet" href="../../lib/materialize/css/materialize.min.css" />
  <link rel="stylesheet" href="../../css/main.css" />
  <link media="all" rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/3.3.92/css/materialdesignicons.min.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="../../lib/material-scrolltop/material-scrolltop.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />

  <!-- OGP -->
  <meta property="og:title" content="国際化" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="/yesod/book/ch16-internationalization.html" />
  <!-- <meta property="og:image" content=" サムネイル画像の URL" /> -->
  <meta property="og:site_name" content="国際化" />
  <meta property="og:description" content="BIG MOON" />

  <meta name="twitter:card" content="summary" />
  <!-- <meta name="twitter:site" content="@[ Twitter ID]" /> -->
  <!-- <meta name="twitter:player" content="@[ Twitter ID]" /> -->

  <noscript>
  <div class="notice-warning noscript">You don't have javascript enabled. Good luck! :(</div>
</noscript>

<!--[if IE]>
  <div class="notice-warning">Oh, you are using Internet Explorer! Good luck... :(</div>
<![endif]-->

</head>


  <body>
    <header class="site-header">
      <nav class="nav-extended indigo lighten-1">
        <div class="nav-wrapper">
  <a href="../../"><span class="site-title">BIGMOON Haskeller's BLOG</span></a>
  <a href="#" data-activates="mobile-navbar" class="button-collapse">
    <i class="mdi mdi-menu white-text"></i>
  </a>

  <ul id="nav-mobile" class="right hide-on-med-and-down">
    <li>
      <a href="../../" class="white-text">
        <i class="mdi mdi-home left indigo-text text-lighten-3"></i>
        Home
      </a>
    </li>
    <li>
      <a href="../../about.html" class="white-text">
        <i class="mdi mdi-account-circle left indigo-text text-lighten-3"></i>
        About
      </a>
    </li>
    <li>
      <a href="../../stack/" class="white-text">
        <i class="mdi mdi-wrench left indigo-text text-lighten-3"></i>
        Development
      </a>
    </li>
    <li>
      <a href="../../quiz/index.html" class="white-text">
        <i class="mdi mdi-comment-question-outline left indigo-text text-lighten-3"></i>
        Quiz
      </a>
    </li>
    <li>
      <a href="../../libraries/" class="white-text">
        <i class="mdi mdi-package-variant left indigo-text text-lighten-3"></i>
        Libraries
      </a>
    </li>
    <li>
      <a href="../../yesod/" class="white-text">
        <i class="mdi mdi-earth left indigo-text text-lighten-3"></i>
        Yesod
      </a>
    </li>
    <li>
      <a href="../../contact.html" class="white-text">
        <i class="mdi mdi-lead-pencil left indigo-text text-lighten-3"></i>
        Contact
      </a>
    </li>
    <li>
      <a href="../../feed.xml" class="white-text">
        <i class="mdi mdi-rss left indigo-text text-lighten-3"></i>
        Feed
      </a>
    </li>
  </ul>

  <ul class="side-nav" id="mobile-navbar">
    <li>
      <a href="../../" class="waves-effect waves-teal black-text">
        <i class="mdi mdi-home left green-text"></i>
        Home
      </a>
    </li>
    <li>
      <a href="../../about.html" class="navbar-text-colour-mobile">
        <i class="mdi mdi-account-circle left blue-text"></i>
        About
      </a>
    </li>
    <li>
      <a href="../../stack/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-wrench left blue-text"></i>
        Development
      </a>
    </li>
    <li>
      <a href="../../quiz/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-comment-question-outline left blue-text"></i>
        Quiz
      </a>
    </li>
    <li>
      <a href="../../libraries/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-package-variant left blue-text"></i>
        Libraries
      </a>
    </li>
    <li>
      <a href="../../yesod/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-earth left blue-text"></i>
        Yesod
      </a>
    </li>
    <li>
      <a href="../../contact.html" class="navbar-text-colour-mobile">
        <i class="mdi mdi-lead-pencil left blue-text"></i>
        Contact
      </a>
    </li>
  </ul>
</div>

      </nav>
    </header>

    <div class="site-container" id="tab-main">
      <div class="wrapper">
        <div class="post-ribbon"></div>

<div class="container page-container">
  <div class="post-page card-panel z-depth-2">
    <div class="post-section">
      <div class="post-heading">
        <h1 class="post-title">国際化</h1>
        
        <span>最終更新日: 2019/04/28</span>
        
      </div>

      <article class="page-content">
        <p>ユーザはソフトウェアが自国の言語に対応していることに期待しています。私たちにとっては都合が悪いことに、1つ以上の言語が関連しています。単に文字列を置換するだけであれば、それほど複雑ではありませんが、あらゆる文法の問題を適切に扱うことは難しい場合があります。結局のところ、プログラムの出力から ‘List 1 file(s)’ などという結果を誰が見たがるのでしょうか?</p>
<p>しかし、本当の i18n による解決策は、単に正しい出力を得るための方法を与える以上のことを必要とします。それは、この過程をプログラマと翻訳者にとって簡単で、できるだけエラーのないものにする必要があります。この問題に対する Yesod の答えは以下の通りです。</p>
<ul>
<li>リクエストヘッダに応じてユーザの求める言語を賢く推測し、上書きできること</li>
<li>Haskell の知識を必要としない、翻訳のための単純な構文であること (要するに、多くの翻訳者はプログラマではありません)</li>
<li>大部分の必要性をカバーするデフォルトの補助関数の選択とともに, 必要に応じて複雑な文法の問題に対しては、Haskell の最大限の力を利用可能なこと</li>
<li>語順は全く問題ありません</li>
</ul>
<h2 id="概要">概要</h2>
<pre class="text"><code>-- @messages/en.msg
Hello: Hello
EnterItemCount: I would like to buy:
Purchase: Purchase
ItemCount count@Int: You have purchased #{showInt count} #{plural count &quot;item&quot; &quot;items&quot;}.
SwitchLanguage: Switch language to:
Switch: Switch</code></pre>
<pre class="text"><code>-- @messages/he.msg
Hello: שלום
EnterItemCount: אני רוצה לקנות:
Purchase: קנה
ItemCount count: קנית #{showInt count} #{plural count &quot;דבר&quot; &quot;דברים&quot;}.
SwitchLanguage: החלף שפה ל:
Switch: החלף</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1"></a><span class="ot">{-# LANGUAGE MultiParamTypeClasses #-}</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="ot">{-# LANGUAGE OverloadedStrings     #-}</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="ot">{-# LANGUAGE QuasiQuotes           #-}</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="ot">{-# LANGUAGE TemplateHaskell       #-}</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="ot">{-# LANGUAGE TypeFamilies          #-}</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="kw">import</span>           <span class="dt">Yesod</span></span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="kw">data</span> <span class="dt">App</span> <span class="ot">=</span> <span class="dt">App</span></span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a>mkMessage <span class="st">&quot;App&quot;</span> <span class="st">&quot;messages&quot;</span> <span class="st">&quot;en&quot;</span></span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="ot">plural ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>plural <span class="dv">1</span> x _ <span class="ot">=</span> x</span>
<span id="cb3-14"><a href="#cb3-14"></a>plural _ _ y <span class="ot">=</span> y</span>
<span id="cb3-15"><a href="#cb3-15"></a></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="fu">showInt</span><span class="ot"> ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">String</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="fu">showInt</span> <span class="ot">=</span> <span class="fu">show</span></span>
<span id="cb3-18"><a href="#cb3-18"></a></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="kw">instance</span> <span class="dt">Yesod</span> <span class="dt">App</span></span>
<span id="cb3-20"><a href="#cb3-20"></a></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="kw">instance</span> <span class="dt">RenderMessage</span> <span class="dt">App</span> <span class="dt">FormMessage</span> <span class="kw">where</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>    renderMessage _ _ <span class="ot">=</span> defaultFormMessage</span>
<span id="cb3-23"><a href="#cb3-23"></a></span>
<span id="cb3-24"><a href="#cb3-24"></a>mkYesod <span class="st">&quot;App&quot;</span> [parseRoutes|</span>
<span id="cb3-25"><a href="#cb3-25"></a>/     HomeR GET</span>
<span id="cb3-26"><a href="#cb3-26"></a>/buy  BuyR  GET</span>
<span id="cb3-27"><a href="#cb3-27"></a>/lang LangR POST</span>
<span id="cb3-28"><a href="#cb3-28"></a>|]</span>
<span id="cb3-29"><a href="#cb3-29"></a></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="ot">getHomeR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></span>
<span id="cb3-31"><a href="#cb3-31"></a>getHomeR <span class="ot">=</span> defaultLayout</span>
<span id="cb3-32"><a href="#cb3-32"></a>    [whamlet|</span>
<span id="cb3-33"><a href="#cb3-33"></a>        <span class="kw">&lt;h1&gt;_{</span><span class="dt">MsgHello</span><span class="kw">}</span></span>
<span id="cb3-34"><a href="#cb3-34"></a>        <span class="kw">&lt;form</span><span class="ot"> action=</span><span class="kw">@{</span><span class="dt">BuyR</span><span class="kw">}&gt;</span></span>
<span id="cb3-35"><a href="#cb3-35"></a>            <span class="kw">_{</span><span class="dt">MsgEnterItemCount</span><span class="kw">}</span></span>
<span id="cb3-36"><a href="#cb3-36"></a>            <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">text</span><span class="ot"> name=</span><span class="st">count</span><span class="kw">&gt;</span></span>
<span id="cb3-37"><a href="#cb3-37"></a>            <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">submit</span><span class="ot"> value=</span><span class="st">_{MsgPurchase}</span><span class="kw">&gt;</span></span>
<span id="cb3-38"><a href="#cb3-38"></a>        <span class="kw">&lt;form</span><span class="ot"> action=</span><span class="kw">@{</span><span class="dt">LangR</span><span class="kw">}</span><span class="ot"> method=</span><span class="st">post</span><span class="kw">&gt;</span></span>
<span id="cb3-39"><a href="#cb3-39"></a>            <span class="kw">_{</span><span class="dt">MsgSwitchLanguage</span><span class="kw">}</span></span>
<span id="cb3-40"><a href="#cb3-40"></a>            <span class="kw">&lt;select</span><span class="ot"> name=</span><span class="st">lang</span><span class="kw">&gt;</span></span>
<span id="cb3-41"><a href="#cb3-41"></a>                <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">en</span><span class="kw">&gt;</span>English</span>
<span id="cb3-42"><a href="#cb3-42"></a>                <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">he</span><span class="kw">&gt;</span>Hebrew</span>
<span id="cb3-43"><a href="#cb3-43"></a>            <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">submit</span><span class="ot"> value=</span><span class="st">_{MsgSwitch}</span><span class="kw">&gt;</span></span>
<span id="cb3-44"><a href="#cb3-44"></a>    |]</span>
<span id="cb3-45"><a href="#cb3-45"></a></span>
<span id="cb3-46"><a href="#cb3-46"></a><span class="ot">getBuyR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></span>
<span id="cb3-47"><a href="#cb3-47"></a>getBuyR <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb3-48"><a href="#cb3-48"></a>    count <span class="ot">&lt;-</span> runInputGet <span class="op">$</span> ireq intField <span class="st">&quot;count&quot;</span></span>
<span id="cb3-49"><a href="#cb3-49"></a>    defaultLayout [whamlet|<span class="kw">&lt;p&gt;_{</span><span class="dt">MsgItemCount</span> count<span class="kw">}</span>|]</span>
<span id="cb3-50"><a href="#cb3-50"></a></span>
<span id="cb3-51"><a href="#cb3-51"></a><span class="ot">postLangR ::</span> <span class="dt">Handler</span> ()</span>
<span id="cb3-52"><a href="#cb3-52"></a>postLangR <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb3-53"><a href="#cb3-53"></a>    lang <span class="ot">&lt;-</span> runInputPost <span class="op">$</span> ireq textField <span class="st">&quot;lang&quot;</span></span>
<span id="cb3-54"><a href="#cb3-54"></a>    setLanguage lang</span>
<span id="cb3-55"><a href="#cb3-55"></a>    redirect <span class="dt">HomeR</span></span>
<span id="cb3-56"><a href="#cb3-56"></a></span>
<span id="cb3-57"><a href="#cb3-57"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb3-58"><a href="#cb3-58"></a>main <span class="ot">=</span> warp <span class="dv">3000</span> <span class="dt">App</span></span></code></pre></div>
<h2 id="概観">概観</h2>
<p>既存の良くある i18n の解決策は、gettext や Java message bundle のように文字列検索の原理で機能します。良くあるのは、変数を文字列に挿入する printf の展開です。ご想像の通り、Yesod においては代わりに型に頼っています。これはコンパイラが自動的に誤りを見つけてくれるような、あらゆる標準的な利点があります。</p>
<p>具体例を取り上げてみましょう。アプリケーションがユーザに言いたいことが2つあるとしましょう。それは hello と言うことと、何人のユーザはシステムにログインしているかということです。これは直和型でモデル化できます。</p>
<pre class="haskkell"><code>data MyMessage = MsgHello | MsgUsersLoggedIn Int</code></pre>
<p>このデータ型を英語表現に変換するための関数も書くこともできます。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1"></a><span class="ot">toEnglish ::</span> <span class="dt">MyMessage</span> <span class="ot">-&gt;</span> <span class="dt">String</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>toEnglish <span class="dt">MsgHello</span> <span class="ot">=</span> <span class="st">&quot;Hello there!&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>toEnglish (<span class="dt">MsgUsersLoggedIn</span> <span class="dv">1</span>) <span class="ot">=</span> <span class="st">&quot;There is 1 user logged in.&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>toEnglish (<span class="dt">MsgUsersLoggedIn</span> i) <span class="ot">=</span> <span class="st">&quot;There are &quot;</span> <span class="op">++</span> <span class="fu">show</span> i <span class="op">++</span> <span class="st">&quot; users logged in.&quot;</span></span></code></pre></div>
<p>ほかの言語についても同様な関数を書くことができます。この内部 Haskell 的な方法による利点は、特に複数性のような、トリッキーな文法的問題を解決するために Haskell の力を最大限に利用できることです。</p>
<div class="yesod-book-notice">
<p>1つのアイテムに関しては1つの方法があり、他の数に関しては、他の方法があると言う意味で、複数性はそれほど複雑ではないと思うかもしれません。それは英語については本当かもしれませんが、すべての言語について当てはまるわけではありません。例えば、ロシア語は6つの異なる形式があり、どれを使うかについては modulus logic で決める必要があります。</p>
</div>
<p>しかし、この方法の欠点はこれらすべてを Haskell の内部に書かなくてはならないので、翻訳者に対して優しくありません。これを解決するために Yesod はメッセージファイルの概念を導入しました。あとで詳しく紹介します。</p>
<p>これら一式の翻訳関数を持っていると仮定した場合、それらをどのように使えば良いのでしょうか？必要なものとしては、翻訳関数一式をすべてをまとめあげ、ユーザの選択した言語に応じて適切な翻訳関数を選択する新しい関数です。その関数さえあれば、Yesod は自動的にもっとも関連するレンダリング関数を選び、与えた値に基づいてそれを呼び出すことができます。</p>
<p>多少物事を単純化するために Hamlet は特別な展開構文 <code>_{...}</code> を持ちます。この構文はレンダリング関数に対するあらゆる呼び出しを扱います。そして、レンダリング関数をアプリケーションに関連付けるために <code>YesodMessage</code> 型クラスを使います。</p>
<h2 id="メッセージファイル">メッセージファイル</h2>
<p>メッセージファイルを使えば、とてもシンプルに翻訳を作ることができます。設定は簡単です。それぞれの言語で、すべての翻訳を含む1つのファイルを用意し、そしてそれらの翻訳ファイル全てを1つのフォルダに含めます。各ファイル名は <em>en.msg</em> のように、言語コードに基づいた名前になります。そして、ファイルの各行は1つのフレーズを処理し、それはメッセージデータ型の1つのコンストラクタに対応します。</p>
<div class="yesod-book-notice">
<p>scaffolded サイトはすでに完成したメッセージフォルダを含みます。</p>
</div>
<p>まず初めに、言語コードについて説明します。言語コードの指定方法には「2文字の言語コード」と「言語-地域コード」の2種類の選択肢があります。例えば、ブラウザがページを読み込む時に en-US と en の2つの言語コードを送信するとしましょう。その場合、私のブラウザは “もしアメリカ英語があれば、それが一番好ましいです。次に、もし英語があれば代わりにそれを利用します。” というように言っています。</p>
<p>では、あなたのアプリケーションはどちらの形式を利用すべきでしょうか？実際に地域毎に異なる翻訳を作っている場合を除いて、基本的に2文字のコードを利用します。こうすれば、カナダ英語を求めている人でも英語を見ることができます。このような場面において、Yesod は関連する2文字のコードを追加するでしょう。例えば、ユーザの言語リストが以下のようになっていたとしましょう。</p>
<pre><code>pt-BR, es, he</code></pre>
<p>これは “ブラジル系ポルトガル語が好きです。そして、次に好きなのはスペイン語、ヘブライ語です。” という意味です。また、あなたのアプリケーションは pt(一般的なポルトガル語) と英語 (英語はデフォルト) を提供するとしましょう。ユーザの言語リストに厳密に従えば、ユーザは英語を見ることになります。そのため Yesod では代わりに、その言語リストを次のように変換します。</p>
<pre><code>pt-BR, es, he, pt</code></pre>
<p>つまり、地域毎に異なる翻訳を提供しないのであれば、2文字の言語コードを利用します。</p>
<p>それでは、メッセージファイルについてはどうでしょうか？Hamlet や Persistent に取り組んだ後であれば、構文は非常に馴染み深いものでしょう。行はメッセージ名から始まります。これはデータコンストラクタなので、大文字で始まる必要があります。次に、個々のパラメータを持つことができ、それらは小文字で始まります。これはデータコンストラクタの引数になります。引数リストはコロンで終了し、そして、翻訳される文字列が続きます。ここでは、複数性などのような問題を扱うために、典型的な変数展開構文の翻訳補助関数を利用でき、すべての必要な翻訳されたメッセージを作ることができます。</p>
<h3 id="型を指定する">型を指定する</h3>
<p>データ型はメッセージの仕様により作られるため、データコンストラクタの各パラメータにデータ型を指定する必要があります。このために <span class="citation" data-cites="構文を使います">@構文を使います</span>。例えば、<code>data MyMessage = MsgHello | MsgSayAge Int</code> のデータ型を作るためには、以下のように記述します。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1"></a><span class="dt">Hello</span><span class="op">:</span> <span class="dt">Hi</span> there<span class="op">!</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="dt">SayAge</span> age<span class="op">@</span><span class="dt">Int</span><span class="op">:</span> <span class="dt">Your</span> age is<span class="op">:</span> <span class="op">#</span>{<span class="fu">show</span> age}</span></code></pre></div>
<p>しかし、これには2つの問題点があります。</p>
<ol type="1">
<li>すべてのファイルで、このデータ型を指定するのは面倒 (繰り返してはいけない) です</li>
<li>翻訳者はこれらのデータ型の指定に混乱してしまいます</li>
</ol>
<p>そのため、型指定は主言語ファイルのみ必須です。これは <code>mkMessage</code> 関数の3番目の引数で指定します。これはまた、アプリケーションが提供するどの言語もユーザの言語リストに一致しない場合のバックアップ言語の指定にもなります。</p>
<h2 id="rendermessage-型クラス">RenderMessage 型クラス</h2>
<p><code>mkMessage</code> の呼び出しにより <code>RenderMessage</code> 型クラスのインスタンスが作られます。これは Yesod の i18n における核心部です。<code>RenderMessage</code> 型クラスは以下のように定義されます。</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">class</span> <span class="dt">RenderMessage</span> master message <span class="kw">where</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="ot">    renderMessage ::</span> master  <span class="co">-- ^ type that specifies which set of translations to use</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>                  <span class="ot">-&gt;</span> [<span class="dt">Lang</span>]  <span class="co">-- ^ acceptable languages in descending order of preference</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>                  <span class="ot">-&gt;</span> message <span class="co">-- ^ message to translate</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>                  <span class="ot">-&gt;</span> <span class="dt">Text</span></span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">-- | an RFC1766 / ISO 639-1 language code (eg, @fr@, @en-GB@, etc).</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="kw">type</span> <span class="dt">Lang</span> <span class="ot">=</span> <span class="dt">Text</span></span></code></pre></div>
<p><code>RenderMessage</code> クラスには2つのパラメータがあることに注意してください。これはマスターサイトとメッセージ型です。理論的には、今回の場合 master 型については省略可能ですが、これはすべてのサイトは各メッセージ型につき同じ翻訳のセットが必要であることを意味します。 フォームのような共有ライブラリにおいては、それはあまりよく機能しない解決策です。</p>
<p><code>renderMessage</code> 関数はクラスの型パラメータ (master と message) をそれぞれ引数として取ります。残りのパラメータは、優先順位の高い順のユーザが受け入れる言語リストです。このメソッドは、表示可能なユーザが準備した <code>Text</code> を返します。</p>
<p><code>RenderMessage</code> の単純なインスタンスには、文字列の実際の翻訳を何も含まない場合があります。代わりに、すべての言語に対し、同じ値を表示します。例えば、</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">data</span> <span class="dt">MyMessage</span> <span class="ot">=</span> <span class="dt">Hello</span> <span class="op">|</span> <span class="dt">Greet</span> <span class="dt">Text</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw">instance</span> <span class="dt">RenderMessage</span> <span class="dt">MyApp</span> <span class="dt">MyMessage</span> <span class="kw">where</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>    renderMessage _ _ <span class="dt">Hello</span> <span class="ot">=</span> <span class="st">&quot;Hello&quot;</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>    renderMessage _ _ (<span class="dt">Greet</span> name) <span class="ot">=</span> <span class="st">&quot;Welcome, &quot;</span> <span class="op">&lt;&gt;</span> name <span class="op">&lt;&gt;</span> <span class="st">&quot;!&quot;</span></span></code></pre></div>
<p><code>renderMessage</code> の初めの2つのパラメータが無視されている点に注意してください。これを複数の言語をサポートするように拡張します。</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1"></a>renderEn <span class="dt">Hello</span> <span class="ot">=</span> <span class="st">&quot;Hello&quot;</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>renderEn (<span class="dt">Greet</span> name) <span class="ot">=</span> <span class="st">&quot;Welcome, &quot;</span> <span class="op">&lt;&gt;</span> name <span class="op">&lt;&gt;</span> <span class="st">&quot;!&quot;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>renderHe <span class="dt">Hello</span> <span class="ot">=</span> <span class="st">&quot;שלום&quot;</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>renderHe (<span class="dt">Greet</span> name) <span class="ot">=</span> <span class="st">&quot;ברוכים הבאים, &quot;</span> <span class="op">&lt;&gt;</span> name <span class="op">&lt;&gt;</span> <span class="st">&quot;!&quot;</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="kw">instance</span> <span class="dt">RenderMessage</span> <span class="dt">MyApp</span> <span class="dt">MyMessage</span> <span class="kw">where</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    renderMessage _ (<span class="st">&quot;en&quot;</span><span class="op">:</span>_) <span class="ot">=</span> renderEn</span>
<span id="cb11-7"><a href="#cb11-7"></a>    renderMessage _ (<span class="st">&quot;he&quot;</span><span class="op">:</span>_) <span class="ot">=</span> renderHe</span>
<span id="cb11-8"><a href="#cb11-8"></a>    renderMessage master (_<span class="op">:</span>langs) <span class="ot">=</span> renderMessage master langs</span>
<span id="cb11-9"><a href="#cb11-9"></a>    renderMessage _ [] <span class="ot">=</span> renderEn</span></code></pre></div>
<p>ここでのアイデアはかなり率直です。各言語に対するヘルパ関数を定義します。そして、それらの言語をキャッチするための節を renderMessage の定義に加えます。最後に、どの言語も一致しなかった時はユーザの優先リストの次の言語の確認に続き、もし、ユーザが指定したすべての言語を網羅しつくしたらデフォルト言語 (今回の場合は英語) を利用するように2つの場合分けを追加する。</p>
<p>しかし、これらのものを手動で書くことを心配する必要はありません。なぜなら、メッセージファイルのインターフェースがこれらすべてを行ってくれるためです。しかし、表面下で何が起こっているかを知っておくことは、常によい考えです。</p>
<h2 id="展開">展開</h2>
<p>新しい <code>RenderMessage</code> のインスタンスを使う方法の1つは直接 <code>renderMessage</code> を呼ぶことでしょう。この方法も問題はありませんが、、少し面倒です。ファウンデーション値と、言語リストを手動で渡す必要があります。代わりに Hamlet は特別な i18n の展開である <code>_{...}</code> を提供します。</p>
<div class="yesod-book-notice">
<p>なぜアンダースコアなのでしょうか？アンダースコアは i18n においてしっかりと確立された文字で gettext ライブラリで利用されています。</p>
</div>
<p>Hamlet は自動的にそれを <code>renderMessage</code> の呼び出しに変換します。Hamlet で <code>Text</code> 値の出力が手に入れば <code>toHtml</code> 関数を利用して <code>Html</code> 値を作ることができます。つまり、特殊文字 (&lt;, &amp;, &gt;) は自動的にエスケープされるということです。</p>
<h2 id="単語でなくフレーズ">単語でなくフレーズ</h2>
<p>最後は i18n に関するただの一般的なアドバイスです。ここで、カメを売るアプリケーションがあるとしよう。“カートに4匹のカメを追加しました” や “4匹のカメを購入しました、おめでとうございます!” のように “カメ” という言葉を複数の箇所で使いたいとします。プログラマなら、すぐにコードが再利用できそうだと気づきます。“4匹のカメ” という表現を2箇所で利用しているからです。そこで、メッセージファイルを次のようにするかもしれません。</p>
<pre><code>AddStart: You have added
AddEnd: to your cart.
PurchaseStart: You have purchased
PurchaseEnd: , congratulations!
Turtles count@Int: #{show count} #{plural count &quot;turtle&quot; &quot;turtles&quot;}</code></pre>
<p>ここで書くのをやめてください！これはプログラミングの観点から見ればとても良いことですが、翻訳はプログラミングではありません。このようにしてしまうと、以下のような問題がいくつも発生します。</p>
<ul>
<li>“追加しました。” の前に “カートに入れる” を置く言語もあります</li>
<li>たぶん “追加しました。” の部分は、1匹あるいは複数匹のカメを追加したかという内容に応じて、異なる方法で構築されるかもしれません</li>
<li>同様に空白の問題が数多くあります。</li>
</ul>
<p>よって、一般的なルールは「単語だけではなく、フレーズ全体を翻訳しよう」です。</p>
<h2 id="本書のコード">本書のコード</h2>
<ul>
<li><a href="https://github.com/e-bigmoon/haskell-blog/tree/master/sample-code/yesod/ch016/Synopsis.hs">Synopsis.hs</a></li>
</ul>
      </article>

      <div class="pager">
      
      
      </div>

      <div class="row">
        <div class="col s6 offset-s6" style="position: relative; height: 100px;">
          <div class="fixed-action-btn horizontal" style="position: absolute; display: inline-block; right: 24px;">
  <a class="btn-floating btn-large red">
    <i class="large material-icons">share</i>
  </a>
  <ul>
    <li>
      <a class="btn-floating waves-effect waves-light blue tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Twitter" href="https://twitter.com/intent/tweet?text=国際化&url=https://haskell.e-bigmoon.com/yesod/book/ch16-internationalization.html"><i class="mdi mdi-twitter white-text"></i></a>
    </li>
    <li>
      <a class="btn-floating waves-effect waves-light indigo tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Facebook" href="https://facebook.com/sharer.php?u=https://haskell.e-bigmoon.com/yesod/book/ch16-internationalization.html"><i class="mdi mdi-facebook white-text"></i></a>
    </li>
    <li>
      <a class="btn-floating waves-effect waves-light red tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Google+" href="https://plus.google.com/share?url=https://haskell.e-bigmoon.com/yesod/book/ch16-internationalization.html"><i class="mdi mdi-google-plus white-text"></i></a>
    </li>
  </ul>
</div>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
    </div>

    <footer class="page-footer indigo lighten-1">

  <div class="footer-copyright">

    <div class="container">
      © 2017-2019 BIGMOON&nbsp;
      Site proudly generated by <a class="red-text text-accent-1" href="http://jaspervdj.be/hakyll">Hakyll</a>,&nbsp;
      original Jekyll theme by <a class="red-text text-accent-1" href="https://github.com/mumuxme/materialize-jekyll">mumuxme</a>.
    </div>

  </div>

</footer>


    <!-- scrolltop button -->
    <button class="material-scrolltop waves-effect waves-light hide-on-small-only" type="button">
      <i class="mdi mdi-arrow-up-bold small white-text"></i>
    </button>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-19322672-9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-19322672-9');
    </script>

    <!-- jquery -->
    <script type="text/javascript" src="../../lib/jquery-min.js"></script>
    <!-- materialize -->
    <script src="../../lib/materialize/js/materialize.min.js"></script>
    <!-- <\!-- Material ScrollTop plugin -\-> -->
    <script src="../../lib/material-scrolltop/material-scrolltop.js"></script>
    <!-- main -->
    <script src="../../js/init.js"></script>
    <script src="../../js/main.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>

</html>
