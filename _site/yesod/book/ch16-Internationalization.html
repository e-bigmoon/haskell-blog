<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">

  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
  <!-- MUST in hex format, may the same as header-color. This color is for android chrome browser. -->
  <meta name="theme-color" content="#5c6bc0">

  <!-- Metadata. -->
  <meta name="keywords" content="haskell,blog,bigmoon" />
  <title>国際化</title>
  <meta name="description" content="BIG MOON">
  <link rel="canonical" href="../../yesod/book/ch16-Internationalization.html">
  <link rel="alternate" type="application/atom+xml" title="国際化" href="../../feed.xml" />
  <link rel="shortcut icon" href="../../images/favicon.ico" />
  <meta name="google-site-verification" content="X2YNboLvzw3_bclXLMvohyJDqj68D06_hPDMukRbgTs" />

  <!-- Stylesheets. -->
  <link rel="stylesheet" href="../../lib/materialize/css/materialize.min.css" />
  <link rel="stylesheet" href="../../css/main.css" />
  <link media="all" rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/3.3.92/css/materialdesignicons.min.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="../../lib/material-scrolltop/material-scrolltop.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />

  <!-- OGP -->
  <meta property="og:title" content="国際化" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="/yesod/book/ch16-Internationalization.html" />
  <!-- <meta property="og:image" content=" サムネイル画像の URL" /> -->
  <meta property="og:site_name" content="国際化" />
  <meta property="og:description" content="BIG MOON" />

  <meta name="twitter:card" content="summary" />
  <!-- <meta name="twitter:site" content="@[ Twitter ID]" /> -->
  <!-- <meta name="twitter:player" content="@[ Twitter ID]" /> -->

  <noscript>
  <div class="notice-warning noscript">You don't have javascript enabled. Good luck! :(</div>
</noscript>

<!--[if IE]>
  <div class="notice-warning">Oh, you are using Internet Explorer! Good luck... :(</div>
<![endif]-->

</head>


  <body>
    <header class="site-header">
      <nav class="nav-extended indigo lighten-1">
        <div class="nav-wrapper">
  <a href="../../"><span class="site-title">BIGMOON Haskeller's BLOG</span></a>
  <a href="#" data-activates="mobile-navbar" class="button-collapse">
    <i class="mdi mdi-menu white-text"></i>
  </a>

  <ul id="nav-mobile" class="right hide-on-med-and-down">
    <li>
      <a href="../../" class="white-text">
        <i class="mdi mdi-home left indigo-text text-lighten-3"></i>
        Home
      </a>
    </li>
    <li>
      <a href="../../about.html" class="white-text">
        <i class="mdi mdi-account-circle left indigo-text text-lighten-3"></i>
        About
      </a>
    </li>
    <li>
      <a href="../../stack/" class="white-text">
        <i class="mdi mdi-wrench left indigo-text text-lighten-3"></i>
        Development
      </a>
    </li>
    <li>
      <a href="../../quiz/index.html" class="white-text">
        <i class="mdi mdi-comment-question-outline left indigo-text text-lighten-3"></i>
        Quiz
      </a>
    </li>
    <li>
      <a href="../../libraries/" class="white-text">
        <i class="mdi mdi-package-variant left indigo-text text-lighten-3"></i>
        Libraries
      </a>
    </li>
    <li>
      <a href="../../yesod/" class="white-text">
        <i class="mdi mdi-earth left indigo-text text-lighten-3"></i>
        Yesod
      </a>
    </li>
    <li>
      <a href="../../contact.html" class="white-text">
        <i class="mdi mdi-lead-pencil left indigo-text text-lighten-3"></i>
        Contact
      </a>
    </li>
    <li>
      <a href="../../feed.xml" class="white-text">
        <i class="mdi mdi-rss left indigo-text text-lighten-3"></i>
        Feed
      </a>
    </li>
  </ul>

  <ul class="side-nav" id="mobile-navbar">
    <li>
      <a href="../../" class="waves-effect waves-teal black-text">
        <i class="mdi mdi-home left green-text"></i>
        Home
      </a>
    </li>
    <li>
      <a href="../../about.html" class="navbar-text-colour-mobile">
        <i class="mdi mdi-account-circle left blue-text"></i>
        About
      </a>
    </li>
    <li>
      <a href="../../stack/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-wrench left blue-text"></i>
        Development
      </a>
    </li>
    <li>
      <a href="../../quiz/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-comment-question-outline left blue-text"></i>
        Quiz
      </a>
    </li>
    <li>
      <a href="../../libraries/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-package-variant left blue-text"></i>
        Libraries
      </a>
    </li>
    <li>
      <a href="../../yesod/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-earth left blue-text"></i>
        Yesod
      </a>
    </li>
    <li>
      <a href="../../contact.html" class="navbar-text-colour-mobile">
        <i class="mdi mdi-lead-pencil left blue-text"></i>
        Contact
      </a>
    </li>
  </ul>
</div>

      </nav>
    </header>

    <div class="site-container" id="tab-main">
      <div class="wrapper">
        <div class="post-ribbon"></div>

<div class="container page-container">
  <div class="post-page card-panel z-depth-2">
    <div class="post-section">
      <div class="post-heading">
        <h1 class="post-title">国際化</h1>
        
        <span>最終更新日: 2019/01/20</span>
        
      </div>

      <article class="page-content">
        <h1 id="国際化">国際化</h1>
<p>ユーザはソフトウェアが自国の言語を話すことを期待している. 我々にとって都合が悪いことに, 1つ以上の言語が関連するのである. 単に文字列を置換するだけのことは複雑ではないが, あらゆる文法の問題を適切に扱うことは, 技巧的である. 結局, ’1つのファイルを上げなさい’というプログラムアウトプットは誰が見たいでしょうか?</p>
<p>しかし, リアルなi18nによる解決策は, 単に適切なアウトプットを達成する方法を与える以上のことを要する. それは, この過程をプログラマと翻訳者にとって容易で, 比較的エラープルーフにする必要がある. この問題に対するYesodの答えは次のようである:</p>
<ul>
<li><p>リクエストヘッダに基づき, オーバーライドする能力を用いて, 知的にユーザの望む言語を推測する.</p></li>
<li><p>Haskellの知識を必要としない翻訳を与える単純な構文.(結局のところ, 大部分の翻訳者はプログラマでない.)</p></li>
<li><p>大部分の必要性をカバーするデフォルトの補助関数の選択とともに, 必要に応じて技巧的な文法の問題に対しては, Haskellの最大限の力を利用する能力.</p></li>
<li><p>文字の順序に対しては全く問題ない.</p></li>
</ul>
<h2 id="synopsis">Synopsis</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" title="1"><span class="co">-- @messages/en.msg</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="dt">Hello</span><span class="op">:</span> <span class="dt">Hello</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="dt">EnterItemCount</span><span class="op">:</span> <span class="dt">I</span> would like to buy<span class="op">:</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="dt">Purchase</span><span class="op">:</span> <span class="dt">Purchase</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="dt">ItemCount</span> count<span class="op">@</span><span class="dt">Int</span><span class="op">:</span> <span class="dt">You</span> have purchased <span class="op">#</span>{<span class="fu">showInt</span> count} <span class="op">#</span>{plural count <span class="st">&quot;item&quot;</span> <span class="st">&quot;items&quot;</span>}<span class="op">.</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="dt">SwitchLanguage</span><span class="op">:</span> <span class="dt">Switch</span> language to<span class="op">:</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="dt">Switch</span><span class="op">:</span> <span class="dt">Switch</span></a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" title="1"><span class="co">-- @messages/he.msg</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="dt">Hello</span><span class="op">:</span> שלום</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="dt">EnterItemCount</span><span class="op">:</span> אני רוצה לקנות<span class="op">:</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="dt">Purchase</span><span class="op">:</span> קנה</a>
<a class="sourceLine" id="cb2-5" title="5"><span class="dt">ItemCount</span> count<span class="op">:</span> קנית <span class="op">#</span>{<span class="fu">showInt</span> count} <span class="op">#</span>{plural count <span class="st">&quot;דבר&quot;</span> <span class="st">&quot;דברים&quot;</span>}<span class="op">.</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="dt">SwitchLanguage</span><span class="op">:</span> החלף שפה ל<span class="op">:</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="dt">Switch</span><span class="op">:</span> החלף</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1"><span class="ot">{-# LANGUAGE MultiParamTypeClasses #-}</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="ot">{-# LANGUAGE OverloadedStrings     #-}</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="ot">{-# LANGUAGE QuasiQuotes           #-}</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="ot">{-# LANGUAGE TemplateHaskell       #-}</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="ot">{-# LANGUAGE TypeFamilies          #-}</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="kw">import</span>           <span class="dt">Yesod</span></a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="kw">data</span> <span class="dt">App</span> <span class="ot">=</span> <span class="dt">App</span></a>
<a class="sourceLine" id="cb3-9" title="9"></a>
<a class="sourceLine" id="cb3-10" title="10">mkMessage <span class="st">&quot;App&quot;</span> <span class="st">&quot;messages&quot;</span> <span class="st">&quot;en&quot;</span></a>
<a class="sourceLine" id="cb3-11" title="11"></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="ot">plural ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb3-13" title="13">plural <span class="dv">1</span> x _ <span class="ot">=</span> x</a>
<a class="sourceLine" id="cb3-14" title="14">plural _ _ y <span class="ot">=</span> y</a>
<a class="sourceLine" id="cb3-15" title="15"></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="fu">showInt</span><span class="ot"> ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="fu">showInt</span> <span class="ot">=</span> <span class="fu">show</span></a>
<a class="sourceLine" id="cb3-18" title="18"></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="kw">instance</span> <span class="dt">Yesod</span> <span class="dt">App</span></a>
<a class="sourceLine" id="cb3-20" title="20"></a>
<a class="sourceLine" id="cb3-21" title="21"><span class="kw">instance</span> <span class="dt">RenderMessage</span> <span class="dt">App</span> <span class="dt">FormMessage</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb3-22" title="22">    renderMessage _ _ <span class="ot">=</span> defaultFormMessage</a>
<a class="sourceLine" id="cb3-23" title="23"></a>
<a class="sourceLine" id="cb3-24" title="24">mkYesod <span class="st">&quot;App&quot;</span> [parseRoutes|</a>
<a class="sourceLine" id="cb3-25" title="25">/     HomeR GET</a>
<a class="sourceLine" id="cb3-26" title="26">/buy  BuyR  GET</a>
<a class="sourceLine" id="cb3-27" title="27">/lang LangR POST</a>
<a class="sourceLine" id="cb3-28" title="28">|]</a>
<a class="sourceLine" id="cb3-29" title="29"></a>
<a class="sourceLine" id="cb3-30" title="30"><span class="ot">getHomeR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></a>
<a class="sourceLine" id="cb3-31" title="31">getHomeR <span class="ot">=</span> defaultLayout</a>
<a class="sourceLine" id="cb3-32" title="32">    [whamlet|</a>
<a class="sourceLine" id="cb3-33" title="33">        <span class="kw">&lt;h1&gt;_{</span><span class="dt">MsgHello</span><span class="kw">}</span></a>
<a class="sourceLine" id="cb3-34" title="34">        <span class="kw">&lt;form</span><span class="ot"> action=</span><span class="kw">@{</span><span class="dt">BuyR</span><span class="kw">}&gt;</span></a>
<a class="sourceLine" id="cb3-35" title="35">            <span class="kw">_{</span><span class="dt">MsgEnterItemCount</span><span class="kw">}</span></a>
<a class="sourceLine" id="cb3-36" title="36">            <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">text</span><span class="ot"> name=</span><span class="st">count</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb3-37" title="37">            <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">submit</span><span class="ot"> value=</span><span class="st">_{MsgPurchase}</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb3-38" title="38">        <span class="kw">&lt;form</span><span class="ot"> action=</span><span class="kw">@{</span><span class="dt">LangR</span><span class="kw">}</span><span class="ot"> method=</span><span class="st">post</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb3-39" title="39">            <span class="kw">_{</span><span class="dt">MsgSwitchLanguage</span><span class="kw">}</span></a>
<a class="sourceLine" id="cb3-40" title="40">            <span class="kw">&lt;select</span><span class="ot"> name=</span><span class="st">lang</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb3-41" title="41">                <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">en</span><span class="kw">&gt;</span>English</a>
<a class="sourceLine" id="cb3-42" title="42">                <span class="kw">&lt;option</span><span class="ot"> value=</span><span class="st">he</span><span class="kw">&gt;</span>Hebrew</a>
<a class="sourceLine" id="cb3-43" title="43">            <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">submit</span><span class="ot"> value=</span><span class="st">_{MsgSwitch}</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb3-44" title="44">    |]</a>
<a class="sourceLine" id="cb3-45" title="45"></a>
<a class="sourceLine" id="cb3-46" title="46"><span class="ot">getBuyR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></a>
<a class="sourceLine" id="cb3-47" title="47">getBuyR <span class="ot">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-48" title="48">    count <span class="ot">&lt;-</span> runInputGet <span class="op">$</span> ireq intField <span class="st">&quot;count&quot;</span></a>
<a class="sourceLine" id="cb3-49" title="49">    defaultLayout [whamlet|<span class="kw">&lt;p&gt;_{</span><span class="dt">MsgItemCount</span> count<span class="kw">}</span>|]</a>
<a class="sourceLine" id="cb3-50" title="50"></a>
<a class="sourceLine" id="cb3-51" title="51"><span class="ot">postLangR ::</span> <span class="dt">Handler</span> ()</a>
<a class="sourceLine" id="cb3-52" title="52">postLangR <span class="ot">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-53" title="53">    lang <span class="ot">&lt;-</span> runInputPost <span class="op">$</span> ireq textField <span class="st">&quot;lang&quot;</span></a>
<a class="sourceLine" id="cb3-54" title="54">    setLanguage lang</a>
<a class="sourceLine" id="cb3-55" title="55">    redirect <span class="dt">HomeR</span></a>
<a class="sourceLine" id="cb3-56" title="56"></a>
<a class="sourceLine" id="cb3-57" title="57"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb3-58" title="58">main <span class="ot">=</span> warp <span class="dv">3000</span> <span class="dt">App</span></a></code></pre></div>
<h2 id="概観">概観</h2>
<p>独特でもっとも刺激的なi18nによる解決策は, gettextやJavaのmessage bundleのように, 文字列の検索に基づき機能する. たいていある形式のprintf-展開が変数を文字列に挿入するために用いられる. 推測する通り, Yesodにおいては代わりに型に頼っている. これはコンパイラが自動的に誤りを捕えることのように, あらゆる標準的な利点がある.</p>
<p>具体例を取り上げてみましょう. アプリケーションがユーザに言いたいことが2つあるとしましょう: helloと言うことと, 何人のユーザはシステムにログインしているか. これは, 直和型を用いてモデル化される:</p>
<p><code>data MyMessage = MsgHello | MsgUsersLoggedIn Int</code></p>
<p>このデータ型を英語表現に変換するための関数も書くこともできる:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" title="1"><span class="ot">toEnglish ::</span> <span class="dt">MyMessage</span> <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb4-2" title="2">toEnglish <span class="dt">MsgHello</span> <span class="ot">=</span> <span class="st">&quot;Hello there!&quot;</span></a>
<a class="sourceLine" id="cb4-3" title="3">toEnglish (<span class="dt">MsgUsersLoggedIn</span> <span class="dv">1</span>) <span class="ot">=</span> <span class="st">&quot;There is 1 user logged in.&quot;</span></a>
<a class="sourceLine" id="cb4-4" title="4">toEnglish (<span class="dt">MsgUsersLoggedIn</span> i) <span class="ot">=</span> <span class="st">&quot;There are &quot;</span> <span class="op">++</span> <span class="fu">show</span> i <span class="op">++</span> <span class="st">&quot; users logged in.&quot;</span></a></code></pre></div>
<p>ほかの言語についても同様な関数を書くことができる. この内部Haskell的な方法による利点は, , 特に複数性のような, 技巧的な部方的問題を解決するためにHaskellの力を最大限に利用することができることである.</p>
<div class="yesod-book-notice">
<p>複数性はそれほど複雑ではないと思うかもしれない: 1つのアイテム関しては1つの方法があり, 他の数に関しては, 他の方法がある. それは英語については本当かもしれないが, すべての言語についてそうであるとは限らない. 例えば, ロシア語は6つの異なる形式があり, どれを用いるかについてモジュール的なロジックを用いる必要がある.</p>
</div>
<p>しかし, 欠点としてはこれらすべてをHaskellの内部に書かなくてはならず, 翻訳者にとってあまり便利でない点である. これを解決するために, Yesodはメッセージファイルの概念を導入している. それについては, 後ほど紹介する.</p>
<p>これら一式の翻訳関数を持っていると仮定した場合, それらをどのように使ったら よいであろうか? 必要なものとしては, それらすべてをラップした新しい関数であり, ユーザの選択しら言語に基づいて, 適切な翻訳関数を選択することである. 一旦その機能を獲得すれば, 自動的にもっとも関連するレンダリング関数を選び, 与えた値に基づいてそれを呼び出すことができる.</p>
<p>多少物事を単純化するために, Hamletは特別な展開構文<code>_{...}</code>を持ち, それはレンダリング関数に対するあらゆる呼び出しを扱う. そして, レンダリング関数をアプリケーションに関連付けるために, <code>YesodMessage</code>型クラスを用いる.</p>
<h2 id="メッセージファイル">メッセージファイル</h2>
<p>翻訳を作るための最も単純な方法は, メッセージファイルを用いることである. 設定は簡単である: 各言語につき1つのファイルで, すべての翻訳を含んだファイルを含む1つのフォルダがある. 各ファイルはen.msgなどのような, 言語コードに基づき命名される. そして, ファイルの各行は1つの表現を処理し, それはメッセージデータ型の単一のコンストラクタに紐付けられる.</p>
<div class="yesod-book-notice">
<p>scaffoldedサイトはすでに完成したメッセージフォルダを含む.</p>
</div>
<p>まず初めに, 言語コードについて話す. 実際には2つの利用可能な方法がある: 2文字の言語コードを用いる, または, 言語-地域コードを用いる. 例えば, ページをブラウザにロードする際, 2つの言語コードを送信するものとする: en-USとen: ブラウザが意味しているのは, “もしアメリカ英語があれば, それが最もよい. もし英語があれば, それを代わりにとる”ということである.</p>
<p>そこで, アプリケーションにおいてどちらの形式を用いればよいであろうか? もし, 実際に地域毎に異なる翻訳を作っているのでなければ, ほとんどの場合, 2文字のコードを用いるであろう. このことは, カナダ英語を求めている人でも英語を見ることを意味する. この裏で, Yesodは関連する2文字のコードを付加する. 例えば, ユーザが次の言語リストを所持しているとする:</p>
<pre><code>pt-BR, es, he</code></pre>
<p>これが意味することは, “ブラジル系ポルトガル語が好きであり, そして, スペイン語, ヘブライ語である”. アプリケーションがpt(一般的なポルトガル語)と英語を, 英語をデフォルトで提供するとする. ユーザの言語リストに厳密に従えば, ユーザは英語を与えられることになる. Yesodでは代わりに, その言語リストを次のように変換する;</p>
<pre><code>pt-BR, es, he, pt</code></pre>
<p>言い換えれば, 地域毎に異なる翻訳を与えていなければ, 2文字の言語コードに従う.</p>
<p>それでは, メッセージファイルについてはどうであろうか? HamletやPersistentに取り組んだ後では, 構文は非常に馴染み深いものである. 行は, メッセージ名から始まる. これはデータコンストラクタであるため, 大文字で始まる必要がある. 次に, 個々のパラメータを持つことができ, それらは小文字で与えられる. これはデータコンストラクタに対する引数になる. 引数リストはコロンで終了し, そして, 翻訳される文字列が続き, ここでは, 複数性などのような問題を扱うために, 典型的な変数展開構文の翻訳補助関数を用いることができ, すべての必要な翻訳されたメッセージを作ることができる.</p>
<h2 id="型を指定する">型を指定する</h2>
<p>データ型はメッセージの指定により作られるため, データコンストラクタに対する各パラメータは, データ型を与えられる必要がある. このために@-構文が用いられる. 例えば, <code>data MyMessage = MsgHello | MsgSayAge Int</code>のデータ型を作るために, 次のように書く.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" title="1"><span class="dt">Hello</span><span class="op">:</span> <span class="dt">Hi</span> there<span class="op">!</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="dt">SayAge</span> age<span class="op">@</span><span class="dt">Int</span><span class="op">:</span> <span class="dt">Your</span> age is<span class="op">:</span> <span class="op">#</span>{<span class="fu">show</span> age}</a></code></pre></div>
<p>しかし, これには2つの問題点がある.</p>
<ol type="1">
<li><p>すべてのファイルにおいて, このデータ型を指定するのは面倒(繰り返してはいけない)である.</p></li>
<li><p>翻訳者はこれらのデータ型を指定するのに混乱してしまう.</p></li>
</ol>
<p>そこで, 代わりに型指定は主言語ファイルのみで必要となる. これは, <code>mkMessage</code>関数の3番目の引数として指定される. これはまた, アプリケーションによって与えられたどの言語もユーザの言語リストに一致しない場合に用いられる, バックアップ言語が何であるかを指定する.</p>
<h2 id="rendermessage型クラス">RenderMessage型クラス</h2>
<p><code>mkMessage</code>の呼び出しにより, <code>RenderMessage</code>型クラスのインスタンスが作られ, これはYesodのi18nにおける核心部である. それは, 次のように定義される:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">class</span> <span class="dt">RenderMessage</span> master message <span class="kw">where</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="ot">    renderMessage ::</span> master</a>
<a class="sourceLine" id="cb8-3" title="3">                  <span class="ot">-&gt;</span> [<span class="dt">Lang</span>] <span class="co">-- ^ languages</span></a>
<a class="sourceLine" id="cb8-4" title="4">                  <span class="ot">-&gt;</span> message</a>
<a class="sourceLine" id="cb8-5" title="5">                  <span class="ot">-&gt;</span> <span class="dt">Text</span></a></code></pre></div>
<p><code>RenderMessage</code>クラスには2つのパラメータが存在することに留意しなさい: それは, マスタサイトと, メッセージ型である. 理論的には, ここではマスター型については省略可能であるが, これはすべてのサイトは, 各メッセージ型につき, 同じ翻訳のセットが必要であることを意味する. フォームのような, 共有ライブラリにおいては, それはあまりよく機能しない解決策である.</p>
<p><code>renderMessage</code>関数はクラスの型パラメータそれぞれに対するパラメータを取る: マスタ とメッセージである. 残りのパラメータは, ユーザが受け入れる言語リストが, 優先順位に並ぶ. このメソッドは, ユーザに準備した<code>Text</code>を返す.</p>
<p><code>RenderMessage</code>の単純なインスタンスは, 実際の文字列に対する翻訳を含まない; 代わりに, すべての言語に対し, 同じ値を表示する. 例えば,</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">data</span> <span class="dt">MyMessage</span> <span class="ot">=</span> <span class="dt">Hello</span> <span class="op">|</span> <span class="dt">Greet</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">instance</span> <span class="dt">RenderMessage</span> <span class="dt">MyApp</span> <span class="dt">MyMessage</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb9-3" title="3">    renderMessage _ _ <span class="dt">Hello</span> <span class="ot">=</span> <span class="st">&quot;Hello&quot;</span></a>
<a class="sourceLine" id="cb9-4" title="4">    renderMessage _ _ (<span class="dt">Greet</span> name) <span class="ot">=</span> <span class="st">&quot;Welcome, &quot;</span> <span class="op">&lt;&gt;</span> name <span class="op">&lt;&gt;</span> <span class="st">&quot;!&quot;</span></a></code></pre></div>
<p><code>renderMessage</code>の初めの2つのパラメータがどのように無視されているかについて注意しなさい. これを複数のメッセージをサポートするように拡張できる:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" title="1">renderEn <span class="dt">Hello</span> <span class="ot">=</span> <span class="st">&quot;Hello&quot;</span></a>
<a class="sourceLine" id="cb10-2" title="2">renderEn (<span class="dt">Greet</span> name) <span class="ot">=</span> <span class="st">&quot;Welcome, &quot;</span> <span class="op">&lt;&gt;</span> name <span class="op">&lt;&gt;</span> <span class="st">&quot;!&quot;</span></a>
<a class="sourceLine" id="cb10-3" title="3">renderHe <span class="dt">Hello</span> <span class="ot">=</span> <span class="st">&quot;שלום&quot;</span></a>
<a class="sourceLine" id="cb10-4" title="4">renderHe (<span class="dt">Greet</span> name) <span class="ot">=</span> <span class="st">&quot;ברוכים הבאים, &quot;</span> <span class="op">&lt;&gt;</span> name <span class="op">&lt;&gt;</span> <span class="st">&quot;!&quot;</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="kw">instance</span> <span class="dt">RenderMessage</span> <span class="dt">MyApp</span> <span class="dt">MyMessage</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb10-6" title="6">    renderMessage _ (<span class="st">&quot;en&quot;</span><span class="op">:</span>_) <span class="ot">=</span> renderEn</a>
<a class="sourceLine" id="cb10-7" title="7">    renderMessage _ (<span class="st">&quot;he&quot;</span><span class="op">:</span>_) <span class="ot">=</span> renderHe</a>
<a class="sourceLine" id="cb10-8" title="8">    renderMessage master (_<span class="op">:</span>langs) <span class="ot">=</span> renderMessage master langs</a>
<a class="sourceLine" id="cb10-9" title="9">    renderMessage _ [] <span class="ot">=</span> renderEn</a></code></pre></div>
<p>ここでのアイデアはかなり率直である: 各言語に対するヘルパ関数を定義する. そして, これらの言語をキャッチするための節を, renderMessageの定義に加える. すると最後2つの場合が生じる: どの言語も一致しなかったら, ユーザの優先リストにおける次の言語の確認に続く. もし, ユーザが指定したすべての言語を網羅しつくしたら, デフォルト言語(今回の場合は英語)を用いる.</p>
<p>しかし, これらのものを手動で書くことを心配する必要はないだろう. なぜならば, メッセージファイルのインターフェースがこれらすべてを行ってくれるためである. しかし, 表面下で何が起こっているかを知っておくことは, 常によい考えである.</p>
<h2 id="展開">展開</h2>
<p>新しい<code>RenderMessage</code>のインスタンスを使う方法は, 直接<code>renderMessage</code>を呼ぶことであろう. これは正しいが, 少し面倒である: ファウンデーション値と, 言語リストを手動で渡す必要がある. 代わりに, Hamletは特別なi18nの展開である<code>_{...}</code>を提供する.</p>
<div class="yesod-book-notice">
<p>なぜアンダースコアなのか? アンダースコアは, i18nにおいてしっかりと確立した文字であり, gettextライブラリで用いられる.</p>
</div>
<p>すると, Hamletは自動的にそれを<code>renderMessage</code>の呼び出しに翻訳する. 一度Hamletが<code>Text</code>値の出力を得れば, <code>toHtml</code>関数を用いて, <code>Html</code>値を作る. つまり, 特別な文字(&lt;, &amp;, &gt;)は自動的にエスケープされる.</p>
<h2 id="単語でなく-フレーズ">単語でなく, フレーズ</h2>
<p>最後の注意点として, i18に関する一般的なアドバイスを与えたい. カメを売るアプリケーションがあるとしよう. “カートに4匹のカメを追加しました.”や, “4匹のカメを購入しました, おめでとうございます!”のように, “カメ”という言葉を複数の箇所で使うだろう. プログラマとして, すぐにコード再利用の可能性に気づくだろう: “4匹のカメ”という表現を2箇所で用いている. そこで, メッセージを次のように構築するだろう:</p>
<pre><code>AddStart: You have added
AddEnd: to your cart.
PurchaseStart: You have purchased
PurchaseEnd: , congratulations!
Turtles count@Int: #{show count} #{plural count &quot;turtle&quot; &quot;turtles&quot;}</code></pre>
<p>ここで書くのをやめなさい! これはプログラミングの観点からすると, とてもよいことであるが, 翻訳はプログラミングではない. このようにすると, 以下に示すように余りうまくいかないことが生じてくる:</p>
<ul>
<li><p>“追加する前に”, “カートに入れる”言語もある.</p></li>
<li><p>“追加した”の部分は, 1匹あるいは複数匹のカメを追加したかにより, 異なる方法で構築されるかもしれない.</p></li>
<li><p>同様に空白の問題が数多くある.</p></li>
</ul>
<p>よって, 一般的なルールとして, 単に単語ではなく, フレーズを翻訳しなさい.</p>
      </article>

      <div class="pager">
      
      
      </div>

      <div class="row">
        <div class="col s6 offset-s6" style="position: relative; height: 100px;">
          <div class="fixed-action-btn horizontal" style="position: absolute; display: inline-block; right: 24px;">
  <a class="btn-floating btn-large red">
    <i class="large material-icons">share</i>
  </a>
  <ul>
    <li>
      <a class="btn-floating waves-effect waves-light blue tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Twitter" href="https://twitter.com/intent/tweet?text=国際化&url=https://haskell.e-bigmoon.com/yesod/book/ch16-Internationalization.html"><i class="mdi mdi-twitter white-text"></i></a>
    </li>
    <li>
      <a class="btn-floating waves-effect waves-light indigo tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Facebook" href="https://facebook.com/sharer.php?u=https://haskell.e-bigmoon.com/yesod/book/ch16-Internationalization.html"><i class="mdi mdi-facebook white-text"></i></a>
    </li>
    <li>
      <a class="btn-floating waves-effect waves-light red tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Google+" href="https://plus.google.com/share?url=https://haskell.e-bigmoon.com/yesod/book/ch16-Internationalization.html"><i class="mdi mdi-google-plus white-text"></i></a>
    </li>
  </ul>
</div>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
    </div>

    <footer class="page-footer indigo lighten-1">

  <div class="footer-copyright">

    <div class="container">
      © 2017-2019 BIGMOON&nbsp;
      Site proudly generated by <a class="red-text text-accent-1" href="http://jaspervdj.be/hakyll">Hakyll</a>,&nbsp;
      original Jekyll theme by <a class="red-text text-accent-1" href="https://github.com/mumuxme/materialize-jekyll">mumuxme</a>.
    </div>

  </div>

</footer>


    <!-- scrolltop button -->
    <button class="material-scrolltop waves-effect waves-light hide-on-small-only" type="button">
      <i class="mdi mdi-arrow-up-bold small white-text"></i>
    </button>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-19322672-9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-19322672-9');
    </script>

    <!-- jquery -->
    <script type="text/javascript" src="../../lib/jquery-min.js"></script>
    <!-- materialize -->
    <script src="../../lib/materialize/js/materialize.min.js"></script>
    <!-- <\!-- Material ScrollTop plugin -\-> -->
    <script src="../../lib/material-scrolltop/material-scrolltop.js"></script>
    <!-- main -->
    <script src="../../js/init.js"></script>
    <script src="../../js/main.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>

</html>
