<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">

  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
  <!-- MUST in hex format, may the same as header-color. This color is for android chrome browser. -->
  <meta name="theme-color" content="#5c6bc0">

  <!-- Metadata. -->
  <meta name="keywords" content="haskell,blog,bigmoon" />
  <title>Shakespearen Templates</title>
  <meta name="description" content="BIG MOON">
  <link rel="canonical" href="../../yesod/book/ch04-shakespearen-templates.html">
  <link rel="alternate" type="application/atom+xml" title="Shakespearen Templates" href="../../feed.xml" />
  <link rel="shortcut icon" href="../../images/favicon.ico" />
  <meta name="google-site-verification" content="X2YNboLvzw3_bclXLMvohyJDqj68D06_hPDMukRbgTs" />

  <!-- Stylesheets. -->
  <link rel="stylesheet" href="../../lib/materialize/css/materialize.min.css" />
  <link rel="stylesheet" href="../../css/main.css" />
  <link media="all" rel="stylesheet" type="text/css" href="../../lib/mdi/css/materialdesignicons.min.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="../../lib/material-scrolltop/material-scrolltop.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />

  <!-- OGP -->
  <meta property="og:title" content="Shakespearen Templates" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="/yesod/book/ch04-shakespearen-templates.html" />
  <!-- <meta property="og:image" content=" サムネイル画像の URL" /> -->
  <meta property="og:site_name" content="Shakespearen Templates" />
  <meta property="og:description" content="BIG MOON" />

  <meta name="twitter:card" content="summary" />
  <!-- <meta name="twitter:site" content="@[ Twitter ID]" /> -->
  <!-- <meta name="twitter:player" content="@[ Twitter ID]" /> -->

  <noscript>
  <div class="notice-warning noscript">You don't have javascript enabled. Good luck! :(</div>
</noscript>

<!--[if IE]>
  <div class="notice-warning">Oh, you are using Internet Explorer! Good luck... :(</div>
<![endif]-->

</head>


  <body>
    <header class="site-header">
      <nav class="nav-extended indigo lighten-1">
        <div class="nav-wrapper">
  <a href="../../"><span class="site-title">BIGMOON Haskeller's BLOG</span></a>
  <a href="#" data-activates="mobile-navbar" class="button-collapse">
    <i class="mdi mdi-menu white-text"></i>
  </a>

  <ul id="nav-mobile" class="right hide-on-med-and-down">
    <li>
      <a href="../../" class="white-text">
        <i class="mdi mdi-home left indigo-text text-lighten-3"></i>
        Home
      </a>
    </li>
    <li>
      <a href="../../about.html" class="white-text">
        <i class="mdi mdi-account-circle left indigo-text text-lighten-3"></i>
        About
      </a>
    </li>
    <li>
      <a href="../../stack/" class="white-text">
        <i class="mdi mdi-wrench left indigo-text text-lighten-3"></i>
        Development
      </a>
    </li>
    <li>
      <a href="../../quiz/index.html" class="white-text">
        <i class="mdi mdi-comment-question-outline left indigo-text text-lighten-3"></i>
        Quiz
      </a>
    </li>
    <li>
      <a href="../../libraries/" class="white-text">
        <i class="mdi mdi-package-variant left indigo-text text-lighten-3"></i>
        Libraries
      </a>
    </li>
    <li>
        <a href="../../yesod/" class="white-text">
          <i class="mdi mdi-earth left indigo-text text-lighten-3"></i>
          Yesod
        </a>
      </li>
    <li>
      <a href="../../feed.xml" class="white-text">
        <i class="mdi mdi-rss left indigo-text text-lighten-3"></i>
        Feed
      </a>
    </li>
  </ul>

  <ul class="side-nav" id="mobile-navbar">
    <li>
      <a href="../../" class="waves-effect waves-teal black-text">
        <i class="mdi mdi-home left green-text"></i>
        Home
      </a>
    </li>
    <li>
      <a href="../../about.html" class="navbar-text-colour-mobile">
        <i class="mdi mdi-account-circle left blue-text"></i>
        About
      </a>
    </li>
    <li>
      <a href="../../stack/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-wrench left blue-text"></i>
        Development
      </a>
    </li>
    <li>
      <a href="../../quiz/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-comment-question-outline left blue-text"></i>
        Quiz
      </a>
    </li>
    <li>
      <a href="../../libraries/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-package-variant left blue-text"></i>
        Libraries
      </a>
    </li>
    <li>
      <a href="../../yesod/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-earth left blue-text"></i>
        Yesod
      </a>
    </li>
  </ul>
</div>

      </nav>
    </header>

    <div class="site-container" id="tab-main">
      <div class="wrapper">
        <div class="post-ribbon"></div>

<div class="container page-container">
  <div class="post-page card-panel z-depth-2">
    <div class="post-section">
      <div class="post-heading">
        <h1 class="post-title">Shakespearen Templates</h1>
        
        <span>最終更新日: 2018/03/18</span>
        
      </div>

      <article class="page-content">
        <h2 id="shakespearen-templates">Shakespearen Templates</h2>
<p>Yesod では一般的にテンプレート言語のシェイクスピアファミリーを利用して HTML、CSS、Javascript を生成します。 このテンプレート言語は以下のような包括的原則とともに共通の構文を持ちます。</p>
<ul>
<li>ベースの言語 (Html, Css, Javascript) に対する干渉をできる限り少なくし、控えめに便利機能を提供します</li>
<li>妥当なコンテンツ (well-formed content) であることをコンパイル時に保証します</li>
<li>静的型安全性は <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">XSS攻撃(cross-site scripting)</a> の防止に非常に役立ちます</li>
<li>型安全URLによって。可能な場合は常に展開されたリンクを自動的に検証します</li>
</ul>
<p>Yesod とこれらのテンプレート言語の間には本質的な繋がりやその他の制限は何もありません。 そのため、それぞれは互いに独立して用いることができます。 本章の前半で、これらテンプレート言語自体について説明し、後半ではそれらを Yesod アプリケーション開発のために利用する方法を述べる。</p>
<h2 id="synopsis">Synopsis</h2>
<p>シェイクスピアには4つの主要な言語があり、Hamlet は HTML、Julius は Javascript、Cassius と Lucius は両者とも CSS のためのテンプレート言語です。 Hamlet と Cassius は空白によって識別される形式であり、インデントを用いてネストを表現します。 それに対して Lucius は CSS のスーパーセットなので、通常の CSS で用いられる波括弧の形式でネストを表します。 Julius は Javascript を作り出すための単なる透過型言語であり、唯一追加された機能は変数展開 (variable interpolation) だけです。</p>
<p>Cassius は単に Lucius の代替構文です。 内部では両者とも同じ処理エンジンを用いていますが、 Cassius のファイルは前処理の段階ででインデントを括弧に変換しています。 どちらを利用するかは純粋に構文の好みとなります。</p>
<h3 id="hamlet-html">Hamlet (HTML)</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">$</span><span class="er">doctype</span> <span class="er">5</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">&lt;html&gt;</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">        <span class="kw">&lt;title&gt;#{</span>pageTitle<span class="kw">}</span> - My Site</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">        <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">stylesheet</span><span class="ot"> href=</span><span class="kw">@{</span><span class="dt">Stylesheet</span><span class="kw">}&gt;</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">    <span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">        <span class="kw">&lt;h1 </span><span class="st">.page-title</span><span class="kw">&gt;#{</span>pageTitle<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">        <span class="kw">&lt;p&gt;</span>Here is a list of your friends:</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">        <span class="kw">$if</span> null friends</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">            <span class="kw">&lt;p&gt;</span>Sorry, I lied, you don't have any friends.</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">        <span class="kw">$else</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">            <span class="kw">&lt;ul&gt;</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">                <span class="kw">$forall</span> <span class="dt">Friend</span> name age <span class="ot">&lt;-</span> friends</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">                    <span class="kw">&lt;li&gt;#{</span>name<span class="kw">}</span> (<span class="kw">#{</span>age<span class="kw">}</span> years old)</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">        <span class="kw">&lt;footer&gt;^{</span>copyright<span class="kw">}</span></a></code></pre></div>
<h3 id="lucius-css">Lucius (CSS)</h3>
<pre class="lucius"><code>section.blog {
    padding: 1em;
    border: 1px solid #000;
    h1 {
        color: #{headingColor};
        background-image: url(@{MyBackgroundR});
    }
}</code></pre>
<h3 id="cassius-css">Cassius (CSS)</h3>
<p>上の Lucius の例と同じです。</p>
<pre class="cassius"><code>section.blog
    padding: 1em
    border: 1px solid #000
    h1
        color: #{headingColor}
        background-image: url(@{MyBackgroundR})</code></pre>
<h3 id="juliusjavascript">Julius(Javascript)</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode julius"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="at">$</span>(<span class="kw">function</span>()<span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">    <span class="at">$</span>(<span class="st">&quot;section.#{sectionClass}&quot;</span>).<span class="at">hide</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">    <span class="at">$</span>(<span class="st">&quot;#mybutton&quot;</span>).<span class="at">click</span>(<span class="kw">function</span>()<span class="op">{</span><span class="va">document</span>.<span class="at">location</span> <span class="op">=</span> <span class="st">&quot;@{SomeRouteR}&quot;</span><span class="op">;}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    <span class="op">^{</span>addBling<span class="op">}</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="型">型</h2>
<p>構文に入る前に関連する型をいろいろ見てみましょう。 導入部において型は XSS 攻撃の防止になると述べました。 例えば、誰かの名前を表示する次のような HTML テンプレートがあったとしましょう。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">&lt;p&gt;</span>Hello, my name is <span class="kw">#{</span>name<span class="kw">}</span></a></code></pre></div>
<p><code>#{...}</code> はシェイクスピアでは、変数展開となります。</p>
<p><code>name</code> では何が起こり、さらにそのデータ型は何であるべきでしょう？ よくある方法として <code>Text</code> の値をそのまま挿入することです。 しかし、そのようにすると <code>name</code> が次のような場合に非常に問題となります。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">'http://nefarious.com/evil.js'</span><span class="kw">&gt;&lt;/script&gt;</span></a></code></pre></div>
<p>このとき <code>&lt;</code> が <code>&amp;lt;</code> になるように <code>name</code> をエンティティエンコードしたいのですが、どうすれば良いでしょうか。</p>
<p>その場合のよくある方法は単に埋め込まれる全てのテキストをエンティティエンコードすることです。 もし、別の処理によって既に HTML が生成されていたとしたら何が起こるでしょうか？ 例えば、この Yesod のウェブサイトではすべての Hakell コードスニペットは適切な <code>span</code> タグで覆われることで色付けされています。 仮に全てをエンティティエスケープしたとすれば、コードスニペットはほとんど読めない状態となるでしょう。</p>
<p>そうならないように <code>Html</code> データ型を使います。2種類のAPIによって <code>Html</code> 型の値を生成する. <code>ToMarkup</code> 型クラスは <code>toHtml</code> 関数によって <code>String</code> と <code>Text</code> の値を <code>Html</code> の値に変換する方法を提供し、自動的に途中でエンティティエスケープを行います。</p>
<p>これは先ほどの <code>name</code> で利用したい方法です。 また、コードスニペットの例においては <code>preEscapedToMarkup</code> を利用するでしょう。</p>
<p>Hamlet (HTML シェイクスピア言語) の変数展開では、値に対し自動的に <code>toHtml</code> が適用されます。 したがって <code>String</code> を展開する場合はエンティティエスケープされますが、 <code>Html</code> の場合は何もしません。 コードスニペットの例においては <code>#{preEscapedToMarkup myHaskellHtml}</code> のようにして展開を行うでしょう。</p>
<p><code>Html</code> データ型は上に述べられた関数と共に blaze-html パッケージにより提供されます。 これによって Hamlet が他の blaze-html パッケージと相互作用することが可能になり、 blaze-html 値を生成するための一般的解決策ともなります。 さらには blaze-html の素晴らしいパフォーマンスの恩恵を得ることもできます。</p>
<p>同様に <code>CSS型 と ToCSS クラス</code>, <code>Javascript型 と ToJavascript クラス</code> が存在します。 これらは CSS で偶然 HTML を落とさないようにするためにコンパイル時におけるサニティーチェックを行います。</p>
<p>CSS 側における他の利点としては、色や単位に関するデータ型があることです。</p>
<pre class="lucius"><code>.red { color: #{colorRed} }</code></pre>
<p>さらなる詳細については Haddock文書を参照してください。</p>
<h2 id="type-safe-urls">Type-safe URLs</h2>
<p>おそらく Yesod における最も独特な機能は型安全URLであり、シェイクスピアにおいて扱うことができます。 使用法は変数展開とほとんど同じ、ハッシュ (#) の代わりにアットマーク (@) にするだけです。 構文は後で確認することにして、まずは直感的に理解しましょう。</p>
<p>まず、次のような2つのルートを持つアプリケーションがあるとしましょう。 <code>http://example.com/profile/home</code> はトップページで <code>http://example.com/display/time</code> は現在の時間を表示します。 ここで、トップページから time ページにリンクしたいとき、 URL を構築するためには3つの異なる方法が考えられます。</p>
<ol type="1">
<li>相対リンク: <strong><em>../display/time</em></strong></li>
<li>ドメイン無しの絶対リンク: <strong><em>/display/time</em></strong></li>
<li>ドメイン有りの絶対リンク: <code>http://example.com/display/time</code></li>
</ol>
<p>それぞれの方法において問題があります。 1つ目の方法はどちらかのURLが変化することでリンク切れになってしまいますし、全ての状況に適しているというわけではありません。 例えば RSS や Atom フィードには絶対URLが必要となります。 2つ目は1つ目の方法よりも変化に対し柔軟ではありますが、 RSS や Atom の問題は依然として存在する。 3つ目は全ての場合に有効ですが、ドメイン名が変わるごとに全ての URL を更新する必要が生じます。 そのようなことはそう頻繁には起こらないだろうと思うかもしれませんが、開発からステージングそして最終の本番サーバへの移行を考えてみてください。</p>
<p>しかしより重要なことはそれぞれの方法において、ひとつ非常に大きな問題があるということです。 それは、仮にルートを変更したとしてもコンパイラは壊れたリンクに対して警告をしないという点です。 誤植が大混乱を招くように、これは最悪な状況だということは言うまでもありません。</p>
<p>型安全URLの目的は人間の代わりにコンパイラにできる限り多くのチェックを行わせることです。 これを可能にするための最初のステップとしては、コンパイラが理解できない単純な文字列から離れ、正しく定義されたデータ型に変更することです。 今回の単純なアプリケーションではルートを直和型で表現します。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">data</span> <span class="dt">MyRoute</span> <span class="fu">=</span> <span class="dt">Home</span> <span class="fu">|</span> <span class="dt">Time</span></a></code></pre></div>
<p>テンプレートに /display/time のようなリンクを記述する代わりに <code>Time</code> コンストラクタを利用します。 しかし、そうすると HTML はデータ型ではなくテキストでできているため、これらの値をテキストに変換する方法が必要となります。 その変換を行う関数を URLレンダリング関数 (URL rendering function) と呼び、簡単な例を以下に示します。</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="ot">renderMyRoute ::</span> <span class="dt">MyRoute</span> <span class="ot">-&gt;</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">renderMyRoute <span class="dt">Home</span> <span class="fu">=</span> <span class="st">&quot;http://example.com/profile/home&quot;</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">renderMyRoute <span class="dt">Time</span> <span class="fu">=</span> <span class="st">&quot;http://example.com/display/time&quot;</span></a></code></pre></div>
<p>URLレンダリング関数は実際にはこれより少しだけ複雑です。 それらはクエリ文字列パラメータを追加し、コンストラクタのレコードを扱い、より高度にドメイン名を処理する必要があります。しかし、 Yesod は自動的にレンダ関数を生成するため実際にはこれらについて考える必要はありません。 唯一指摘すべきこととしてはクエリ文字列を扱うために、型シグネチャが実際にはもう少し複雑であることです。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">type</span> <span class="dt">Query</span> <span class="fu">=</span> [(<span class="dt">Text</span>, <span class="dt">Text</span>)]</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">type</span> <span class="dt">Render</span> url <span class="fu">=</span> url <span class="ot">-&gt;</span> <span class="dt">Query</span> <span class="ot">-&gt;</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="ot">renderMyRoute ::</span> <span class="dt">Render</span> <span class="dt">MyRoute</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">renderMyRoute <span class="dt">Home</span> _ <span class="fu">=</span> <span class="fu">...</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">renderMyRoute <span class="dt">Time</span> _ <span class="fu">=</span> <span class="fu">...</span></a></code></pre></div>
<p>こうしてレンダ関数が定義され、テンプレートに埋め込まれた型安全URLを使えるようになりました。 これは正確にはどのようにして上手く動作するのでしょうか？ <code>Html</code> (<code>CSS</code> や <code>Javascript</code>) 値を直接生成する代わりにテンプレート言語は関数を生成し、その関数はレンダ関数を取り HTML を生成します。 このことをより詳細に見るために Hamlet が表面下においてどのように動くかを軽く覗いてみましょう。 以下のテンプレートがあると仮定します。</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">&lt;a</span><span class="ot"> href=</span><span class="kw">@{</span><span class="dt">Time</span><span class="kw">}&gt;</span>The time</a></code></pre></div>
<p>これは、だいたい次のような Haskell コードに翻訳されます。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" data-line-number="1">\render <span class="ot">-&gt;</span> mconcat [<span class="st">&quot;&lt;a href='&quot;</span>, render <span class="dt">Time</span>, <span class="st">&quot;'&gt;The time&lt;/a&gt;&quot;</span>]</a></code></pre></div>
<h2 id="syntax">Syntax</h2>
<p>あらゆるシェイクスピアのテンプレート言語は同じ展開構文を備えているため、型安全URLを用いることができます。 それらは対象となる言語 (HTML、CSS、Javascript) 特有の構文とは異なります。 それぞれの言語を順番に見てみましょう。</p>
<h2 id="hamlet-syntax">Hamlet Syntax</h2>
<p>Hamlet はシェイクスピアの中でも最も洗練されたものです。 それは HTML 生成のための構文を提供するだけでなく、条件、ループ、maybe などの基本的な制御構造を備えます。</p>
<h3 id="tags">Tags</h3>
<p>タグがあらゆる HTML テンプレート言語において重要な役割を担うことは明らかです。 Hamlet においては、テンプレート言語を使いやすくするためにできる限り既存の HTML 構文に似せているが、ネスとの表現は閉じタグの代わりにインデントを利用する。 したがって、次のようなHTMLコードは</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">&lt;p&gt;</span>Some paragraph.<span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">&lt;ul&gt;</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="kw">&lt;li&gt;</span>Item 1<span class="kw">&lt;/li&gt;</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="kw">&lt;li&gt;</span>Item 2<span class="kw">&lt;/li&gt;</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="kw">&lt;/ul&gt;</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="kw">&lt;/body&gt;</span></a></code></pre></div>
<p>このような Hamlet コードに変換されます。 このような Hamlet コードに変換される.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">    <span class="kw">&lt;p&gt;</span>Some paragraph.</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">    <span class="kw">&lt;ul&gt;</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">        <span class="kw">&lt;li&gt;</span>Item 1</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">        <span class="kw">&lt;li&gt;</span>Item 2</a></code></pre></div>
<p>一般的に、この表記に一度慣れてしまえば通常のHTMLより解読がしやすくなると思います。 唯一の技巧的な部分はタグ前後の空白の扱いです。 例えば、次のようなHTMLを生成したいとしましょう。</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">&lt;p&gt;</span>Paragraph <span class="kw">&lt;i&gt;</span>italic<span class="kw">&lt;/i&gt;</span> end.<span class="kw">&lt;/p&gt;</span></a></code></pre></div>
<p>空白は “Paragraph” の後の部分や “end” の前の部分で保持されていて欲しいです。 そのために2つの単純なエスケープ文字を用います。</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">&lt;p&gt;</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">    Paragraph #</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">    <span class="kw">&lt;i&gt;</span>italic</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">    \ end.</a></code></pre></div>
<p>空白のエスケープ規則は実にシンプルです。</p>
<ol type="1">
<li>もし、行頭の文字が空白でなく、バックスラッシュであれば、そのバックスラッシュは無視される。(注意: これは、その行における全てのタグが単純なテキストとして処理されてしまう。)</li>
<li>もし、行末の文字がハッシュの場合それは無視されます</li>
</ol>
<p>もう一つ別のこととして Hamlet はコンテンツ内のエンティティをエスケープしません。 これによって既存の HTML のコピーが容易になります。 したがって。上の例は次のように書くこともできます。</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">&lt;p&gt;</span>Paragraph <span class="kw">&lt;i&gt;</span>italic&lt;/i&gt; end.</a></code></pre></div>
<p>Hamlet では開始タグは自動的に閉じられることに注意してください。 一方で内側の “i” タグはそうではありません。 どちらの方法もペナルティ無く自由に使うことができるため、好きな方を選択できます。 しかし Hamlet において閉じタグを用いる唯一の場面は、このようなインラインタグに限ることに注意してください。 インラインタグ以外で閉じタグを用いることはありません。</p>
<p>これによる他の結果としては、最初のタグより後に出現するタグはIDやクラスに関する特別な処理を行わないということです。 例えば、次の Hamlet スニペットは次のような HTML コードを生成します。</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">&lt;p </span><span class="er">#firstid</span><span class="kw">&gt;</span>Paragraph <span class="kw">&lt;i </span><span class="er">#secondid</span><span class="kw">&gt;</span>italic&lt;/i&gt; end.</a></code></pre></div>
<p>生成された HTML コード。</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">&lt;p</span><span class="ot"> id=</span><span class="st">&quot;firstid&quot;</span><span class="kw">&gt;</span>Paragraph <span class="kw">&lt;i</span><span class="ot"> #secondid</span><span class="kw">&gt;</span>italic<span class="kw">&lt;/i&gt;</span> end.<span class="kw">&lt;/p&gt;</span></a></code></pre></div>
<p><code>i</code> タグが単純なテキストとして処理される一方で <code>p</code>タグが自動的に閉じられ、その属性が特別扱いを受ける点に注意してください。</p>
<h3 id="interpolation">Interpolation</h3>
<p>ここまで出てきたものは簡潔な HTML であるため何の問題も起こっていませんが、まだ Haskell コードと相互作用することはできていません。 どのようにして変数を受け渡すのでしょうか？ それは単純に展開を利用します。</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2">    <span class="kw">&lt;title&gt;#{</span>title<span class="kw">}</span></a></code></pre></div>
<p>ハッシュの後ろに波括弧のペアが続く場合は変数展開 (variable interpolation) です。 上の例においてはテンプレートが呼ばれたスコープで <code>title</code> 変数が用いられます。 そのことを次のように言い直せます。 Hamlet は変数が呼ばれた際に自動的にスコープ内の変数へアクセスし、特に変数を受け渡す必要はありません。</p>
<p>展開の中では関数適用、文字列、数値リテラル、修飾付きモジュールを利用することができます。 また、処理をまとめるために丸括弧やドルマークを用いることができます。 展開の処理の最後に <code>toHtml</code> 関数が適用されます。 これは <code>ToHtml</code> クラスの全てのインスタンスが展開可能だということを意味します。 例えば、次のコードを考えてみましょう。</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co">-- Just ignore the quasiquote stuff for now, and that shamlet thing.</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="co">-- It will be explained later.</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="ot">{-# LANGUAGE QuasiQuotes #-}</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="kw">import</span> <span class="dt">Text.Hamlet</span> (shamlet)</a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="kw">import</span> <span class="dt">Text.Blaze.Html.Renderer.String</span> (renderHtml)</a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="kw">import</span> <span class="dt">Data.Char</span> (toLower)</a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="kw">import</span> <span class="dt">Data.List</span> (sort)</a>
<a class="sourceLine" id="cb21-8" data-line-number="8"></a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="kw">data</span> <span class="dt">Person</span> <span class="fu">=</span> <span class="dt">Person</span></a>
<a class="sourceLine" id="cb21-10" data-line-number="10">    {<span class="ot"> name ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb21-11" data-line-number="11">    ,<span class="ot"> age  ::</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb21-12" data-line-number="12">    }</a>
<a class="sourceLine" id="cb21-13" data-line-number="13"></a>
<a class="sourceLine" id="cb21-14" data-line-number="14"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb21-15" data-line-number="15">main <span class="fu">=</span> putStrLn <span class="fu">$</span> renderHtml [shamlet|</a>
<a class="sourceLine" id="cb21-16" data-line-number="16"><span class="kw">&lt;p&gt;</span>Hello, my name is <span class="kw">#{</span>name person<span class="kw">}</span> and I am <span class="kw">#{</span>show <span class="fu">$</span> age person<span class="kw">}</span>.</a>
<a class="sourceLine" id="cb21-17" data-line-number="17"><span class="kw">&lt;p&gt;</span></a>
<a class="sourceLine" id="cb21-18" data-line-number="18">    Let's do some funny stuff with my name: #</a>
<a class="sourceLine" id="cb21-19" data-line-number="19">    <span class="kw">&lt;b&gt;#{</span>sort <span class="fu">$</span> map toLower (name person)<span class="kw">}</span></a>
<a class="sourceLine" id="cb21-20" data-line-number="20"><span class="kw">&lt;p&gt;</span>Oh, and in 5 years I'll be <span class="kw">#{</span>show ((<span class="fu">+</span>) <span class="dv">5</span> (age person))<span class="kw">}</span> years old.</a>
<a class="sourceLine" id="cb21-21" data-line-number="21">|]</a>
<a class="sourceLine" id="cb21-22" data-line-number="22">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb21-23" data-line-number="23">    person <span class="fu">=</span> <span class="dt">Person</span> <span class="st">&quot;Michael&quot;</span> <span class="dv">26</span></a></code></pre></div>
<p>目玉機能の型安全URLについてはどうでしょうか？ それらはシャープの代わりにアットマーク (@) で始まる点を除いて、あらゆる面で変数展開と同一です。 さらにキャレット (^) によって同じ型の他のテンプレートを埋め込むことが可能になります。 次のコード例で確認しましょう。</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="ot">{-# LANGUAGE QuasiQuotes #-}</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="kw">import</span> <span class="dt">Text.Hamlet</span> (<span class="dt">HtmlUrl</span>, hamlet)</a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="kw">import</span> <span class="dt">Text.Blaze.Html.Renderer.String</span> (renderHtml)</a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="kw">import</span> <span class="dt">Data.Text</span> (<span class="dt">Text</span>)</a>
<a class="sourceLine" id="cb22-6" data-line-number="6"></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="kw">data</span> <span class="dt">MyRoute</span> <span class="fu">=</span> <span class="dt">Home</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="ot">render ::</span> <span class="dt">MyRoute</span> <span class="ot">-&gt;</span> [(<span class="dt">Text</span>, <span class="dt">Text</span>)] <span class="ot">-&gt;</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb22-10" data-line-number="10">render <span class="dt">Home</span> _ <span class="fu">=</span> <span class="st">&quot;/home&quot;</span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"></a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="ot">footer ::</span> <span class="dt">HtmlUrl</span> <span class="dt">MyRoute</span></a>
<a class="sourceLine" id="cb22-13" data-line-number="13">footer <span class="fu">=</span> [hamlet|</a>
<a class="sourceLine" id="cb22-14" data-line-number="14"><span class="kw">&lt;footer&gt;</span></a>
<a class="sourceLine" id="cb22-15" data-line-number="15">    Return to #</a>
<a class="sourceLine" id="cb22-16" data-line-number="16">    <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="kw">@{</span><span class="dt">Home</span><span class="kw">}&gt;</span>Homepage</a>
<a class="sourceLine" id="cb22-17" data-line-number="17">    .</a>
<a class="sourceLine" id="cb22-18" data-line-number="18">|]</a>
<a class="sourceLine" id="cb22-19" data-line-number="19"></a>
<a class="sourceLine" id="cb22-20" data-line-number="20"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb22-21" data-line-number="21">main <span class="fu">=</span> putStrLn <span class="fu">$</span> renderHtml <span class="fu">$</span> [hamlet|</a>
<a class="sourceLine" id="cb22-22" data-line-number="22"><span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb22-23" data-line-number="23">    <span class="kw">&lt;p&gt;</span>This is my page.</a>
<a class="sourceLine" id="cb22-24" data-line-number="24">    <span class="kw">^{</span>footer<span class="kw">}</span></a>
<a class="sourceLine" id="cb22-25" data-line-number="25">|] render</a></code></pre></div>
<p>さらに、クエリ文字列パラメータを受け入れるような URL 展開の変種があり、これは例えばページ番号をつけるようなレスポンスに適しています。 <code>@{...}</code> を用いる代わりにクエスチョンマークを加え <code>@?{...}</code> とすることで、クエリ文字列の存在を示します。 与える値は2要素のタプルである必要があり、第1要素が型安全URL、第2要素はクエリ文字列パラメータのリストのペアとなります。 例えば、次のコードスニペットの例を見てみましょう。</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="ot">{-# LANGUAGE QuasiQuotes #-}</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="kw">import</span> <span class="dt">Text.Hamlet</span> (<span class="dt">HtmlUrl</span>, hamlet)</a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="kw">import</span> <span class="dt">Text.Blaze.Html.Renderer.String</span> (renderHtml)</a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="kw">import</span> <span class="dt">Data.Text</span> (<span class="dt">Text</span>, append, pack)</a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="kw">import</span> <span class="dt">Control.Arrow</span> (second)</a>
<a class="sourceLine" id="cb23-7" data-line-number="7"><span class="kw">import</span> <span class="dt">Network.HTTP.Types</span> (renderQueryText)</a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="kw">import</span> <span class="dt">Data.Text.Encoding</span> (decodeUtf8)</a>
<a class="sourceLine" id="cb23-9" data-line-number="9"><span class="kw">import</span> <span class="dt">Blaze.ByteString.Builder</span> (toByteString)</a>
<a class="sourceLine" id="cb23-10" data-line-number="10"></a>
<a class="sourceLine" id="cb23-11" data-line-number="11"><span class="kw">data</span> <span class="dt">MyRoute</span> <span class="fu">=</span> <span class="dt">SomePage</span></a>
<a class="sourceLine" id="cb23-12" data-line-number="12"></a>
<a class="sourceLine" id="cb23-13" data-line-number="13"><span class="ot">render ::</span> <span class="dt">MyRoute</span> <span class="ot">-&gt;</span> [(<span class="dt">Text</span>, <span class="dt">Text</span>)] <span class="ot">-&gt;</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb23-14" data-line-number="14">render <span class="dt">SomePage</span> params <span class="fu">=</span> <span class="st">&quot;/home&quot;</span> <span class="ot">`append`</span></a>
<a class="sourceLine" id="cb23-15" data-line-number="15">    decodeUtf8 (toByteString <span class="fu">$</span> renderQueryText <span class="dt">True</span> (map (second <span class="dt">Just</span>) params))</a>
<a class="sourceLine" id="cb23-16" data-line-number="16"></a>
<a class="sourceLine" id="cb23-17" data-line-number="17"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb23-18" data-line-number="18">main <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb23-19" data-line-number="19">    <span class="kw">let</span> currPage <span class="fu">=</span> <span class="dv">2</span><span class="ot"> ::</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb23-20" data-line-number="20">    putStrLn <span class="fu">$</span> renderHtml <span class="fu">$</span> [hamlet|</a>
<a class="sourceLine" id="cb23-21" data-line-number="21"><span class="kw">&lt;p&gt;</span></a>
<a class="sourceLine" id="cb23-22" data-line-number="22">    You are currently on page <span class="kw">#{</span>currPage<span class="kw">}</span>.</a>
<a class="sourceLine" id="cb23-23" data-line-number="23">    <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">@?{(SomePage,</span><span class="kw"> </span><span class="er">[(&quot;page&quot;,</span><span class="ot"> pack </span><span class="er">$</span><span class="ot"> </span><span class="er">show</span><span class="ot"> </span><span class="er">$</span><span class="ot"> </span><span class="er">currPage</span><span class="ot"> </span><span class="er">-</span><span class="ot"> </span><span class="er">1)])}</span><span class="kw">&gt;</span>Previous</a>
<a class="sourceLine" id="cb23-24" data-line-number="24">    <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">@?{(SomePage,</span><span class="kw"> </span><span class="er">[(&quot;page&quot;,</span><span class="ot"> pack </span><span class="er">$</span><span class="ot"> </span><span class="er">show</span><span class="ot"> </span><span class="er">$</span><span class="ot"> </span><span class="er">currPage</span><span class="ot"> </span><span class="er">+</span><span class="ot"> </span><span class="er">1)])}</span><span class="kw">&gt;</span>Next</a>
<a class="sourceLine" id="cb23-25" data-line-number="25">|] render</a></code></pre></div>
<p>これは、次のようなHTMLを生成します。</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">&lt;p&gt;</span>You are currently on page 2.</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;/home?page=1&quot;</span><span class="kw">&gt;</span>Previous<span class="kw">&lt;/a&gt;</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;/home?page=3&quot;</span><span class="kw">&gt;</span>Next<span class="kw">&lt;/a&gt;</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4"><span class="kw">&lt;/p&gt;</span></a></code></pre></div>
<h3 id="attributes">Attributes</h3>
<p>前の最後の例では “a” タグに href 属性を付加しました。 構文について詳細に見てみましょう。</p>
<ul>
<li>属性の値にも変数展開記法が利用できます</li>
<li>HTML と同様に属性のイコール記号と値はオプションです。したがって <code>&lt;input type=checkbox checked&gt;</code> は完全に妥当です</li>
<li>id と class 属性についてはそれぞれハッシュ (#) と ピリオド (.) を用います。つまり <code>&lt;p #paragraphid .class1 .class2&gt;</code> という感じです</li>
<li>属性値の前後のクォートは任意ですが、途中でスペースを用いる場合は必要です</li>
<li>コロンを利用することでオプションの属性を追加できます。isChecked の値が True の場合のみチェックボックスをチェックした状態にしたい場合 <code>&lt;input type=checkbox :isChecked:checked&gt;</code> とします。また、ある段落の文字色を赤色にしたい場合は <code>&lt;p :isRed:style=&quot;color:red&quot;&gt;</code> とします。(これはクラス名を用いても良いです。例えば、 <code>&lt;p :isCurrent:.current&gt;</code> は isCurrent が <code>True</code> の場合, <code>current</code> クラスをセットします)</li>
<li>任意のキーと値のペアもまた <code>*{...}</code> 構文を用いて展開が可能です。属性の場合の変数展開は値が String または Text のタプルか, タプルのリストである必要があります。例えば <code>attrs = [(&quot;foo&quot;, &quot;bar&quot;)]</code> という値であれば展開可能です。</li>
</ul>
<h3 id="conditionals">Conditionals</h3>
<p>いつかはページ内に何らかのロジックを組み込みたいと思うでしょう。 Hamlet の目的はロジックを可能な限り最小にすることで Haskell に大部分を任せることです。 そのようなものとして <code>if</code>、 <code>ifelse</code>、 <code>else</code> は非常に基本的な論理文 (logical statements) です。</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">$if</span> isAdmin</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">    <span class="kw">&lt;p&gt;</span>Welcome to the admin section.</a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="kw">$elseif</span> isLoggedIn</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">    <span class="kw">&lt;p&gt;</span>You are not the administrator.</a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="kw">$else</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6">    <span class="kw">&lt;p&gt;</span>I don't know who you are. Please log in so I can decide if you get access.</a></code></pre></div>
<p>通常の展開と同じ規則が条件文にも当てはまります。</p>
<h3 id="maybe">Maybe</h3>
<p>同様に Maybe 値を扱うための特別な記法があります。 技術的には <code>if</code>、 <code>isJust</code>、 <code>fromJust</code> を用いることで処理されますが、部分関数は避けることができるため、よく使われます。</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">$maybe</span> name <span class="ot">&lt;-</span> maybeName</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">    <span class="kw">&lt;p&gt;</span>Your name is <span class="kw">#{</span>name<span class="kw">}</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="kw">$nothing</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4">    <span class="kw">&lt;p&gt;</span>I don't know your name.</a></code></pre></div>
<p>単純な識別子に加え、コンストラクタやタプルなど、より複雑な値を左辺に用いることができます。</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">$maybe</span> <span class="dt">Person</span> firstName lastName <span class="ot">&lt;-</span> maybePerson</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">    <span class="kw">&lt;p&gt;</span>Your name is <span class="kw">#{</span>firstName<span class="kw">}</span> <span class="kw">#{</span>lastName<span class="kw">}</span></a></code></pre></div>
<p>右辺は展開と同じ規則に従い、変数や関数適用などが使えます。</p>
<h3 id="forall">Forall</h3>
<p>リストのループについてはどうでしょうか？ 以下のようにするだけです。</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">$if</span> null people</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">    <span class="kw">&lt;p&gt;</span>No people.</a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="kw">$else</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4">    <span class="kw">&lt;ul&gt;</span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5">        <span class="kw">$forall</span> person <span class="ot">&lt;-</span> people</a>
<a class="sourceLine" id="cb28-6" data-line-number="6">            <span class="kw">&lt;li&gt;#{</span>person<span class="kw">}</span></a></code></pre></div>
<h3 id="case">Case</h3>
<p>パターンマッチは Haskell の重要な強みの1つです。 直和型は多くの実務的な型をきれいにモデル化することができ <code>case</code> 文を利用すると安全にマッチさせることができます。 つまりどのケースにも当てはまらない場合にコンパイルは警告を出します。 Hamlet の case 文も同じように働きます。</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">$</span><span class="er">case</span> <span class="er">foo</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2">    <span class="kw">$</span><span class="er">of</span> <span class="er">Left</span> <span class="er">bar</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3">        <span class="kw">&lt;p&gt;</span>It was left: <span class="kw">#{</span>bar<span class="kw">}</span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4">    <span class="kw">$</span><span class="er">of</span> <span class="er">Right</span> <span class="er">baz</span></a>
<a class="sourceLine" id="cb29-5" data-line-number="5">        <span class="kw">&lt;p&gt;</span>It was right: <span class="kw">#{</span>baz<span class="kw">}</span></a></code></pre></div>
<h3 id="with">With</h3>
<p>文を短くするために <code>with</code> を利用します。 基本的には長い式に対して、単なる利便性のためのエイリアス宣言となります。</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">$</span><span class="er">with</span> <span class="er">foo</span> <span class="er">&lt;-</span> <span class="er">some</span> <span class="er">very</span> <span class="er">(long</span> <span class="er">ugly)</span> <span class="er">expression</span> <span class="er">that</span> <span class="er">$</span> <span class="er">should</span> <span class="er">only</span> <span class="er">$</span> <span class="er">happen</span> <span class="er">once</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2">    <span class="kw">&lt;p&gt;</span>But I'm going to use <span class="kw">#{</span>foo<span class="kw">}</span> multiple times. <span class="kw">#{</span>foo<span class="kw">}</span></a></code></pre></div>
<h3 id="doctype">Doctype</h3>
<p>最後はちょっとした糖衣構文の doctype 文です。 <code>dectype</code> は複数の異なるバージョンがサポートされていますが、現代のウェブアプリケーションにおいては <code>$doctype 5</code> が推奨され、これは <code>&lt;!DOCTYPE html&gt;</code> を生成します。</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">$</span><span class="er">doctype</span> <span class="er">5</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="kw">&lt;html&gt;</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3">    <span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4">        <span class="kw">&lt;title&gt;</span>Hamlet is Awesome</a>
<a class="sourceLine" id="cb31-5" data-line-number="5">    <span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb31-6" data-line-number="6">        <span class="kw">&lt;p&gt;</span>All done.</a></code></pre></div>
<p>まだサポートされているこれよりも古い構文として3つのエクスクラメーション (!!!) があり、時にはこのようなコードを見かけるかもしれません。 この形式を削除する予定はありませんが、一般的に <code>doctype</code> による方法がより読みやすいと思います。</p>
<h2 id="lucius-syntax">Lucius Syntax</h2>
<p>Lucius はシェイクスピアに2種類存在する CSS テンプレート言語のうちの一つです。 これは CSS のスーパーセットであることを意図しているため、既存の構文よりも機能が豊富です。</p>
<ul>
<li>Hamlet のように変数と URL の展開が可能です</li>
<li>CSS のブロックはネストが可能です</li>
<li>テンプレートで変数宣言が可能です</li>
<li>複合的な CSS プロパティはミックスイン (mixin) として作り、複数の宣言で再利用することが可能です</li>
</ul>
<p>CSS ブロックのネストから説明を始めましょう。 <code>article</code> 内部の複数のタグで特別なスタイルを適用させたいとします。 普通の CSS では次のように書くでしょう。</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode css"><code class="sourceCode css"><a class="sourceLine" id="cb32-1" data-line-number="1">article code { <span class="kw">background-color</span>: grey; }</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">article p { <span class="kw">text-indent</span>: <span class="dv">2em</span>; }</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">article a { <span class="kw">text-decoration</span>: <span class="dv">none</span>; }</a>
<a class="sourceLine" id="cb32-4" data-line-number="4">article a &gt; h1 { <span class="kw">color</span>: <span class="dv">green</span>; }</a></code></pre></div>
<p>上記のコードは記述量は少ないですが article を何度も打たなければならないため多少不快ですし、もしそれが何十個もあったらどうでしょうか。 世界一悪い事ではないにしても少し嫌です。 Lucius はこのような場面で役立ちます。</p>
<pre class="lucius"><code>article {
    code { background-color: grey; }
    p { text-indent: 2em; }
    a { text-decoration: none; }
    &gt; h1 { color: green; }
}</code></pre>
<p>Lucius 変数を使えば繰り返しを避けることができます。 単純な例として共通の文字色を定義してみましょう。</p>
<pre class="lucius"><code>@textcolor: #ccc; /* just because we hate our users */
body { color: #{textcolor} }
a:link, a:visited { color: #{textcolor} }</code></pre>
<p>ミックスインは Lucius において比較的新しく追加されたものです。 アイデアとしてはプロパティの集合を与える mixin を宣言して、キャレット展開(^)を用いることで、そのミックスインをテンプレートに埋め込みます。 次の例はミックスインを利用してベンダープレフィックスを扱う方法を示すコードです。</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="ot">{-# LANGUAGE QuasiQuotes #-}</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="kw">import</span> <span class="dt">Text.Lucius</span></a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Text.Lazy.IO</span> <span class="kw">as</span> <span class="dt">TLIO</span></a>
<a class="sourceLine" id="cb35-4" data-line-number="4"></a>
<a class="sourceLine" id="cb35-5" data-line-number="5"><span class="co">-- Dummy render function.</span></a>
<a class="sourceLine" id="cb35-6" data-line-number="6">render <span class="fu">=</span> undefined</a>
<a class="sourceLine" id="cb35-7" data-line-number="7"></a>
<a class="sourceLine" id="cb35-8" data-line-number="8"><span class="co">-- Our mixin, which provides a number of vendor prefixes for transitions.</span></a>
<a class="sourceLine" id="cb35-9" data-line-number="9">transition val <span class="fu">=</span></a>
<a class="sourceLine" id="cb35-10" data-line-number="10">    [luciusMixin|</a>
<a class="sourceLine" id="cb35-11" data-line-number="11">        -webkit-transition: #{val};</a>
<a class="sourceLine" id="cb35-12" data-line-number="12">        -moz-transition: #{val};</a>
<a class="sourceLine" id="cb35-13" data-line-number="13">        -ms-transition: #{val};</a>
<a class="sourceLine" id="cb35-14" data-line-number="14">        -o-transition: #{val};</a>
<a class="sourceLine" id="cb35-15" data-line-number="15">        transition: #{val};</a>
<a class="sourceLine" id="cb35-16" data-line-number="16">    |]</a>
<a class="sourceLine" id="cb35-17" data-line-number="17"></a>
<a class="sourceLine" id="cb35-18" data-line-number="18"><span class="co">-- Our actual Lucius template, which uses the mixin.</span></a>
<a class="sourceLine" id="cb35-19" data-line-number="19">myCSS <span class="fu">=</span></a>
<a class="sourceLine" id="cb35-20" data-line-number="20">    [lucius|</a>
<a class="sourceLine" id="cb35-21" data-line-number="21">        .some-class {</a>
<a class="sourceLine" id="cb35-22" data-line-number="22">            ^{transition &quot;all 4s ease&quot;}</a>
<a class="sourceLine" id="cb35-23" data-line-number="23">        }</a>
<a class="sourceLine" id="cb35-24" data-line-number="24">    |]</a>
<a class="sourceLine" id="cb35-25" data-line-number="25"></a>
<a class="sourceLine" id="cb35-26" data-line-number="26">main <span class="fu">=</span> TLIO.putStrLn <span class="fu">$</span> renderCss <span class="fu">$</span> myCSS render</a></code></pre></div>
<h2 id="cassius-syntax">Cassius Syntax</h2>
<p>Cassius と Lucius の違いは空白の扱いだけです。 概要の部分で述べたように、これは Lucius と同じ処理エンジンを用いていますが、サブブロックを閉じるための波括弧や行末を表すセミコロンを挿入するための前処理を行います。 これは Cassius を実行する際に Lucius のすべての機能を用いることができることを意味します。 以下は素朴な例です。</p>
<pre class="cassius"><code>#banner
    border: 1px solid #{bannerColor}
    background-image: url(@{BannerImageR})</code></pre>
<h2 id="julius-syntax">Julius Syntax</h2>
<p>Julius は本章で論じられた言語の中で最も単純です。 実際に単なる Javascript であるという人もいるかもしれません。 Julius ではこれまで述べた3種類の展開方法が利用可能ですが、それ以外については中身に何の変化も与えません。</p>
<p>Julius を scaffolded Yesod サイトで用いる場合 Javascript が自動的に圧縮されていることに気づくでしょう。 これは Julius の機能ではなく Yesod が Julius の出力ファイルを圧縮するために hjsmin パッケージを用いているためです。</p>
<h2 id="calling-shakespeare">Calling Shakespeare</h2>
<p>もちろんある点において疑問が生じるでしょう。 実際にどのようにしてこれらのものを動かすのでしょうか？ Haskell コードからシェイクスピアを呼び出す3つの異なる方法が存在します。</p>
<h3 id="quasiquotes">Quasiquotes</h3>
<p>準クォートを用いることで任意のコンテンツを Haskell コードに埋め込み、コンパイル時に Haskell コードへ変換することが可能となります。</p>
<h3 id="external-file">External file</h3>
<p>外部ファイルの場合、テンプレートコードは別のファイルにあり Template Haskell を通して参照されます。</p>
<h3 id="reload-mode">Reload mode</h3>
<p>上の両者は何か変更を加えると完全な再コンパイルが必要となります。 リロードモードにおいてはテンプレートは別のファイルにあり Template Haskell を用いて参照します。 しかし、実行時に外部ファイルは毎回最初から再パーズされます。</p>
<p>リロードモードは Hamlet では用いることができず Cassius、 Lucius、 Julius のみ利用可能です。 Hamlet には Haskell コンパイラに直接依存し、実行時にうまく再実装できないようなあまりにも多くの洗練された側面があるからです。</p>
<p>本番環境では、はじめの2つの方法の内どちらかを用いることが可能です。 両者共に、テンプレート全体を最終的な実行ファイルに埋め込み、デプロイメントを簡易にすることでパフォーマンスを向上させます。 準クォートの利点は全てが単一ファイルに存在するという簡潔さにあります。そのため、短いテンプレートであれば準クォートが適しています。 しかし、一般的には次のような理由で外部ファイルによる方法が推薦されます。</p>
<ul>
<li>ロジックとデザインの分離という伝統にとても従っている</li>
<li>簡単なCPPマクロを用いて外部ファイルとデバッグモードを容易に変更可能です。これにより、迅速な開発と本番環境における高いパフォーマンスが達成可能になる。</li>
</ul>
<p>これらは特別な準クォートと Template Haskell 関数であるため、適切な言語拡張を有効にし正しい構文を用いる必要があります。 次のコードスニペットにおいてそれぞれの簡単な例を見て見ましょう。</p>
<h2 id="quasiquoter">Quasiquoter</h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span> <span class="co">-- we're using Text below</span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="ot">{-# LANGUAGE QuasiQuotes #-}</span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="kw">import</span> <span class="dt">Text.Hamlet</span> (<span class="dt">HtmlUrl</span>, hamlet)</a>
<a class="sourceLine" id="cb37-4" data-line-number="4"><span class="kw">import</span> <span class="dt">Data.Text</span> (<span class="dt">Text</span>)</a>
<a class="sourceLine" id="cb37-5" data-line-number="5"><span class="kw">import</span> <span class="dt">Text.Blaze.Html.Renderer.String</span> (renderHtml)</a>
<a class="sourceLine" id="cb37-6" data-line-number="6"></a>
<a class="sourceLine" id="cb37-7" data-line-number="7"><span class="kw">data</span> <span class="dt">MyRoute</span> <span class="fu">=</span> <span class="dt">Home</span> <span class="fu">|</span> <span class="dt">Time</span> <span class="fu">|</span> <span class="dt">Stylesheet</span></a>
<a class="sourceLine" id="cb37-8" data-line-number="8"></a>
<a class="sourceLine" id="cb37-9" data-line-number="9"><span class="ot">render ::</span> <span class="dt">MyRoute</span> <span class="ot">-&gt;</span> [(<span class="dt">Text</span>, <span class="dt">Text</span>)] <span class="ot">-&gt;</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb37-10" data-line-number="10">render <span class="dt">Home</span> _ <span class="fu">=</span> <span class="st">&quot;/home&quot;</span></a>
<a class="sourceLine" id="cb37-11" data-line-number="11">render <span class="dt">Time</span> _ <span class="fu">=</span> <span class="st">&quot;/time&quot;</span></a>
<a class="sourceLine" id="cb37-12" data-line-number="12">render <span class="dt">Stylesheet</span> _ <span class="fu">=</span> <span class="st">&quot;/style.css&quot;</span></a>
<a class="sourceLine" id="cb37-13" data-line-number="13"></a>
<a class="sourceLine" id="cb37-14" data-line-number="14"><span class="ot">template ::</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">HtmlUrl</span> <span class="dt">MyRoute</span></a>
<a class="sourceLine" id="cb37-15" data-line-number="15">template title <span class="fu">=</span> [hamlet|</a>
<a class="sourceLine" id="cb37-16" data-line-number="16"><span class="kw">$</span><span class="er">doctype</span> <span class="er">5</span></a>
<a class="sourceLine" id="cb37-17" data-line-number="17"><span class="kw">&lt;html&gt;</span></a>
<a class="sourceLine" id="cb37-18" data-line-number="18">    <span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb37-19" data-line-number="19">        <span class="kw">&lt;title&gt;#{</span>title<span class="kw">}</span></a>
<a class="sourceLine" id="cb37-20" data-line-number="20">        <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">stylesheet</span><span class="ot"> href=</span><span class="kw">@{</span><span class="dt">Stylesheet</span><span class="kw">}&gt;</span></a>
<a class="sourceLine" id="cb37-21" data-line-number="21">    <span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb37-22" data-line-number="22">        <span class="kw">&lt;h1&gt;#{</span>title<span class="kw">}</span></a>
<a class="sourceLine" id="cb37-23" data-line-number="23">|]</a>
<a class="sourceLine" id="cb37-24" data-line-number="24"></a>
<a class="sourceLine" id="cb37-25" data-line-number="25"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb37-26" data-line-number="26">main <span class="fu">=</span> putStrLn <span class="fu">$</span> renderHtml <span class="fu">$</span> template <span class="st">&quot;My Title&quot;</span> render</a></code></pre></div>
<h2 id="external-file-1">External file</h2>
<div class="sourceCode" id="cb38"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span> <span class="co">-- we're using Text below</span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="ot">{-# LANGUAGE TemplateHaskell #-}</span></a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="ot">{-# LANGUAGE CPP #-}</span> <span class="co">-- to control production versus debug</span></a>
<a class="sourceLine" id="cb38-4" data-line-number="4"><span class="kw">import</span> <span class="dt">Text.Lucius</span> (<span class="dt">CssUrl</span>, luciusFile, luciusFileReload, renderCss)</a>
<a class="sourceLine" id="cb38-5" data-line-number="5"><span class="kw">import</span> <span class="dt">Data.Text</span> (<span class="dt">Text</span>)</a>
<a class="sourceLine" id="cb38-6" data-line-number="6"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Text.Lazy.IO</span> <span class="kw">as</span> <span class="dt">TLIO</span></a>
<a class="sourceLine" id="cb38-7" data-line-number="7"></a>
<a class="sourceLine" id="cb38-8" data-line-number="8"><span class="kw">data</span> <span class="dt">MyRoute</span> <span class="fu">=</span> <span class="dt">Home</span> <span class="fu">|</span> <span class="dt">Time</span> <span class="fu">|</span> <span class="dt">Stylesheet</span></a>
<a class="sourceLine" id="cb38-9" data-line-number="9"></a>
<a class="sourceLine" id="cb38-10" data-line-number="10"><span class="ot">render ::</span> <span class="dt">MyRoute</span> <span class="ot">-&gt;</span> [(<span class="dt">Text</span>, <span class="dt">Text</span>)] <span class="ot">-&gt;</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb38-11" data-line-number="11">render <span class="dt">Home</span> _ <span class="fu">=</span> <span class="st">&quot;/home&quot;</span></a>
<a class="sourceLine" id="cb38-12" data-line-number="12">render <span class="dt">Time</span> _ <span class="fu">=</span> <span class="st">&quot;/time&quot;</span></a>
<a class="sourceLine" id="cb38-13" data-line-number="13">render <span class="dt">Stylesheet</span> _ <span class="fu">=</span> <span class="st">&quot;/style.css&quot;</span></a>
<a class="sourceLine" id="cb38-14" data-line-number="14"></a>
<a class="sourceLine" id="cb38-15" data-line-number="15"><span class="ot">template ::</span> <span class="dt">CssUrl</span> <span class="dt">MyRoute</span></a>
<a class="sourceLine" id="cb38-16" data-line-number="16"><span class="ot">#if PRODUCTION</span></a>
<a class="sourceLine" id="cb38-17" data-line-number="17">template <span class="fu">=</span> <span class="fu">$</span>(luciusFile <span class="st">&quot;template.lucius&quot;</span>)</a>
<a class="sourceLine" id="cb38-18" data-line-number="18"><span class="ot">#else</span></a>
<a class="sourceLine" id="cb38-19" data-line-number="19">template <span class="fu">=</span> <span class="fu">$</span>(luciusFileReload <span class="st">&quot;template.lucius&quot;</span>)</a>
<a class="sourceLine" id="cb38-20" data-line-number="20"><span class="ot">#endif</span></a>
<a class="sourceLine" id="cb38-21" data-line-number="21"></a>
<a class="sourceLine" id="cb38-22" data-line-number="22"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb38-23" data-line-number="23">main <span class="fu">=</span> TLIO.putStrLn <span class="fu">$</span> renderCss <span class="fu">$</span> template render</a></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="co">-- @template.lucius</span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2">foo { bar<span class="fu">:</span> baz }</a></code></pre></div>
<p>これら関数の命名規則には次のような一貫性があります。</p>
<table>
<thead>
<tr class="header">
<th>テンプレート言語</th>
<th>準クォート</th>
<th>外部ファイル</th>
<th>リロード</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Hamlet</td>
<td><code>hamlet</code></td>
<td><code>hamletFile</code></td>
<td><strong><em>N/A</em></strong></td>
</tr>
<tr class="even">
<td>Cassius</td>
<td><code>cassius</code></td>
<td><code>cassiusFile</code></td>
<td><code>cassiusFileReload</code></td>
</tr>
<tr class="odd">
<td>Lucius</td>
<td><code>lucius</code></td>
<td><code>luciusFile</code></td>
<td><code>luciusFileReload</code></td>
</tr>
<tr class="even">
<td>Julius</td>
<td><code>julius</code></td>
<td><code>JuliusFile</code></td>
<td><code>JuliusFileReload</code></td>
</tr>
</tbody>
</table>
<h2 id="alternate-hamlet-types">Alternate Hamlet Types</h2>
<p>これまでのところ型安全URLが埋め込まれた HTML の断片のような Hamlet から <code>HtmlUrl</code> の値を生成する方法を見てきました。 その他にも Halmet を用いて生成できる値が3つあります。 単純な HTML、 URLと国際化されたメッセージを持ったHTML、 そしてウィジェットです。 ウィジェットについてはウィジェットの章において詳細を説明します。</p>
<p>URLの埋め込まれていない単純な HTML を生成するために “純粋なHamlet” (simplified Hamlet) を用います。 ここにはいくつかの変更点があります。</p>
<ul>
<li>接頭辞に “s” が付く異なる種類の関数を利用します。したがって準クォートは <code>shamlet</code>、外部ファイルは <code>shamletFile</code> となります。これらをどのように発音するかについてはいまだ論争中です</li>
<li>URL 展開は許可されないため、コンパイル時エラーとなります</li>
<li>埋め込み (キャレット展開) はもはや <code>HtmlUrl</code> 値を許可しません。ルールとして埋め込み値はテンプレートそれ自体と同じ型を持つ必要があるため, この場合は <code>Html</code> でなければなりません。このことは <code>shamlet</code> において埋め込みは (ハッシュを用いた) 通常の変数展開で完全に置き換え可能であることを意味します。</li>
</ul>
<p>Hamlet の国際化 (i18) に対処することは多少複雑です。 Hamlet はメッセージデータ型により i18n をサポートします。 それは概念・実装面において型安全URLとかなり類似しています。 動機付けのための例として hello と言った後にいくつのりんごを食べたかを述べるアプリケーションを作りたいとしましょう。 これらのメッセージをデータ型を用いて以下のように表現します。</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="kw">data</span> <span class="dt">Msg</span> <span class="fu">=</span> <span class="dt">Hello</span> <span class="fu">|</span> <span class="dt">Apples</span> <span class="dt">Int</span></a></code></pre></div>
<p>次に、それを人間が読める形式に変換したいので、レンダ関数をいくつか定義します。</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="ot">renderEnglish ::</span> <span class="dt">Msg</span> <span class="ot">-&gt;</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2">renderEnglish <span class="dt">Hello</span> <span class="fu">=</span> <span class="st">&quot;Hello&quot;</span></a>
<a class="sourceLine" id="cb41-3" data-line-number="3">renderEnglish (<span class="dt">Apples</span> <span class="dv">0</span>) <span class="fu">=</span> <span class="st">&quot;You did not buy any apples.&quot;</span></a>
<a class="sourceLine" id="cb41-4" data-line-number="4">renderEnglish (<span class="dt">Apples</span> <span class="dv">1</span>) <span class="fu">=</span> <span class="st">&quot;You bought 1 apple.&quot;</span></a>
<a class="sourceLine" id="cb41-5" data-line-number="5">renderEnglish (<span class="dt">Apples</span> i) <span class="fu">=</span> T.concat [<span class="st">&quot;You bought &quot;</span>, T.pack <span class="fu">$</span> show i, <span class="st">&quot; apples.&quot;</span>]</a></code></pre></div>
<p>そして Msg の値を直接テンプレート内で展開するためにアンダースコア展開を使います。</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode hamlet"><code class="sourceCode hamlet"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw">$</span><span class="er">doctype</span> <span class="er">5</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="kw">&lt;html&gt;</span></a>
<a class="sourceLine" id="cb42-3" data-line-number="3">    <span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb42-4" data-line-number="4">        <span class="kw">&lt;title&gt;</span>i18n</a>
<a class="sourceLine" id="cb42-5" data-line-number="5">    <span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb42-6" data-line-number="6">        <span class="kw">&lt;h1&gt;_{</span><span class="dt">Hello</span><span class="kw">}</span></a>
<a class="sourceLine" id="cb42-7" data-line-number="7">        <span class="kw">&lt;p&gt;_{</span><span class="dt">Apples</span> count<span class="kw">}</span></a></code></pre></div>
<p>この種のテンプレートは、型安全URLをレンダー関数を渡した時のように、これらの値を HTML に変換する何らかの方法を必要とします。</p>
<p>これを表現するために、新しい型シノニムを定義します。</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw">type</span> <span class="dt">Render</span> url <span class="fu">=</span> url <span class="ot">-&gt;</span> [(<span class="dt">Text</span>, <span class="dt">Text</span>)] <span class="ot">-&gt;</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb43-2" data-line-number="2"><span class="kw">type</span> <span class="dt">Translate</span> msg <span class="fu">=</span> msg <span class="ot">-&gt;</span> <span class="dt">Html</span></a>
<a class="sourceLine" id="cb43-3" data-line-number="3"><span class="kw">type</span> <span class="dt">HtmlUrlI18n</span> msg url <span class="fu">=</span> <span class="dt">Translate</span> msg <span class="ot">-&gt;</span> <span class="dt">Render</span> url <span class="ot">-&gt;</span> <span class="dt">Html</span></a></code></pre></div>
<p>これによって <code>renderEnglish</code>、 <code>renderSpanish</code>、 <code>renderKlingon</code> をテンプレートに渡すことができ、それはうまく翻訳された出力を生成します (もちろん翻訳機の性質に依存します・・・)。 完全なプログラムは以下のようになります。</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="ot">{-# LANGUAGE QuasiQuotes #-}</span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></a>
<a class="sourceLine" id="cb44-3" data-line-number="3"><span class="kw">import</span> <span class="dt">Data.Text</span> (<span class="dt">Text</span>)</a>
<a class="sourceLine" id="cb44-4" data-line-number="4"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Text</span> <span class="kw">as</span> <span class="dt">T</span></a>
<a class="sourceLine" id="cb44-5" data-line-number="5"><span class="kw">import</span> <span class="dt">Text.Hamlet</span> (<span class="dt">HtmlUrlI18n</span>, ihamlet)</a>
<a class="sourceLine" id="cb44-6" data-line-number="6"><span class="kw">import</span> <span class="dt">Text.Blaze.Html</span> (toHtml)</a>
<a class="sourceLine" id="cb44-7" data-line-number="7"><span class="kw">import</span> <span class="dt">Text.Blaze.Html.Renderer.String</span> (renderHtml)</a>
<a class="sourceLine" id="cb44-8" data-line-number="8"></a>
<a class="sourceLine" id="cb44-9" data-line-number="9"><span class="kw">data</span> <span class="dt">MyRoute</span> <span class="fu">=</span> <span class="dt">Home</span> <span class="fu">|</span> <span class="dt">Time</span> <span class="fu">|</span> <span class="dt">Stylesheet</span></a>
<a class="sourceLine" id="cb44-10" data-line-number="10"></a>
<a class="sourceLine" id="cb44-11" data-line-number="11"><span class="ot">renderUrl ::</span> <span class="dt">MyRoute</span> <span class="ot">-&gt;</span> [(<span class="dt">Text</span>, <span class="dt">Text</span>)] <span class="ot">-&gt;</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb44-12" data-line-number="12">renderUrl <span class="dt">Home</span> _ <span class="fu">=</span> <span class="st">&quot;/home&quot;</span></a>
<a class="sourceLine" id="cb44-13" data-line-number="13">renderUrl <span class="dt">Time</span> _ <span class="fu">=</span> <span class="st">&quot;/time&quot;</span></a>
<a class="sourceLine" id="cb44-14" data-line-number="14">renderUrl <span class="dt">Stylesheet</span> _ <span class="fu">=</span> <span class="st">&quot;/style.css&quot;</span></a>
<a class="sourceLine" id="cb44-15" data-line-number="15"></a>
<a class="sourceLine" id="cb44-16" data-line-number="16"><span class="kw">data</span> <span class="dt">Msg</span> <span class="fu">=</span> <span class="dt">Hello</span> <span class="fu">|</span> <span class="dt">Apples</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb44-17" data-line-number="17"></a>
<a class="sourceLine" id="cb44-18" data-line-number="18"><span class="ot">renderEnglish ::</span> <span class="dt">Msg</span> <span class="ot">-&gt;</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb44-19" data-line-number="19">renderEnglish <span class="dt">Hello</span> <span class="fu">=</span> <span class="st">&quot;Hello&quot;</span></a>
<a class="sourceLine" id="cb44-20" data-line-number="20">renderEnglish (<span class="dt">Apples</span> <span class="dv">0</span>) <span class="fu">=</span> <span class="st">&quot;You did not buy any apples.&quot;</span></a>
<a class="sourceLine" id="cb44-21" data-line-number="21">renderEnglish (<span class="dt">Apples</span> <span class="dv">1</span>) <span class="fu">=</span> <span class="st">&quot;You bought 1 apple.&quot;</span></a>
<a class="sourceLine" id="cb44-22" data-line-number="22">renderEnglish (<span class="dt">Apples</span> i) <span class="fu">=</span> T.concat [<span class="st">&quot;You bought &quot;</span>, T.pack <span class="fu">$</span> show i, <span class="st">&quot; apples.&quot;</span>]</a>
<a class="sourceLine" id="cb44-23" data-line-number="23"></a>
<a class="sourceLine" id="cb44-24" data-line-number="24"><span class="ot">template ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">HtmlUrlI18n</span> <span class="dt">Msg</span> <span class="dt">MyRoute</span></a>
<a class="sourceLine" id="cb44-25" data-line-number="25">template count <span class="fu">=</span> [ihamlet|</a>
<a class="sourceLine" id="cb44-26" data-line-number="26">$doctype 5</a>
<a class="sourceLine" id="cb44-27" data-line-number="27">&lt;html&gt;</a>
<a class="sourceLine" id="cb44-28" data-line-number="28">    &lt;head&gt;</a>
<a class="sourceLine" id="cb44-29" data-line-number="29">        &lt;title&gt;i18n</a>
<a class="sourceLine" id="cb44-30" data-line-number="30">    &lt;body&gt;</a>
<a class="sourceLine" id="cb44-31" data-line-number="31">        &lt;h1&gt;_{Hello}</a>
<a class="sourceLine" id="cb44-32" data-line-number="32">        &lt;p&gt;_{Apples count}</a>
<a class="sourceLine" id="cb44-33" data-line-number="33">|]</a>
<a class="sourceLine" id="cb44-34" data-line-number="34"></a>
<a class="sourceLine" id="cb44-35" data-line-number="35"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb44-36" data-line-number="36">main <span class="fu">=</span> putStrLn <span class="fu">$</span> renderHtml</a>
<a class="sourceLine" id="cb44-37" data-line-number="37">     <span class="fu">$</span> (template <span class="dv">5</span>) (toHtml <span class="fu">.</span> renderEnglish) renderUrl</a></code></pre></div>
<h2 id="other-shakespeare">Other Shakespeare</h2>
<p>HTML、 CSS、 Javascript の補助だけでなく、より一般的な利用用途がシェイクスピアには存在します。 シェイクスピアのテキストは Ruby や Python のようにスクリプト言語で慣れているような展開された文字列を作るための簡単な方法を提供します。 そのため、明らかにこのパッケージの利用用途は Yesod に限定されません。</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="ot">{-# LANGUAGE QuasiQuotes, OverloadedStrings #-}</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="kw">import</span> <span class="dt">Text.Shakespeare.Text</span></a>
<a class="sourceLine" id="cb45-3" data-line-number="3"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Text.Lazy.IO</span> <span class="kw">as</span> <span class="dt">TLIO</span></a>
<a class="sourceLine" id="cb45-4" data-line-number="4"><span class="kw">import</span> <span class="dt">Data.Text</span> (<span class="dt">Text</span>)</a>
<a class="sourceLine" id="cb45-5" data-line-number="5"><span class="kw">import</span> <span class="dt">Control.Monad</span> (forM_)</a>
<a class="sourceLine" id="cb45-6" data-line-number="6"></a>
<a class="sourceLine" id="cb45-7" data-line-number="7"><span class="kw">data</span> <span class="dt">Item</span> <span class="fu">=</span> <span class="dt">Item</span></a>
<a class="sourceLine" id="cb45-8" data-line-number="8">    {<span class="ot"> itemName ::</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb45-9" data-line-number="9">    ,<span class="ot"> itemQty ::</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb45-10" data-line-number="10">    }</a>
<a class="sourceLine" id="cb45-11" data-line-number="11"></a>
<a class="sourceLine" id="cb45-12" data-line-number="12"><span class="ot">items ::</span> [<span class="dt">Item</span>]</a>
<a class="sourceLine" id="cb45-13" data-line-number="13">items <span class="fu">=</span></a>
<a class="sourceLine" id="cb45-14" data-line-number="14">    [ <span class="dt">Item</span> <span class="st">&quot;apples&quot;</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb45-15" data-line-number="15">    , <span class="dt">Item</span> <span class="st">&quot;bananas&quot;</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb45-16" data-line-number="16">    ]</a>
<a class="sourceLine" id="cb45-17" data-line-number="17"></a>
<a class="sourceLine" id="cb45-18" data-line-number="18"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb45-19" data-line-number="19">main <span class="fu">=</span> forM_ items <span class="fu">$</span> \item <span class="ot">-&gt;</span> TLIO.putStrLn</a>
<a class="sourceLine" id="cb45-20" data-line-number="20">    [lt|You have #{show $ itemQty item} #{itemName item}.|]</a></code></pre></div>
<p>この単純な例におけるポイントを以下に挙げます。</p>
<ul>
<li>文字列を表すデータ型には <code>String</code>, 正格 <code>Text</code>, 遅延 <code>Text</code> があることに注意してください。それらは共に全てうまく機能します</li>
<li>遅延テキストを生成したい場合は <code>lt</code> という名称の準クォートを使います。 <code>st</code> の場合も同様です</li>
<li>これらの準クォートには長い名称も存在します (<code>ltext</code> と <code>stext</code>)</li>
</ul>
<h2 id="general-recommendations">General Recommendations</h2>
<p>これは Yesod コミュニティからシェイクスピアを最大限に利用するための一般的なヒントです。</p>
<ul>
<li>実際のサイトにおいては外部ファイルを利用してください。ライブラリにおいては長くなり過ぎない限り、準クォートを利用しても良いです</li>
<li>Patrick Briston 氏が非常に有益な <a href="https://github.com/pbrisbin/html-template-syntax">Vim code hilighter</a> をまとめあげました</li>
<li>Hamlet タグは既存のタグの後に開始・終了タグを埋め込むのではなく、常に新たな行から始める必要があります。これに関する唯一の例外はまれに大きなテキストブロックにおいて出現する <code>&lt;i&gt;</code>、 <code>&lt;b&gt;</code> タグだけです</li>
</ul>
      </article>

      <div class="pager">
      
      
      </div>

      <div class="row">
        <div class="col s6 offset-s6" style="position: relative; height: 100px;">
          <div class="fixed-action-btn horizontal" style="position: absolute; display: inline-block; right: 24px;">
  <a class="btn-floating btn-large red">
    <i class="large material-icons">share</i>
  </a>
  <ul>
    <li>
      <a class="btn-floating waves-effect waves-light blue tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Twitter" href="https://twitter.com/intent/tweet?text=Shakespearen Templates&url=https://haskell.e-bigmoon.com/yesod/book/ch04-shakespearen-templates.html"><i class="mdi mdi-twitter white-text"></i></a>
    </li>
    <li>
      <a class="btn-floating waves-effect waves-light indigo tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Facebook" href="https://facebook.com/sharer.php?u=https://haskell.e-bigmoon.com/yesod/book/ch04-shakespearen-templates.html"><i class="mdi mdi-facebook white-text"></i></a>
    </li>
    <li>
      <a class="btn-floating waves-effect waves-light red tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Google+" href="https://plus.google.com/share?url=https://haskell.e-bigmoon.com/yesod/book/ch04-shakespearen-templates.html"><i class="mdi mdi-google-plus white-text"></i></a>
    </li>
  </ul>
</div>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
    </div>

    <footer class="page-footer indigo lighten-1">

  <div class="footer-copyright">

    <div class="container">
      CopyRight © 2018 BIGMOON All Rights Reserved.&nbsp;
      Site proudly generated by <a class="red-text text-accent-1" href="http://jaspervdj.be/hakyll">Hakyll</a>,&nbsp;
      original Jekyll theme by <a class="red-text text-accent-1" href="https://github.com/mumuxme/materialize-jekyll">mumuxme</a>.
    </div>

  </div>

</footer>


    <!-- scrolltop button -->
    <button class="material-scrolltop waves-effect waves-light hide-on-small-only" type="button">
      <i class="mdi mdi-arrow-up-bold small white-text"></i>
    </button>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-19322672-9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-19322672-9');
    </script>

    <!-- jquery -->
    <script type="text/javascript" src="../../lib/jquery-min.js"></script>
    <!-- materialize -->
    <script src="../../lib/materialize/js/materialize.min.js"></script>
    <!-- <\!-- Material ScrollTop plugin -\-> -->
    <script src="../../lib/material-scrolltop/material-scrolltop.js"></script>
    <!-- main -->
    <script src="../../js/init.js"></script>
    <script src="../../js/main.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>

</html>
