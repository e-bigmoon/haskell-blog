<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">

  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
  <!-- MUST in hex format, may the same as header-color. This color is for android chrome browser. -->
  <meta name="theme-color" content="#5c6bc0">

  <!-- Metadata. -->
  <meta name="keywords" content="haskell,blog,bigmoon" />
  <title>xml-conduit</title>
  <meta name="description" content="BIG MOON">
  <link rel="canonical" href="../../yesod/book/appendices-xml.html">
  <link rel="alternate" type="application/atom+xml" title="xml-conduit" href="../../feed.xml" />
  <link rel="shortcut icon" href="../../images/favicon.ico" />
  <meta name="google-site-verification" content="X2YNboLvzw3_bclXLMvohyJDqj68D06_hPDMukRbgTs" />

  <!-- Stylesheets. -->
  <link rel="stylesheet" href="../../lib/materialize/css/materialize.min.css" />
  <link rel="stylesheet" href="../../css/main.css" />
  <link media="all" rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/3.3.92/css/materialdesignicons.min.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="../../lib/material-scrolltop/material-scrolltop.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/agate.min.css" />
  

  <!-- OGP -->
  <meta property="og:title" content="xml-conduit" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="/yesod/book/appendices-xml.html" />
  <!-- <meta property="og:image" content=" サムネイル画像の URL" /> -->
  <meta property="og:site_name" content="xml-conduit" />
  <meta property="og:description" content="BIG MOON" />

  <meta name="twitter:card" content="summary" />
  <!-- <meta name="twitter:site" content="@[ Twitter ID]" /> -->
  <!-- <meta name="twitter:player" content="@[ Twitter ID]" /> -->

  <noscript>
  <div class="notice-warning noscript">You don't have javascript enabled. Good luck! :(</div>
</noscript>

<!--[if IE]>
  <div class="notice-warning">Oh, you are using Internet Explorer! Good luck... :(</div>
<![endif]-->

</head>


  <body>
    <header class="site-header">
      <nav class="nav-extended indigo lighten-1">
        <div class="nav-wrapper">
  <a href="../../"><span class="site-title">BIGMOON Haskeller's BLOG</span></a>
  <a href="#" data-activates="mobile-navbar" class="button-collapse">
    <i class="mdi mdi-menu white-text"></i>
  </a>

  <ul id="nav-mobile" class="right hide-on-med-and-down">
    <li>
      <a href="../../" class="white-text">
        <i class="mdi mdi-home left indigo-text text-lighten-3"></i>
        Home
      </a>
    </li>
    <li>
      <a href="../../about.html" class="white-text">
        <i class="mdi mdi-account-circle left indigo-text text-lighten-3"></i>
        About
      </a>
    </li>
    <li>
      <a href="../../books/" class="white-text">
        <i class="mdi mdi-book-open left indigo-text text-lighten-3"></i>
        Books
      </a>
    </li>
    <li>
      <a href="../../stack/" class="white-text">
        <i class="mdi mdi-wrench left indigo-text text-lighten-3"></i>
        Development
      </a>
    </li>
    <li>
      <a href="../../quiz/" class="white-text">
        <i class="mdi mdi-comment-question-outline left indigo-text text-lighten-3"></i>
        Quiz
      </a>
    </li>
    <li>
      <a href="../../libraries/" class="white-text">
        <i class="mdi mdi-package-variant left indigo-text text-lighten-3"></i>
        Libraries
      </a>
    </li>
    <li>
      <a href="../../yesod/" class="white-text">
        <i class="mdi mdi-earth left indigo-text text-lighten-3"></i>
        Yesod
      </a>
    </li>
    <li>
      <a href="../../feed.xml" class="white-text">
        <i class="mdi mdi-rss left indigo-text text-lighten-3"></i>
        Feed
      </a>
    </li>
  </ul>

  <ul class="side-nav" id="mobile-navbar">
    <li>
      <a href="../../" class="waves-effect waves-teal black-text">
        <i class="mdi mdi-home left green-text"></i>
        Home
      </a>
    </li>
    <li>
      <a href="../../about.html" class="navbar-text-colour-mobile">
        <i class="mdi mdi-account-circle left blue-text"></i>
        About
      </a>
    </li>
    <li>
      <a href="../../books/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-book-open left blue-text"></i>
        Books
      </a>
    </li>
    <li>
      <a href="../../stack/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-wrench left blue-text"></i>
        Development
      </a>
    </li>
    <li>
      <a href="../../quiz/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-comment-question-outline left blue-text"></i>
        Quiz
      </a>
    </li>
    <li>
      <a href="../../libraries/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-package-variant left blue-text"></i>
        Libraries
      </a>
    </li>
    <li>
      <a href="../../yesod/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-earth left blue-text"></i>
        Yesod
      </a>
    </li>
  </ul>
</div>

      </nav>
    </header>

    <div class="site-container" id="tab-main">
      <div class="wrapper">
        <div class="post-ribbon"></div>

<div class="container page-container">
  <div class="post-page card-panel z-depth-2">
    <div class="post-section">
      <div class="post-heading">
        <div style="float: right;">
          
          <span>記事公開日: 2021/02/23</span><br>
          
          
        </div>
        <h1 class="post-title">xml-conduit</h1>
      </div>

      <article class="page-content">
        <h1 id="xml-conduit">xml-conduit</h1>
<p>多くの開発者はXMLファイルを扱わなければならないということに対しうんざりしている. XMLは複雑なデータモデルを持ち, わかりにくいライブラリ, 莫大な何層にも重なる複雑性が目標との間にあるという評判がある. 多くの苦痛は実際には言語とライブラリの問題であって, XML固有の問題でないと言いたい.</p>
<p>再び, Haskellの型システムにより問題を最も根本的な形式に分解できる. xml-typesパッケージはXMLデータモデルをきちんと分解し(ストリーミングかつDOMに基づいた方法), 単純なADTにする. Haskellの標準普遍データ構造により, ドキュメントに変更を加えることが容易になり, 単純な関数の集合により, パージング, レンダリングが楽になる.</p>
<p>xml-conduitパッケージを扱う予定である. 表面下では, このパッケージはYesodが一般的に高パフォーマンスのために行う多くの方法を用いる: blaze-builder, text, conduit, そして, attoparsec. しかし, ユーザの観点からはそれは最も単純なAPI(<code>readFile</code>/<code>writeFile</code>)からXMLイベントストリームの完全な制御に至るまで, あらゆるものを与えてくれる.</p>
<p><code>xml-conduit</code>に加え, xml-hamletやxml2htmlなどの関連するパッケージがいくつかある. これら全てのパッケージをどのように使うかについてと, いつ使うべきかについての両者を扱う.</p>
<h2 id="synopsis">Synopsis</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> <span class="dt">Input</span> <span class="dt">XML</span> file <span class="op">--&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>document title<span class="ot">=</span><span class="st">&quot;My Title&quot;</span><span class="op">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>para<span class="op">&gt;</span><span class="dt">This</span> is a paragraph<span class="op">.</span> <span class="dt">It</span> has <span class="op">&lt;</span>em<span class="op">&gt;</span>emphasized<span class="op">&lt;/</span>em<span class="op">&gt;</span> <span class="fu">and</span> <span class="op">&lt;</span>strong<span class="op">&gt;</span>strong<span class="op">&lt;/</span>strong<span class="op">&gt;</span> <span class="fu">words</span><span class="op">.&lt;/</span>para<span class="op">&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>image href<span class="ot">=</span><span class="st">&quot;myimage.png&quot;</span><span class="op">/&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>document<span class="op">&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE QuasiQuotes       #-}</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Map</span>        <span class="kw">as</span> <span class="dt">M</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Prelude</span>         <span class="kw">hiding</span> (readFile, writeFile)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Text.Hamlet.XML</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Text.XML</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- readFile will throw any parse errors as runtime exceptions</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- def uses the default settings</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Document</span> prologue root epilogue <span class="ot">&lt;-</span> <span class="fu">readFile</span> def <span class="st">&quot;input.xml&quot;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- root is the root element of the document, let's modify it</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> root' <span class="ot">=</span> transform root</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- And now we write out. Let's indent our output</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeFile</span> def</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        { rsPretty <span class="ot">=</span> <span class="dt">True</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        } <span class="st">&quot;output.html&quot;</span> <span class="op">$</span> <span class="dt">Document</span> prologue root' epilogue</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">-- We'll turn out &lt;document&gt; into an XHTML document</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="ot">transform ::</span> <span class="dt">Element</span> <span class="ot">-&gt;</span> <span class="dt">Element</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>transform (<span class="dt">Element</span> _name attrs children) <span class="ot">=</span> <span class="dt">Element</span> <span class="st">&quot;html&quot;</span> M.empty</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    [xml|</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        &lt;head&gt;</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>            &lt;title&gt;</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>                $maybe title &lt;- M.lookup &quot;title&quot; attrs</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>                    \#{title}</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>                $nothing</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>                    Untitled Document</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        &lt;body&gt;</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>            $forall child &lt;- children</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>                ^{goNode child}</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    |]</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="ot">goNode ::</span> <span class="dt">Node</span> <span class="ot">-&gt;</span> [<span class="dt">Node</span>]</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>goNode (<span class="dt">NodeElement</span> e) <span class="ot">=</span> [<span class="dt">NodeElement</span> <span class="op">$</span> goElem e]</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>goNode (<span class="dt">NodeContent</span> t) <span class="ot">=</span> [<span class="dt">NodeContent</span> t]</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>goNode (<span class="dt">NodeComment</span> _) <span class="ot">=</span> [] <span class="co">-- hide comments</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>goNode (<span class="dt">NodeInstruction</span> _) <span class="ot">=</span> [] <span class="co">-- and hide processing instructions too</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co">-- convert each source element to its XHTML equivalent</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="ot">goElem ::</span> <span class="dt">Element</span> <span class="ot">-&gt;</span> <span class="dt">Element</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>goElem (<span class="dt">Element</span> <span class="st">&quot;para&quot;</span> attrs children) <span class="ot">=</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Element</span> <span class="st">&quot;p&quot;</span> attrs <span class="op">$</span> <span class="fu">concatMap</span> goNode children</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>goElem (<span class="dt">Element</span> <span class="st">&quot;em&quot;</span> attrs children) <span class="ot">=</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Element</span> <span class="st">&quot;i&quot;</span> attrs <span class="op">$</span> <span class="fu">concatMap</span> goNode children</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>goElem (<span class="dt">Element</span> <span class="st">&quot;strong&quot;</span> attrs children) <span class="ot">=</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Element</span> <span class="st">&quot;b&quot;</span> attrs <span class="op">$</span> <span class="fu">concatMap</span> goNode children</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>goElem (<span class="dt">Element</span> <span class="st">&quot;image&quot;</span> attrs _children) <span class="ot">=</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Element</span> <span class="st">&quot;img&quot;</span> (fixAttr attrs) [] <span class="co">-- images can't have children</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    fixAttr mattrs</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="st">&quot;href&quot;</span> <span class="ot">`M.member`</span> mattrs  <span class="ot">=</span> M.delete <span class="st">&quot;href&quot;</span> <span class="op">$</span> M.insert <span class="st">&quot;src&quot;</span> (mattrs <span class="op">M.!</span> <span class="st">&quot;href&quot;</span>) mattrs</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="fu">otherwise</span>                 <span class="ot">=</span> mattrs</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>goElem (<span class="dt">Element</span> name attrs children) <span class="ot">=</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- don't know what to do, just pass it through...</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Element</span> name attrs <span class="op">$</span> <span class="fu">concatMap</span> goNode children</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;?</span>xml version<span class="ot">=</span><span class="st">&quot;1.0&quot;</span> encoding<span class="ot">=</span><span class="st">&quot;UTF-8&quot;</span><span class="op">?&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> <span class="dt">Output</span> <span class="dt">XHTML</span> <span class="op">--&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>html<span class="op">&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span><span class="fu">head</span><span class="op">&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>title<span class="op">&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">My</span> <span class="dt">Title</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;/</span>title<span class="op">&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span><span class="fu">head</span><span class="op">&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>body<span class="op">&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>p<span class="op">&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">This</span> is a paragraph<span class="op">.</span> <span class="dt">It</span> has</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;</span>i<span class="op">&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                emphasized</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;/</span>i<span class="op">&gt;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">and</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;</span>b<span class="op">&gt;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                strong</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">&lt;/</span>b<span class="op">&gt;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">words</span><span class="op">.</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;/</span>p<span class="op">&gt;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>img src<span class="ot">=</span><span class="st">&quot;myimage.png&quot;</span><span class="op">/&gt;</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>body<span class="op">&gt;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>html<span class="op">&gt;</span></span></code></pre></div>
<h2 id="types">Types</h2>
<p>型を分析するためにボトムアップアプローチを取ろう. この章はXMLデータモデル自身の入門書としての役割も果たす. これに完全には慣れていなくても心配しないでください.</p>
<p>Haskellが本当にその力を示す最初の場所は<code>Name</code>データ型であると思う. 多くの言語(Javaのような)はnameを適切に表現するのに苦戦している. 問題はnameには実際には3つの要素があることである: ローカルネーム, 名前空間 (任意), 接頭辞 (これもまた任意). 説明のためにいくつかのXMLを見てみましょう:</p>
<pre><code>&lt;no-namespace/&gt;
&lt;no-prefix xmlns=&quot;first-namespace&quot; first-attr=&quot;value1&quot;/&gt;
&lt;foo:with-prefix xmlns:foo=&quot;second-namespace&quot; foo:second-attr=&quot;value2&quot;/&gt;</code></pre>
<p>最初のタグは<code>no-namespace</code>のローカルネームを持っているまたは, 名前空間を持たないか接頭辞を持っている. 2つ目のタグ(local name: <code>no prefix</code>)もまた, 接頭辞を持たないが, (<code>first-namespace</code>)を持つ.しかし, <code>first-attr</code>はその名前空間を継承しない: 属性名前空間は常に明示的に接頭辞を設定される必要がある.</p>
<div class="yesod-book-notice">
<p>名前空間はほとんど常に何らかのURIであるが, そうである必要があるという指定はない何もない.</p>
</div>
<p>3つ目のタグは<code>with-prefix</code>のローカルネーム, <code>foo</code>接頭辞, <code>second-namespace</code>の名前空間を持つ. その属性は<code>second-attr</code>ローカルネームと, 同じ接頭辞, 名前空間を持つ. <code>xmlns</code>と<code>xmlns:foo</code>属性は名前空間仕様の一部であり, 各エレメントの属性とは考えられない.</p>
<p>そこでネームから必要なものを調べよう: 全てのネームはローカルネームを持ち, 任意に接頭辞と名前空間を持てる. レコード型に単純に当てはまるように見える:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Name</span> <span class="ot">=</span> <span class="dt">Name</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    {<span class="ot"> nameLocalName ::</span> <span class="dt">Text</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    ,<span class="ot"> nameNamespace ::</span> <span class="dt">Maybe</span> <span class="dt">Text</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    ,<span class="ot"> namePrefix    ::</span> <span class="dt">Maybe</span> <span class="dt">Text</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<p>XML名前空間の標準では, 2つのネームは同じローカルネームと名前空間を持つ場合, 同一と考えられる. 言い換えると, 接頭辞は重要でないのである. したがって, <code>xml-types</code>は接頭辞を無視する<code>Eq</code>と<code>Ord</code>インスタンスを定義する.</p>
<p>言及すべき最後のクラスインスタンスは<code>IsString</code>である. 毎回文章を作るたびに, 手動で<code>Name "p" Nothing Nothing</code>と打たなければならないのは非常につまらない. もし, <code>OverloadedStrings</code>をオンにすれば, “<code>p</code>”は自動的にそれに変換される. さらに, <code>IsString</code>インスタンスはClark表記と呼ばれるものを認識し, 中括弧で囲まれた名前空間を前に置くことが可能になる. 言い換えると:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;{namespace}element&quot;</span> <span class="op">==</span> <span class="dt">Name</span> <span class="st">&quot;element&quot;</span> (<span class="dt">Just</span> <span class="st">&quot;namespace&quot;</span>) <span class="dt">Nothing</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;element&quot;</span> <span class="op">==</span> <span class="dt">Name</span> <span class="st">&quot;element&quot;</span> <span class="dt">Nothing</span> <span class="dt">Nothing</span></span></code></pre></div>
<h2 id="the-four-types-of-nodes">The Four Types of Nodes</h2>
<p>XML ドキュメントはネストされたノードのツリーである. 実際に4つの異なる型のノードが許容されている: エレメント, コンテント(すなはち, テキスト), コメント, そしてプロセッシングインストラクションである.</p>
<div class="yesod-book-notice">
<p>最後のものに不慣れかもしれない, それはあまり一般的には用いられない. それは次のようにマークアップされる:</p>
<pre><code>&lt;?target data?&gt;</code></pre>
<p>プロセシングインストラクション(PIs)には2つの驚くべき事実がある:</p>
<ul>
<li><p>PIsは属性を持たない. しばしば属性を持っているようにみえるプロセシングインストラクションを見るが, 実際にはインストラクションにおいてそのデータに関する規則はない.</p></li>
<li><p>ドキュメントの最初にある<code>&lt;?xml ...?&gt;</code>はプロセシングインストラクションではない. それは単にドキュメントの始まり(XML宣言として知られている)であり, たまたま非常にPIに類似しているだけである. 違いは, <code>&lt;?xml ...?&gt;</code>ラインはパースされたコンテンツには現れない点である.</p></li>
</ul>
</div>
<p>プロセシングインストラクションはそれに関係する2つのテキストを持つため(ターゲットとデータ), 単純なデータ型で表せる:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Instruction</span> <span class="ot">=</span> <span class="dt">Instruction</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    {<span class="ot"> instructionTarget ::</span> <span class="dt">Text</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    ,<span class="ot"> instructionData ::</span> <span class="dt">Text</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<p>コメントは特別なデータ型は存在しない, なぜならばそれらはただのテキストであるからである. しかし, コンテントは興味深いものである: それはプレーンテキスト, あるいは未解決エンティティ(例えば, <code>&amp;copyright-statement</code>;)を持てる. xml-typesはすべてのデータ型におけるこれらの未解決エンティティを保持し, スペックに適合するようにしている. しかし, 実践的にはそれらのデータ型に対しプログラムを組むことは非常につまらない. そして, 大部分の使用において, 未解決エンティティは結局エラーになるだけである.</p>
<p>したがって, <code>Text.XML</code>モジュールはノード, エレメント, そしてドキュメントに対し, 全ての未解決エンティティを除いた独自のデータ型セットを持っている. もし代わりに未解決エンティティを扱いたければ, <code>Text.XML.Unresolved</code>モジュールを用いるべきである. 今から, <code>Text.XML</code>データ型のみに焦点を当てることにする. しかし, それらはxml-typesのバージョンとほとんど同じである.</p>
<p>ところで, 回り道の後: コンテントはただのテキストであり, したがってそれも特別なデータ型を持たない. 最後のノード型はエレメントであり, 3つの情報を含む: ネーム, 属性名/値ペアのマップ, そして子ノードのリストである.(<code>xml-types</code>において, この値も同様に未解決エンティティを含みうる) したがって, <code>Element</code>は次のように定義される:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Element</span> <span class="ot">=</span> <span class="dt">Element</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    {<span class="ot"> elementName ::</span> <span class="dt">Name</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    ,<span class="ot"> elementAttributes ::</span> <span class="dt">Map</span> <span class="dt">Name</span> <span class="dt">Text</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    ,<span class="ot"> elementNodes ::</span> [<span class="dt">Node</span>]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<p>これはもちろん質問をされる: <code>Node</code>はどのようなものなのか? これはHaskellが最も輝く部分である: その直和型はxmlデータモデルを完璧にモデル化する.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Node</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=</span> <span class="dt">NodeElement</span> <span class="dt">Element</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> <span class="dt">NodeInstruction</span> <span class="dt">Instruction</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> <span class="dt">NodeContent</span> <span class="dt">Text</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> <span class="dt">NodeComment</span> <span class="dt">Text</span></span></code></pre></div>
<h2 id="document">Document</h2>
<p>したがって今やエレメントとノードがあるが, ドキュメント全体についてはどうであろうか? データ型を並べてみよう:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Document</span> <span class="ot">=</span> <span class="dt">Document</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    {<span class="ot"> documentPrologue ::</span> <span class="dt">Prologue</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    ,<span class="ot"> documentRoot ::</span> <span class="dt">Element</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    ,<span class="ot"> documentEpilogue ::</span> [<span class="dt">Miscellaneous</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Prologue</span> <span class="ot">=</span> <span class="dt">Prologue</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    {<span class="ot"> prologueBefore ::</span> [<span class="dt">Miscellaneous</span>]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    ,<span class="ot"> prologueDoctype ::</span> <span class="dt">Maybe</span> <span class="dt">Doctype</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    ,<span class="ot"> prologueAfter ::</span> [<span class="dt">Miscellaneous</span>]</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Miscellaneous</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=</span> <span class="dt">MiscInstruction</span> <span class="dt">Instruction</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> <span class="dt">MiscComment</span> <span class="dt">Text</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Doctype</span> <span class="ot">=</span> <span class="dt">Doctype</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    {<span class="ot"> doctypeName ::</span> <span class="dt">Text</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    ,<span class="ot"> doctypeID ::</span> <span class="dt">Maybe</span> <span class="dt">ExternalID</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">ExternalID</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=</span> <span class="dt">SystemID</span> <span class="dt">Text</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> <span class="dt">PublicID</span> <span class="dt">Text</span> <span class="dt">Text</span></span></code></pre></div>
<p>XMLスペックによるとドキュメントは単一のルートエレメント(<code>documentRoot</code>)を持つ. それは任意のdoctype宣言も持つ. doctypeとルートエレメント両方の前と後に, コメントとプロセシングインストラクションを持てる. (空白も用いることができるが, それはパースにおいて無視される.)</p>
<p>したがって, doctypeについてはどうであろうか? ええ, それはドキュメントのルートエレメントと, 任意のパブリックなシステム識別子を指定する. これらはDTDファイルを参照するために使われ, ファイルに関しより多くの情報を与える(例えば, 検証規則, デフォルト属性, エンティティ解決): いくつかの例を見てみよう:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!</span><span class="dt">DOCTYPE</span> root<span class="op">&gt;</span> <span class="op">&lt;!--</span> no external identifier <span class="op">--&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!</span><span class="dt">DOCTYPE</span> root <span class="dt">SYSTEM</span> <span class="st">&quot;root.dtd&quot;</span><span class="op">&gt;</span> <span class="op">&lt;!--</span> a system identifier <span class="op">--&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!</span><span class="dt">DOCTYPE</span> root <span class="dt">PUBLIC</span> <span class="st">&quot;My Root Public Identifier&quot;</span> <span class="st">&quot;root.dtd&quot;</span><span class="op">&gt;</span> <span class="op">&lt;!--</span> public identifiers have a system <span class="dt">ID</span> as well <span class="op">--&gt;</span></span></code></pre></div>
<p>そして, それはXMLデータモデル全体である. 多くのパーズ目的のために, 単純に<code>Document</code>型全体を無視し, すぐに<code>documentRoot</code>に進むことができる.</p>
<h2 id="events">Events</h2>
<p>ドキュメントAPIに加え, <code>xml-type</code>はEventデータ型を定義する. これはストリーミングツールを構築するために用いられ, ある種の処理(例えば, 追加属性を全てのエレメントに与える)において, 非常にメモリ効率が良くなる. 今はストリーミングAPIについては言及しないが, ドキュメントAPIを分析した後であれば, 非常に馴染み深いものになるであろう.</p>
<div class="yesod-book-notice">
<p>ストリーミングAPIの例については, Sphinxケーススタディで見れる.</p>
</div>
<h2 id="text.xml">Text.XML</h2>
<p>xml-conduitへの推奨される入り口は, Text.XMLモジュールである. このモジュールはXMLをDOM形式で操作するために必要な全てのデータ型と同様に, XMLコンテントをパーズしレンダリングするための多くの異なる方法をエクスポートする. 最も簡単なものから始めよう:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">readFile</span><span class="ot">  ::</span> <span class="dt">ParseSettings</span>  <span class="ot">-&gt;</span> <span class="dt">FilePath</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">Document</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeFile</span><span class="ot"> ::</span> <span class="dt">RenderSettings</span> <span class="ot">-&gt;</span> <span class="dt">FilePath</span> <span class="ot">-&gt;</span> <span class="dt">Document</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()</span></code></pre></div>
<p>これは<code>ParseSettings</code>と<code>RenderSettings</code>データ型を導入する. これらを使って, パーサやレンダラの挙動を変更し, 例えば文字エンティティを追加したり, プリティ(すなはち, インデントされた)出力にしたりできる. しかしこれらの型はDefault型クラスのインスタンであるため, 必要な場合は単純にdefを使えばいい. 残りの章を通して, そのようにしてこれらの値を与えることにする; より詳細についてはAPI docsを参照せよ.</p>
<p>ファイルに基づいたAPIの他に, テキストやバイト文字列に基づいたAPIもあることを指摘することは有益である. バイト文字列により関数はすべて賢いエンコード探知を行い, UTF-8, UTF-16そしてUTF-32をbig endianでもlittle endianでも, Byte-Order Marker(BOM)があってもなくてもサポートする.</p>
<p>複雑なデータ検索においては, 高レベルのカーソルAPIを用いる. 標準Text.XML APIはその高レベルの基礎を形成するだけでなく, 単純なXML変換やXML生成のための素晴らしいAPIである. 例はsynopsisを見よ.</p>
<h2 id="a-note-about-file-paths">A note about file paths</h2>
<p>上の型注釈において, <code>FilePath</code>型がある. しかし, これはPrelude.FilePathではない. 標準<code>Prelude</code>は型シノニム <code>type FilePath = [Char]</code>を定義する. 残念なことに, このような方法を取ることには, ファイル名の文字エンコーディングやパスセパレータの相違を含む多くの制限がある. 代わりに, xml-conduitはsystem-filepathパッケージを用い, これは抽象的な<code>FilePath</code>型を定義する. 個人的にはこれは作業するのにずっとよい方法であると思う. そのパッケージは非常に使いやすいので, ここでは詳細には触れない. しかし, 使い方について少し簡単な説明を与えたい:</p>
<ul>
<li><p><code>FilePath</code>は<code>IsString</code>のインスタンスであるため, 通常の文字列でタイプでき, <code>OverloadedString</code>拡張が有効である限り, それらは適切に扱われる. (とりあえずそれを有効にすることをかなり推奨する. なぜならばそれにより<code>Text</code>値をずっと快適に扱えるようになるからである. )</p></li>
<li><p>もし明確に<code>Prelude</code>の<code>FilePath</code>へ, あるいはそこから変換する必要がある場合, それぞれencodeString, decodeStringを用いるべきである. これはファイルパスエンコーディングを考慮する.</p></li>
<li><p>手動でディレクトリ名や拡張子を持ったファイル名をつなぎ合わせる代わりに, <code>Filesystem.Path.CurrentOS</code>モジュールのオペレータを用いよ, 例えば, <code>myfolder &lt;/&gt; filename &lt;.&gt; extension</code>.</p></li>
</ul>
<h2 id="cursor">Cursor</h2>
<p>XHTMLドキュメントからタイトルを抜き出したいとしよう. ちょうど説明した<code>Text.XML</code>インターフェースを用いて, エレメントの子に対しパターンマッチを行えば可能である. しかしそれはすぐに, 非常につまらないものになる. この種の検索における定石はXPathであり, <code>/html/head/title</code>と書ける. そしてこれはまさにText.XML.Cursorのコンビネータの設計の動機づけとなったものである.</p>
<p>カーソルはXMLのノードでありツリーにおけるその場所を把握している: それは上, 横, 下に横断することができる. (表面化ではこれは<a href="https://wiki.haskell.org/Tying_the_Knot">tying the knot</a>により達成される.) カーソルを<code>Text.XML</code>型から作るのに必要な2つの関数がある: <code>fromDocument</code>と<code>fromNode</code>である.</p>
<p>Axisという概念もあり, <code>type Axis = Cursor -&gt; [Cursor]</code>で定義される. それはaxisの例を見るところから始めるのが最も簡単である: 子は現在の子の0以上のカーソルを返す, 親は入力に対する単一の親カーソルを返すか, 入力がルートエレメントであれば空リストを返す, などである.</p>
<p>さらに, 述語を取るaxisも存在する. <code>element</code>は一般的に用いられる関数であり, 与えられた名前に一致する唯一のエレメントまでフィルタリングする. 例えば, <code>element "title"</code> はもしその名前が”title”であれば入力エレメントを返し, そうでなければ空リストを返す.</p>
<p>他の一般的に用いられる関数でaxisでないものは<code>content :: Cursor -&gt; [Text]</code>である. すべてのコンテンツノードのうち, 含まれるテキストを返す: そうでなければ, 空リストを返す.</p>
<p>そして, リストのモナドインスランスにより, これら全てをつなぎ合わせることが可能である. 例えば, タイトルの検索を行うために, 次のようなプログラムを書く:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Prelude</span> <span class="kw">hiding</span> (readFile)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.XML</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.XML.Cursor</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Text</span> <span class="kw">as</span> <span class="dt">T</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    doc <span class="ot">&lt;-</span> <span class="fu">readFile</span> def <span class="st">&quot;test.xml&quot;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cursor <span class="ot">=</span> fromDocument doc</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> T.concat <span class="op">$</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>            child cursor <span class="op">&gt;&gt;=</span> element <span class="st">&quot;head&quot;</span> <span class="op">&gt;&gt;=</span> child</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                         <span class="op">&gt;&gt;=</span> element <span class="st">&quot;title&quot;</span> <span class="op">&gt;&gt;=</span> descendant <span class="op">&gt;&gt;=</span> content</span></code></pre></div>
<p>これが言っていることは次のようである:</p>
<ol type="1">
<li><p>ルートエレメントのすべての子ノードを取得する.</p></li>
<li><p>“head”と名付けられたエレメントだけをフィルタリングする.</p></li>
<li><p>それらすべてのヘッドエレメントから全ての子を取得する.</p></li>
<li><p>“title”と名付けられたエレメントだけフィルタリングする.</p></li>
<li><p>そのタイトルエレメントの全ての子孫を得る. (子孫は子, あるいは子の子孫である. ええ, これは再帰的な定義である. )</p></li>
<li><p>テキストノードのみを取得する.</p></li>
</ol>
<p>よって, 次のような入力ドキュメントに対し:</p>
<pre><code>&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;My &lt;b&gt;Title&lt;/b&gt;&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;p&gt;Foo bar baz&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>出力は<code>My Title</code>を得る. これはすべて問題なく良いのだが, XPathによる解決法よりもずっと冗長である. この冗長さに対応するために, Aristid Breitkreuzは一連の演算子をCursorモジュールに追加し, 多くの共通のケースを処理した. その結果, 例を次のように書き直せる:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Prelude</span> <span class="kw">hiding</span> (readFile)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.XML</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.XML.Cursor</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Text</span> <span class="kw">as</span> <span class="dt">T</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    doc <span class="ot">&lt;-</span> <span class="fu">readFile</span> def <span class="st">&quot;test.xml&quot;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cursor <span class="ot">=</span> fromDocument doc</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> T.concat <span class="op">$</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        cursor <span class="op">$/</span> element <span class="st">&quot;head&quot;</span> <span class="op">&amp;/</span> element <span class="st">&quot;title&quot;</span> <span class="op">&amp;//</span> content</span></code></pre></div>
<p><code>$/</code>は右のaxisを左のcursorの子に適用することを意味する. <code>&amp;/</code>はほとんど同じであるが, 代わりに2つのaxisを結合するために用いられる. これは, <code>Text.XML.Cursor</code>における一般的な規則である: $で始まる演算子はaxisを適用する. 一方, <code>&amp;</code>は2つを結合する. <code>&amp;//</code>はaxisを全ての子孫に適用するために用いられる.</p>
<p>より複雑で技巧的な例を見てみましょう. 次のようなドキュメントがあるとする:</p>
<pre><code>&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Headings&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;hgroup&gt;
            &lt;h1&gt;Heading 1 foo&lt;/h1&gt;
            &lt;h2 class=&quot;foo&quot;&gt;Heading 2 foo&lt;/h2&gt;
        &lt;/hgroup&gt;
        &lt;hgroup&gt;
            &lt;h1&gt;Heading 1 bar&lt;/h1&gt;
            &lt;h2 class=&quot;bar&quot;&gt;Heading 2 bar&lt;/h2&gt;
        &lt;/hgroup&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>全ての<code>h1</code>タグにおけるコンテンツで, <code>h2</code>タグに先行し, <code>class</code>属性の”bar”を持つものを取得したいとする. この畳み込みの検索を行うために, 次のように書く:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Prelude</span> <span class="kw">hiding</span> (readFile)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.XML</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.XML.Cursor</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Text</span> <span class="kw">as</span> <span class="dt">T</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    doc <span class="ot">&lt;-</span> <span class="fu">readFile</span> def <span class="st">&quot;test2.xml&quot;</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cursor <span class="ot">=</span> fromDocument doc</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span> <span class="op">$</span> T.concat <span class="op">$</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        cursor <span class="op">$//</span> element <span class="st">&quot;h2&quot;</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>               <span class="op">&gt;=&gt;</span> attributeIs <span class="st">&quot;class&quot;</span> <span class="st">&quot;bar&quot;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>               <span class="op">&gt;=&gt;</span> precedingSibling</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>               <span class="op">&gt;=&gt;</span> element <span class="st">&quot;h1&quot;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>               <span class="op">&amp;//</span> content</span></code></pre></div>
<p>段階的に見てみよう. まずドキュメントにおける全てのh2エレメントを取得する. (<code>$//</code>はルートエレメントにおける全ての子孫を取得する.) そして, <code>class=bar</code>のもののみをフィルタリングする. <code>&gt;=&gt;</code>演算子は実際にはControl.Monadからの標準演算子である; リストのモナドインスタンスであることのさらに別の利点である. <code>precedingSibling</code>はノードの前に来て同じ親を共有する全てのノードを見つける. (また<code>preceding</code>axisはツリーにおける全ての前のノードを取る.) そして<code>h1</code>エレメントのみを取得し, コンテンツを取る.</p>
<div class="yesod-book-notice">
<p>同等のXpathは比較のため, <code>//h2[@class = 'bar']/preceding-sibling::h1//text()</code>である.</p>
</div>
<p>cursor APIはXPathにおいてはあまり簡潔ではないが, 標準Haskellコードであることと, 型安全であるというメリットがある.</p>
<h2 id="xml-hamlet">xml-hamlet</h2>
<p>Haskellのデータ型の簡潔性により, <code>Text.Xml API</code>を持つコンテンツを作ることは, 多少冗長だが, 容易である. 次のコードは:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Data.Map</span> (empty)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Prelude</span>  <span class="kw">hiding</span> (writeFile)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Text.XML</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeFile</span> def <span class="st">&quot;test3.xml&quot;</span> <span class="op">$</span> <span class="dt">Document</span> (<span class="dt">Prologue</span> [] <span class="dt">Nothing</span> []) root []</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    root <span class="ot">=</span> <span class="dt">Element</span> <span class="st">&quot;html&quot;</span> empty</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        [ <span class="dt">NodeElement</span> <span class="op">$</span> <span class="dt">Element</span> <span class="st">&quot;head&quot;</span> empty</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            [ <span class="dt">NodeElement</span> <span class="op">$</span> <span class="dt">Element</span> <span class="st">&quot;title&quot;</span> empty</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>                [ <span class="dt">NodeContent</span> <span class="st">&quot;My &quot;</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                , <span class="dt">NodeElement</span> <span class="op">$</span> <span class="dt">Element</span> <span class="st">&quot;b&quot;</span> empty</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                    [ <span class="dt">NodeContent</span> <span class="st">&quot;Title&quot;</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                    ]</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        , <span class="dt">NodeElement</span> <span class="op">$</span> <span class="dt">Element</span> <span class="st">&quot;body&quot;</span> empty</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>            [ <span class="dt">NodeElement</span> <span class="op">$</span> <span class="dt">Element</span> <span class="st">&quot;p&quot;</span> empty</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>                [ <span class="dt">NodeContent</span> <span class="st">&quot;foo bar baz&quot;</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        ]</span></code></pre></div>
<p>は以下を生じる.</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;html&gt;&lt;head&gt;&lt;title&gt;My &lt;b&gt;Title&lt;/b&gt;&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;foo bar baz&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</code></pre>
<p>これは跳躍であり, 命令的で可変変数に基づいたAPI(Javaなど)を扱うよりも容易に結合できるが, 快適からは程遠く, 実際に達成しようとしていることを不明瞭にする. 物事を簡単にするために, xml-hamletパッケージがあり, これはQuasi-Quotationを用いることで, XMLを自然な構文でタイプすることが可能になる. 例えば, 上は次のように書き直せる:</p>
<pre class="hasekll"><code>{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE QuasiQuotes       #-}
import           Data.Map        (empty)
import           Prelude         hiding (writeFile)
import           Text.Hamlet.XML
import           Text.XML

main :: IO ()
main =
    writeFile def &quot;test3.xml&quot; $ Document (Prologue [] Nothing []) root []
  where
    root = Element &quot;html&quot; empty [xml|
&lt;head&gt;
    &lt;title&gt;
        My #
        &lt;b&gt;Title
&lt;body&gt;
    &lt;p&gt;foo bar baz
|]</code></pre>
<p>いくつかポイントを示しましょう:</p>
<ul>
<li><p>構文はURL展開(<span class="citation" data-cites="..">@..</span>)を除き, 通常のHamletとほとんど同一である.</p></li>
<li><p>閉じタグがない.</p></li>
<li><p>空白を認識する.</p></li>
<li><p>行の最後に空白を持ちたい場合, #を最後に用いる. 最初の場合, バックスラッシュを用いる.</p></li>
<li><p>xml展開は<code>Node</code>のリストを返す. したがって, 全ての通常の<code>Document</code>とルート<code>Element</code>コンストラクタを全てラップする必要がある.</p></li>
<li><p>特別な<code>.class</code>と<code>#id</code>属性形式はサポートされていない.</p></li>
</ul>
<p>そして通常のHamletと同様に, 変数展開と制御構造を使うことができる. そこで少し複雑な例としては:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE QuasiQuotes #-}</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.XML</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.Hamlet.XML</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Prelude</span> <span class="kw">hiding</span> (writeFile)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.Text</span> (<span class="dt">Text</span>, pack)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.Map</span> (empty)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Person</span> <span class="ot">=</span> <span class="dt">Person</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    {<span class="ot"> personName ::</span> <span class="dt">Text</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    ,<span class="ot"> personAge ::</span> <span class="dt">Int</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="ot">people ::</span> [<span class="dt">Person</span>]</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>people <span class="ot">=</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    [ <span class="dt">Person</span> <span class="st">&quot;Michael&quot;</span> <span class="dv">26</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    , <span class="dt">Person</span> <span class="st">&quot;Miriam&quot;</span> <span class="dv">25</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    , <span class="dt">Person</span> <span class="st">&quot;Eliezer&quot;</span> <span class="dv">3</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    , <span class="dt">Person</span> <span class="st">&quot;Gavriella&quot;</span> <span class="dv">1</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeFile</span> def <span class="st">&quot;people.xml&quot;</span> <span class="op">$</span> <span class="dt">Document</span> (<span class="dt">Prologue</span> [] <span class="dt">Nothing</span> []) root []</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    root <span class="ot">=</span> <span class="dt">Element</span> <span class="st">&quot;html&quot;</span> empty [xml|</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>&lt;head&gt;</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    &lt;title&gt;Some People</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>&lt;body&gt;</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    &lt;h1&gt;Some People</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    $if null people</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>        &lt;p&gt;There are no people.</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    $else</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>        &lt;dl&gt;</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>            $forall person &lt;- people</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>                ^{personNodes person}</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>|]</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="ot">personNodes ::</span> <span class="dt">Person</span> <span class="ot">-&gt;</span> [<span class="dt">Node</span>]</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>personNodes person <span class="ot">=</span> [xml|</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>&lt;dt&gt;#{personName person}</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>&lt;dd&gt;#{pack $ show $ personAge person}</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>|]</span></code></pre></div>
<p>少しの注意点:</p>
<ul>
<li><p>キャレット展開(^{…})はノードのリストを取り, その結果容易に他の<code>xml-</code>引用を埋め込むことができる.</p></li>
<li><p>Hamletと異なり, ハッシュ展開(#{…})は多相的ではない, そして<code>Text</code>値のみ許容する.</p></li>
</ul>
<h2 id="xml2html">xml2html</h2>
<p>この章では今までのところ, 例ではXHTML中心に展開した. そうしたのは, 単純にそれが大部分の読者にとって, 最も馴染み深いXML形式であるためである. しかしこれに関しては認めざるおえない欠点がある: 全てのXHTMLが正しいHTMLとは限らない. 次の相違点が存在する:</p>
<ul>
<li><p>HTMLにはvoidタグ(例えば<code>img</code>, <code>br</code>)が存在し, これらは閉じタグを必要とせず, そして実際には許容されていない.</p></li>
<li><p>HTMLはself-closingタグを理解できない. そのため, <code>&lt;script&gt;&lt;/script&gt;</code>や<code>&lt;script/&gt;</code>は非常に異なるものを意味する.</p></li>
<li><p>前の2つの点を組み合わせる: 自由にvoidタグをself-closeできるが, ブラウザに対しては何も意味しない.</p></li>
<li><p>互換モードを避けるために, HTMLドキュメントを<code>DOCTYPE</code>宣言で開始すべきである.</p></li>
<li><p>HTMLページのトップにXML宣言<code>&lt;?xml ...?&gt;</code>は来て欲しくない.</p></li>
<li><p>XHTMLは完全に名前空間で制御されているが, HTMLでは名前空間を使用したくない.</p></li>
<li><p><code>&lt;style&gt;</code>と<code>&lt;script&gt;</code>タグのコンテンツはエスケープすべきでない.</p></li>
</ul>
<p>幸いなことに, <code>xml-conduit</code>は<code>Node</code>, <code>Document</code>, そして<code>Element</code>に対し<code>ToHtml</code>インスタンスを与え, これらの相違点を尊重する. したがって, 単に`toHtmlを使うだけで, 正しい出力を得ることができる.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE QuasiQuotes       #-}</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Data.Map</span>                        (empty)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Text.Blaze.Html</span>                 (toHtml)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Text.Blaze.Html.Renderer.String</span> (renderHtml)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Text.Hamlet.XML</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span>           <span class="dt">Text.XML</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="fu">putStr</span> <span class="op">$</span> renderHtml <span class="op">$</span> toHtml <span class="op">$</span> <span class="dt">Document</span> (<span class="dt">Prologue</span> [] <span class="dt">Nothing</span> []) root []</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="ot">root ::</span> <span class="dt">Element</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>root <span class="ot">=</span> <span class="dt">Element</span> <span class="st">&quot;html&quot;</span> empty [xml|</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>&lt;head&gt;</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    &lt;title&gt;Test</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    &lt;script&gt;if (5 &lt; 6 || 8 &gt; 9) alert(&quot;Hello World!&quot;);</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    &lt;style&gt;body &gt; h1 { color: red }</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>&lt;body&gt;</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    &lt;h1&gt;Hello World!</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>|]</span></code></pre></div>
<p>出力: (空白が追加されている)</p>
<pre><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Test&lt;/title&gt;
        &lt;script&gt;if (5 &lt; 6 || 8 &gt; 9) alert(&quot;Hello World!&quot;);&lt;/script&gt;
        &lt;style&gt;body &gt; h1 { color: red }&lt;/style&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello World!&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
      </article>

      <div class="pager">
      
      
      </div>

      <div class="row">
        <div class="col s6 offset-s6" style="position: relative; height: 100px;">
          <div class="fixed-action-btn horizontal" style="position: absolute; display: inline-block; right: 24px;">
  <a class="btn-floating btn-large red">
    <i class="large material-icons">share</i>
  </a>
  <ul>
    <li>
      <a class="btn-floating waves-effect waves-light blue tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Twitter" href="https://twitter.com/intent/tweet?text=xml-conduit&url=https://haskell.e-bigmoon.com/yesod/book/appendices-xml.html"><i class="mdi mdi-twitter white-text"></i></a>
    </li>
    <li>
      <a class="btn-floating waves-effect waves-light indigo tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Facebook" href="https://facebook.com/sharer.php?u=https://haskell.e-bigmoon.com/yesod/book/appendices-xml.html"><i class="mdi mdi-facebook white-text"></i></a>
    </li>
  </ul>
</div>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
    </div>

    <footer class="page-footer indigo lighten-1">
  <div class="footer-copyright">
    <div class="container">
      © 2017-2020 BIGMOON&nbsp;
      Site proudly generated by <a class="red-text text-accent-1" href="http://jaspervdj.be/hakyll">Hakyll</a>,&nbsp;
      original Jekyll theme by <a class="red-text text-accent-1" href="https://github.com/mumuxme/materialize-jekyll">mumuxme</a>.
    </div>
  </div>
</footer>


    <!-- scrolltop button -->
    <button class="material-scrolltop waves-effect waves-light hide-on-small-only" type="button">
      <i class="mdi mdi-arrow-up-bold small white-text"></i>
    </button>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-19322672-9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-19322672-9');
    </script>

    <!-- jquery -->
    <script type="text/javascript" src="../../lib/jquery-min.js"></script>
    <!-- materialize -->
    <script src="../../lib/materialize/js/materialize.min.js"></script>
    <!-- <\!-- Material ScrollTop plugin -\-> -->
    <script src="../../lib/material-scrolltop/material-scrolltop.js"></script>
    <!-- main -->
    <script src="../../js/init.js"></script>
    <script src="../../js/main.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/haskell.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/yaml.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/shell.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/bash.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>

</html>
