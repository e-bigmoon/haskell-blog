<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">

  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
  <!-- MUST in hex format, may the same as header-color. This color is for android chrome browser. -->
  <meta name="theme-color" content="#5c6bc0">

  <!-- Metadata. -->
  <meta name="keywords" content="haskell,blog,bigmoon" />
  <title>Forms</title>
  <meta name="description" content="BIG MOON">
  <link rel="canonical" href="../../yesod/book/ch08-forms.html">
  <link rel="alternate" type="application/atom+xml" title="Forms" href="../../feed.xml" />
  <link rel="shortcut icon" href="../../images/favicon.ico" />
  <meta name="google-site-verification" content="X2YNboLvzw3_bclXLMvohyJDqj68D06_hPDMukRbgTs" />

  <!-- Stylesheets. -->
  <link rel="stylesheet" href="../../lib/materialize/css/materialize.min.css" />
  <link rel="stylesheet" href="../../css/main.css" />
  <link media="all" rel="stylesheet" type="text/css" href="../../lib/mdi/css/materialdesignicons.min.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="../../lib/material-scrolltop/material-scrolltop.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />

  <!-- OGP -->
  <meta property="og:title" content="Forms" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="/yesod/book/ch08-forms.html" />
  <!-- <meta property="og:image" content=" サムネイル画像の URL" /> -->
  <meta property="og:site_name" content="Forms" />
  <meta property="og:description" content="BIG MOON" />

  <meta name="twitter:card" content="summary" />
  <!-- <meta name="twitter:site" content="@[ Twitter ID]" /> -->
  <!-- <meta name="twitter:player" content="@[ Twitter ID]" /> -->

  <noscript>
  <div class="notice-warning noscript">You don't have javascript enabled. Good luck! :(</div>
</noscript>

<!--[if IE]>
  <div class="notice-warning">Oh, you are using Internet Explorer! Good luck... :(</div>
<![endif]-->

</head>


  <body>
    <header class="site-header">
      <nav class="nav-extended indigo lighten-1">
        <div class="nav-wrapper">
  <a href="../../"><span class="site-title">BIGMOON Haskeller's BLOG</span></a>
  <a href="#" data-activates="mobile-navbar" class="button-collapse">
    <i class="mdi mdi-menu white-text"></i>
  </a>

  <ul id="nav-mobile" class="right hide-on-med-and-down">
    <li>
      <a href="../../" class="white-text">
        <i class="mdi mdi-home left indigo-text text-lighten-3"></i>
        Home
      </a>
    </li>
    <li>
      <a href="../../about.html" class="white-text">
        <i class="mdi mdi-account-circle left indigo-text text-lighten-3"></i>
        About
      </a>
    </li>
    <li>
      <a href="../../stack/" class="white-text">
        <i class="mdi mdi-wrench left indigo-text text-lighten-3"></i>
        Development
      </a>
    </li>
    <li>
      <a href="../../quiz/index.html" class="white-text">
        <i class="mdi mdi-comment-question-outline left indigo-text text-lighten-3"></i>
        Quiz
      </a>
    </li>
    <li>
      <a href="../../libraries/" class="white-text">
        <i class="mdi mdi-package-variant left indigo-text text-lighten-3"></i>
        Libraries
      </a>
    </li>
    <li>
        <a href="../../yesod/" class="white-text">
          <i class="mdi mdi-earth left indigo-text text-lighten-3"></i>
          Yesod
        </a>
      </li>
    <li>
      <a href="../../feed.xml" class="white-text">
        <i class="mdi mdi-rss left indigo-text text-lighten-3"></i>
        Feed
      </a>
    </li>
  </ul>

  <ul class="side-nav" id="mobile-navbar">
    <li>
      <a href="../../" class="waves-effect waves-teal black-text">
        <i class="mdi mdi-home left green-text"></i>
        Home
      </a>
    </li>
    <li>
      <a href="../../about.html" class="navbar-text-colour-mobile">
        <i class="mdi mdi-account-circle left blue-text"></i>
        About
      </a>
    </li>
    <li>
      <a href="../../stack/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-wrench left blue-text"></i>
        Development
      </a>
    </li>
    <li>
      <a href="../../quiz/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-comment-question-outline left blue-text"></i>
        Quiz
      </a>
    </li>
    <li>
      <a href="../../libraries/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-package-variant left blue-text"></i>
        Libraries
      </a>
    </li>
    <li>
      <a href="../../yesod/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-earth left blue-text"></i>
        Yesod
      </a>
    </li>
  </ul>
</div>

      </nav>
    </header>

    <div class="site-container" id="tab-main">
      <div class="wrapper">
        <div class="post-ribbon"></div>

<div class="container page-container">
  <div class="post-page card-panel z-depth-2">
    <div class="post-section">
      <div class="post-heading">
        <h1 class="post-title">Forms</h1>
        
        <span>最終更新日: 2018/03/18</span>
        
      </div>

      <article class="page-content">
        <h2 id="forms">Forms</h2>
<p>境界問題については既に説明しました。 データをアプリケーションに入出力する際は常にそのデータを検証する必要があり、おそらくこの必要性が生じる最も難しい場所はフォームです。 フォームのコーディングは複雑です。 理想的な世界では次のような問題を処理する解決策が望まれます。</p>
<ul>
<li>データ妥当性の保証</li>
<li>フォームで提出された文字列データから Haskell データ型への変換</li>
<li>フォームを表示するための HTML コードの生成</li>
<li>クライアントサイドで行う妥当性チェックやデイトピッカーのような使い勝手の良いウィジェットを提供するための Javascript 生成</li>
<li>単純なフォームを組み合わせることで、複雑なフォームを構築できる機能</li>
<li>フィールドに一意性が保証されている名称の自動的に割り当て</li>
</ul>
<p>yesod-form パッケージは宣言的な API の形式でこれらすべての機能を提供しています。 また、フォームの装飾や Javascript の適切な適用を簡略化するために Yesod ウィジェットとして構築されます。 そして、 Yesod の他の機能と同じように Haskell の型システムを利用して全てが正しく動いていることを保証します。</p>
<h1 id="synopsis">Synopsis</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ot">{-# LANGUAGE MultiParamTypeClasses #-}</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="ot">{-# LANGUAGE OverloadedStrings     #-}</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="ot">{-# LANGUAGE QuasiQuotes           #-}</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="ot">{-# LANGUAGE TemplateHaskell       #-}</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="ot">{-# LANGUAGE TypeFamilies          #-}</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">import</span>           <span class="dt">Control.Applicative</span> ((&lt;$&gt;), (&lt;*&gt;))</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">import</span>           <span class="dt">Data.Text</span>           (<span class="dt">Text</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">import</span>           <span class="dt">Data.Time</span>           (<span class="dt">Day</span>)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw">import</span>           <span class="dt">Yesod</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">import</span>           <span class="dt">Yesod.Form.Jquery</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw">data</span> <span class="dt">App</span> <span class="fu">=</span> <span class="dt">App</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">mkYesod <span class="st">&quot;App&quot;</span> [parseRoutes|</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">/ HomeR GET</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">/person PersonR POST</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">|]</a>
<a class="sourceLine" id="cb1-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="kw">instance</span> <span class="dt">Yesod</span> <span class="dt">App</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co">-- Tells our application to use the standard English messages.</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co">-- If you want i18n, then you can supply a translating function instead.</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="kw">instance</span> <span class="dt">RenderMessage</span> <span class="dt">App</span> <span class="dt">FormMessage</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24">    renderMessage _ _ <span class="fu">=</span> defaultFormMessage</a>
<a class="sourceLine" id="cb1-25" data-line-number="25"></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="co">-- And tell us where to find the jQuery libraries. We'll just use the defaults,</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co">-- which point to the Google CDN.</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="kw">instance</span> <span class="dt">YesodJquery</span> <span class="dt">App</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="co">-- The datatype we wish to receive from the form</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31"><span class="kw">data</span> <span class="dt">Person</span> <span class="fu">=</span> <span class="dt">Person</span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32">    {<span class="ot"> personName          ::</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb1-33" data-line-number="33">    ,<span class="ot"> personBirthday      ::</span> <span class="dt">Day</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34">    ,<span class="ot"> personFavoriteColor ::</span> <span class="dt">Maybe</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35">    ,<span class="ot"> personEmail         ::</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36">    ,<span class="ot"> personWebsite       ::</span> <span class="dt">Maybe</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37">    }</a>
<a class="sourceLine" id="cb1-38" data-line-number="38">  <span class="kw">deriving</span> <span class="dt">Show</span></a>
<a class="sourceLine" id="cb1-39" data-line-number="39"></a>
<a class="sourceLine" id="cb1-40" data-line-number="40"><span class="co">-- Declare the form. The type signature is a bit intimidating, but here's the</span></a>
<a class="sourceLine" id="cb1-41" data-line-number="41"><span class="co">-- overview:</span></a>
<a class="sourceLine" id="cb1-42" data-line-number="42"><span class="co">--</span></a>
<a class="sourceLine" id="cb1-43" data-line-number="43"><span class="co">-- * The Html parameter is used for encoding some extra information. See the</span></a>
<a class="sourceLine" id="cb1-44" data-line-number="44"><span class="co">-- discussion regarding runFormGet and runFormPost below for further</span></a>
<a class="sourceLine" id="cb1-45" data-line-number="45"><span class="co">-- explanation.</span></a>
<a class="sourceLine" id="cb1-46" data-line-number="46"><span class="co">--</span></a>
<a class="sourceLine" id="cb1-47" data-line-number="47"><span class="co">-- * We have our Handler as the inner monad, which indicates which site this is</span></a>
<a class="sourceLine" id="cb1-48" data-line-number="48"><span class="co">-- running in.</span></a>
<a class="sourceLine" id="cb1-49" data-line-number="49"><span class="co">--</span></a>
<a class="sourceLine" id="cb1-50" data-line-number="50"><span class="co">-- * FormResult can be in three states: FormMissing (no data available),</span></a>
<a class="sourceLine" id="cb1-51" data-line-number="51"><span class="co">-- FormFailure (invalid data) and FormSuccess</span></a>
<a class="sourceLine" id="cb1-52" data-line-number="52"><span class="co">--</span></a>
<a class="sourceLine" id="cb1-53" data-line-number="53"><span class="co">-- * The Widget is the viewable form to place into the web page.</span></a>
<a class="sourceLine" id="cb1-54" data-line-number="54"><span class="co">--</span></a>
<a class="sourceLine" id="cb1-55" data-line-number="55"><span class="co">-- Note that the scaffolded site provides a convenient Form type synonym,</span></a>
<a class="sourceLine" id="cb1-56" data-line-number="56"><span class="co">-- so that our signature could be written as:</span></a>
<a class="sourceLine" id="cb1-57" data-line-number="57"><span class="co">--</span></a>
<a class="sourceLine" id="cb1-58" data-line-number="58"><span class="co">-- &gt; personForm :: Form Person</span></a>
<a class="sourceLine" id="cb1-59" data-line-number="59"><span class="co">--</span></a>
<a class="sourceLine" id="cb1-60" data-line-number="60"><span class="co">-- For our purposes, it's good to see the long version.</span></a>
<a class="sourceLine" id="cb1-61" data-line-number="61"><span class="ot">personForm ::</span> <span class="dt">Html</span> <span class="ot">-&gt;</span> <span class="dt">MForm</span> <span class="dt">Handler</span> (<span class="dt">FormResult</span> <span class="dt">Person</span>, <span class="dt">Widget</span>)</a>
<a class="sourceLine" id="cb1-62" data-line-number="62">personForm <span class="fu">=</span> renderDivs <span class="fu">$</span> <span class="dt">Person</span></a>
<a class="sourceLine" id="cb1-63" data-line-number="63">    <span class="fu">&lt;$&gt;</span> areq textField <span class="st">&quot;Name&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb1-64" data-line-number="64">    <span class="fu">&lt;*&gt;</span> areq (jqueryDayField def</a>
<a class="sourceLine" id="cb1-65" data-line-number="65">        { jdsChangeYear <span class="fu">=</span> <span class="dt">True</span> <span class="co">-- give a year dropdown</span></a>
<a class="sourceLine" id="cb1-66" data-line-number="66">        , jdsYearRange <span class="fu">=</span> <span class="st">&quot;1900:-5&quot;</span> <span class="co">-- 1900 till five years ago</span></a>
<a class="sourceLine" id="cb1-67" data-line-number="67">        }) <span class="st">&quot;Birthday&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb1-68" data-line-number="68">    <span class="fu">&lt;*&gt;</span> aopt textField <span class="st">&quot;Favorite color&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb1-69" data-line-number="69">    <span class="fu">&lt;*&gt;</span> areq emailField <span class="st">&quot;Email address&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb1-70" data-line-number="70">    <span class="fu">&lt;*&gt;</span> aopt urlField <span class="st">&quot;Website&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb1-71" data-line-number="71"></a>
<a class="sourceLine" id="cb1-72" data-line-number="72"><span class="co">-- The GET handler displays the form</span></a>
<a class="sourceLine" id="cb1-73" data-line-number="73"><span class="ot">getHomeR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></a>
<a class="sourceLine" id="cb1-74" data-line-number="74">getHomeR <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-75" data-line-number="75">    <span class="co">-- Generate the form to be displayed</span></a>
<a class="sourceLine" id="cb1-76" data-line-number="76">    (widget, enctype) <span class="ot">&lt;-</span> generateFormPost personForm</a>
<a class="sourceLine" id="cb1-77" data-line-number="77">    defaultLayout</a>
<a class="sourceLine" id="cb1-78" data-line-number="78">        [whamlet|</a>
<a class="sourceLine" id="cb1-79" data-line-number="79">            <span class="kw">&lt;p&gt;</span></a>
<a class="sourceLine" id="cb1-80" data-line-number="80">                The widget generated contains only the contents</a>
<a class="sourceLine" id="cb1-81" data-line-number="81">                of the form, not the form tag itself. So...</a>
<a class="sourceLine" id="cb1-82" data-line-number="82">            <span class="kw">&lt;form</span><span class="ot"> method=</span><span class="st">post</span><span class="ot"> action=</span><span class="kw">@{</span><span class="dt">PersonR</span><span class="kw">}</span><span class="ot"> enctype=</span><span class="kw">#{</span>enctype<span class="kw">}&gt;</span></a>
<a class="sourceLine" id="cb1-83" data-line-number="83">                <span class="kw">^{</span>widget<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-84" data-line-number="84">                <span class="kw">&lt;p&gt;</span>It also doesn't include the submit button.</a>
<a class="sourceLine" id="cb1-85" data-line-number="85">                <span class="kw">&lt;button&gt;</span>Submit</a>
<a class="sourceLine" id="cb1-86" data-line-number="86">        |]</a>
<a class="sourceLine" id="cb1-87" data-line-number="87"></a>
<a class="sourceLine" id="cb1-88" data-line-number="88"><span class="co">-- The POST handler processes the form. If it is successful, it displays the</span></a>
<a class="sourceLine" id="cb1-89" data-line-number="89"><span class="co">-- parsed person. Otherwise, it displays the form again with error messages.</span></a>
<a class="sourceLine" id="cb1-90" data-line-number="90"><span class="ot">postPersonR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></a>
<a class="sourceLine" id="cb1-91" data-line-number="91">postPersonR <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb1-92" data-line-number="92">    ((result, widget), enctype) <span class="ot">&lt;-</span> runFormPost personForm</a>
<a class="sourceLine" id="cb1-93" data-line-number="93">    <span class="kw">case</span> result <span class="kw">of</span></a>
<a class="sourceLine" id="cb1-94" data-line-number="94">        <span class="dt">FormSuccess</span> person <span class="ot">-&gt;</span> defaultLayout [whamlet|<span class="kw">&lt;p&gt;#{</span>show person<span class="kw">}</span>|]</a>
<a class="sourceLine" id="cb1-95" data-line-number="95">        _ <span class="ot">-&gt;</span> defaultLayout</a>
<a class="sourceLine" id="cb1-96" data-line-number="96">            [whamlet|</a>
<a class="sourceLine" id="cb1-97" data-line-number="97">                <span class="kw">&lt;p&gt;</span>Invalid input, let's try again.</a>
<a class="sourceLine" id="cb1-98" data-line-number="98">                <span class="kw">&lt;form</span><span class="ot"> method=</span><span class="st">post</span><span class="ot"> action=</span><span class="kw">@{</span><span class="dt">PersonR</span><span class="kw">}</span><span class="ot"> enctype=</span><span class="kw">#{</span>enctype<span class="kw">}&gt;</span></a>
<a class="sourceLine" id="cb1-99" data-line-number="99">                    <span class="kw">^{</span>widget<span class="kw">}</span></a>
<a class="sourceLine" id="cb1-100" data-line-number="100">                    <span class="kw">&lt;button&gt;</span>Submit</a>
<a class="sourceLine" id="cb1-101" data-line-number="101">            |]</a>
<a class="sourceLine" id="cb1-102" data-line-number="102"></a>
<a class="sourceLine" id="cb1-103" data-line-number="103"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb1-104" data-line-number="104">main <span class="fu">=</span> warp <span class="dv">3000</span> <span class="dt">App</span></a></code></pre></div>
<h2 id="kinds-of-forms">Kinds of Forms</h2>
<p>フォームの詳細に入る前に様々な種類のフォームの簡単な説明から始めましょう。 フォームは3種類のカテゴリに分類できます。</p>
<h3 id="applicative">Applicative</h3>
<p>これらは最も一般的に利用されます (さきほどの例でも利用されていました)。 アプリカティブは高レベルの宣言的アプローチによって、エラーメッセージを互いに結合するような素晴らしい性質を与えてくれます (アプリカティブコードの詳細については <a href="http://www.haskell.org/haskellwiki/Applicative_functor%5D">the Haskell wiki</a> を参照してください。</p>
<h3 id="monadic">Monadic</h3>
<p>アプリカティブのより強力な代用品です。 これにより柔軟性は高まりますが、冗長になってしまうというデメリットがあります。 例えば、標準的な2カラムのフォームとは違い、カスタマイズしたレイアウトのフォームを作りたい場合などで利用します。</p>
<h3 id="input">Input</h3>
<p>フォームの入力を受け取るためだけに利用されます。 また、ユーザから入力を受け取るための HTML は生成しません。 すでにフォームが用意されていて、結果のみを受け取りたい場合に使われます。</p>
<p>更にフォームやフィールドごとにいくつかの異なる変数が必要になるでしょう。</p>
<ul>
<li>フィールドは必須かそれとも任意だろうか？</li>
<li>GET と POST のどちらで提出するべきだろうか？</li>
<li>デフォルト値があるか、ないか？</li>
</ul>
<p>最優先の目的はフィールドで定義される変数を最小にして、出来る限り多くの文脈において機能させることです。 これによる1つの結果として、それぞれのフィールドにおける余分な単語を少なくできます。 前の例で <code>areq</code> と <code>Nothing</code> パラメータに気づいたでしょう。 なぜこれらが必要なのかということについては後で説明しますが、今のところはこれらのパラメータを明示的にすることで (<code>intField</code> のような) 個々のフィールドを様々な方法で再利用できるということです。</p>
<p>命名規則の注意点として、各フォームの型は1文字 (A、M、I) の接頭辞を <code>MForm</code> のように使います。 また req や opt を必須や任意の意味を表すために利用します。 これらを組み合わせることで <code>areq</code> は必須アプリカティブフィールド、<code>iopt</code> は任意インプットフィールドを生成します。</p>
<h2 id="types">Types</h2>
<p><code>Yesod.Form.Types</code> モジュールはいくつかの型を定義しています。 利用可能な全ての型を説明するのではなく、最も重要なものにのみ焦点を当てます。 単純なものから順に説明していきます。</p>
<h3 id="enctype">EncType</h3>
<p>エンコーディングタイプは <code>UrlEncoded</code> か <code>Multipart</code> です。 このデータ型は <code>ToHtml</code> 型クラスのインスタンスなので enctype を直接 Hamlet で扱えます。</p>
<h3 id="formresult">FormResult</h3>
<p>3つの状態があります。 データが提出されなかった場合の <code>FormMissing</code>、フォームのパースにおいてエラーが生じた場合 (例えば、必須フィールドが入力されていない、無効な内容など) の、 <code>FormFailure</code>、 全てがうまく行った場合の <code>FormSuccess</code> です。 </p>
<h3 id="formmessage">FormMessage</h3>
<p>データ型として生成することができる全てのメッセージを表します。 例えば <code>MsgInvalidInteger</code> はライブラリが与えられたテキスト値が整数でないことを示すために利用されます。 このデータを十分に体系化することで、あらゆる種類のレンダリング関数を提供可能になり、アプリケーションの国際化 (i18n) が可能となります。</p>
<p>次に、個々のフィールドを定義するためのデータ型を見ていきましょう。 フィールドは、数字、文字列、電子メールアドレスのような単一の情報として定義されます。 フィールドが組み合わさってフォームを構築します。</p>
<h3 id="field">Field</h3>
<p>2つの機能を定義します。 それは、ユーザから入力されたテキスト値を Haskell 値にパースする方法とユーザに表示するウィジェットの生成方法の2つです。 <code>yesod-form</code> は <code>Yesod.Form.Fields</code> で個々のフィールドを定義しています。</p>
<h3 id="fieldsettings">FieldSettings</h3>
<p>FieldSettings は、表示名、任意ツールチップ、ハードコードされた <code>id</code> や <code>name</code> 属性のようなフィールドの情報の表示方法について定義します (何も与えられなかった場合は、自動生成されます)。 最初の例でも利用したように、 <code>FieldSettings</code> は <code>IsString</code> 型クラスのインスタンスとなっているため <code>FieldSettings</code> 値が必要な場合は、通常の文字列リテラルで入力できます。</p>
<p>最後の重要な部分です。 それはフォーム自身で、これには3つの型が存在します。 モナディックフォームのための <code>MForm</code>、アプリカティブフォームのための <code>AForm</code>、インプットフォームのための <code>FormInput</code> があります。 <code>MForm</code> は実際には次の特徴を持つモナドスタックの型シノニムになっています。</p>
<ul>
<li>ユーザが提出したパラメータ、ファウンデーションデータ型、ユーザサポートの言語リストを与えるための <code>Reader</code> モナド。ファウンデーションデータ型とユーザサポートの言語リストは i18n をサポートするために <code>FormMessage</code> のレンダリングで利用されます (詳しくは後で説明します。)</li>
<li><code>Enctype</code> を追跡するための <code>Writer</code> モナド。フォームは常に <code>UrlEncoded</code> なので、ファイル入力フィールドがある場合は代わりに <code>Multipart</code> を使わなければなりません</li>
<li>フィールドのために生成された名前や識別子を追跡する <code>State</code> モナド</li>
</ul>
<p><code>AForm</code> もほとんど同じですが、多少の相違点があります。</p>
<ul>
<li>ユーザに何を表示するか追跡するために <code>FieldView</code> のリストを生成します。これにより、フォームの表示を抽象的な状態に留めておき、最終的にそれをページの下地にするめの適切な関数を選ぶことが可能となります。最初の例では <code>renderDivs</code> を利用しましたが、それは div タグの塊を作ります。他の2つの選択肢として <code>renderBootstrap</code> と <code>renderTable</code> があります。</li>
<li>アプリカティブフォームは <code>Monad</code> のインスタンスではありません。<code>Applicative</code> の目的はフォーム全体が起動し各フィールドに関する出来る限り多くの情報を手に入れ, 最終結果を作ることです。これは <code>Monad</code> の文脈では機能しません。</li>
</ul>
<p><code>FormInput</code> はもっと単純で、エラーメッセージのリストか結果を返します。</p>
<h2 id="converting">Converting</h2>
<p>“しかし、少し待ってください。あなたは、最初の例でアプリカティブフォームを使うと言いましたが、型注釈は <code>MForm</code> となっているので、モナディックフォームなのではないでしょうか?” と、言いたくなる人もいるでしょう。 その通りです。最終的なフォームはモナディックになっています。 しかし、実際にはアプリカティブフォームからモナディックフォームへの変換が起こっているのです。</p>
<p>目標を再確認しましょう。私たちの目標は、コードを出来る限り再利用し、API における関数の数を最小限にすることでした。 そして、モナディックフォームは少し使いにくい部分もありますが、アプリカティブフォームより強力です。 そのため、アプリカティブフォームで表現できるものは全て、モナディックフォームでも表現可能です。 この変換のためには2つの重要な関数があります。 <code>aformToForm</code> はあらゆるアプリカティブフォームをモナディックフォームへ変換し、 <code>formToAForm</code> は特定のモナディックフォームをアプリカティブフォームに変換します。</p>
<p>“ちょっと待って。どこを見ても <code>aformToForm</code> なんてありませんよ。” とあなたは言うでしょう。 その通りです。<code>renderDivs</code> 関数の内部で利用されているんです。</p>
<h2 id="create-aforms">Create AFormS</h2>
<p>最初の例で、実際にはアプリカティブフォームを使っていたことを (おそらく) 納得してもらえたでしょう。 これらが、どのように作られるか確認しながら理解を深めましょう。 以下はフォームを作る簡単な例です。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">data</span> <span class="dt">Car</span> <span class="fu">=</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">    {<span class="ot"> carModel ::</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    ,<span class="ot"> carYear  ::</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">    }</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="kw">deriving</span> <span class="dt">Show</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="ot">carAForm ::</span> <span class="dt">AForm</span> <span class="dt">Handler</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">carAForm <span class="fu">=</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">    <span class="fu">&lt;$&gt;</span> areq textField <span class="st">&quot;Model&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">    <span class="fu">&lt;*&gt;</span> areq intField <span class="st">&quot;Year&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="ot">carForm ::</span> <span class="dt">Html</span> <span class="ot">-&gt;</span> <span class="dt">MForm</span> <span class="dt">Handler</span> (<span class="dt">FormResult</span> <span class="dt">Car</span>, <span class="dt">Widget</span>)</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">carForm <span class="fu">=</span> renderTable carAForm</a></code></pre></div>
<p>ここでは、明示的にアプリカティブフォームとモナディックフォームを区別しています。 <code>carAForm</code> においては <code>&lt;$&gt;</code> と <code>&lt;*&gt;</code> 演算子を利用していますが、これは驚くべきことではありません。 アプリカティブ形式のコードはたいていこのようになります。 そしてそれぞれの行が <code>Car</code> データ型のレコードと対応しています。 これも驚くべきことではありません。 <code>Text</code> レコードには <code>TextField</code>、<code>Int</code> レコードには <code>IntField</code> を利用しています。</p>
<p>もっと注意深く <code>areq</code> 関数をみてみましょう。 その (単純化された) 型注釈は <code>Field a -&gt; FieldSettings -&gt; Maybe a -&gt; AForm a</code> です。 最初の引数はこのフィールドのデータ型、パース方法、、レンダリング方法を指定します。 また、次の引数の <code>FieldSettings</code> は、ラベル、ツールチップ、名前、フィールドのIDを伝えるためのものです。 今回の場合は、先ほど説明した <code>FieldSettings</code> が <code>IsString</code> のインスタンスだということを利用して FieldSettings を生成しています。</p>
<p>また <code>Maybe a</code> は何でしょうか？ それは、任意の初期値です。 例えば、CarYear の初期値を “2007” にする場合は <code>areq intField &quot;year&quot; (Just 2007)</code> とします。 さらに、フォーム全体の初期値を考えることもでき、その場合は任意パラメータとしてフォーム全体の初期値を取るようにすれば良いでしょう。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="ot">carAForm ::</span> <span class="dt">Maybe</span> <span class="dt">Car</span> <span class="ot">-&gt;</span> <span class="dt">AForm</span> <span class="dt">Handler</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">carAForm mcar <span class="fu">=</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    <span class="fu">&lt;$&gt;</span> areq textField <span class="st">&quot;Model&quot;</span> (carModel <span class="fu">&lt;$&gt;</span> mcar)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    <span class="fu">&lt;*&gt;</span> areq intField  <span class="st">&quot;Year&quot;</span>  (carYear  <span class="fu">&lt;$&gt;</span> mcar)</a></code></pre></div>
<h3 id="任意フィールド">任意フィールド</h3>
<p>(車の色) のような任意フィールドにしたい場合は areq を <code>aopt</code> に置き換えるだけで済みます。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="ot">carAForm ::</span> <span class="dt">AForm</span> <span class="dt">Handler</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">carAForm <span class="fu">=</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">    <span class="fu">&lt;$&gt;</span> areq textField <span class="st">&quot;Model&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    <span class="fu">&lt;*&gt;</span> areq intField <span class="st">&quot;Year&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">    <span class="fu">&lt;*&gt;</span> aopt textField <span class="st">&quot;Color&quot;</span> <span class="dt">Nothing</span></a></code></pre></div>
<p>そして、必須フィールドのように、最後の引数は任意の初期値です。 しかし、これは2層の Maybe でラッピングされています。 これは、少し冗長ではありますが、次の例で示すように、任意のフォーム初期値を取るコードを綺麗に書けます。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="ot">carAForm ::</span> <span class="dt">Maybe</span> <span class="dt">Car</span> <span class="ot">-&gt;</span> <span class="dt">AForm</span> <span class="dt">Handler</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">carAForm mcar <span class="fu">=</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    <span class="fu">&lt;$&gt;</span> areq textField <span class="st">&quot;Model&quot;</span> (carModel <span class="fu">&lt;$&gt;</span> mcar)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    <span class="fu">&lt;*&gt;</span> areq intField  <span class="st">&quot;Year&quot;</span>  (carYear  <span class="fu">&lt;$&gt;</span> mcar)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">    <span class="fu">&lt;*&gt;</span> aopt textField <span class="st">&quot;Color&quot;</span> (carColor <span class="fu">&lt;$&gt;</span> mcar)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="ot">carForm ::</span> <span class="dt">Html</span> <span class="ot">-&gt;</span> <span class="dt">MForm</span> <span class="dt">Handler</span> (<span class="dt">FormResult</span> <span class="dt">Car</span>, <span class="dt">Widget</span>)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">carForm <span class="fu">=</span> renderTable <span class="fu">$</span> carAForm <span class="fu">$</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="dt">Car</span> <span class="st">&quot;Forte&quot;</span> <span class="dv">2010</span> <span class="fu">$</span> <span class="dt">Just</span> <span class="st">&quot;gray&quot;</span></a></code></pre></div>
<h2 id="validation">Validation</h2>
<p>どのようにすれば1990年以降に作られた車だけを受け付けるフォームを作ることができるでしょうか？ <code>Field</code> は有効な入力値に関する情報を含んでいたことを思い出してください。 検証パターンごとに新しい <code>Field</code> を毎回書かなければならないとなると、それは少し面倒です。 なので、既存のコードを修正する方法にしましょう。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="ot">carAForm ::</span> <span class="dt">Maybe</span> <span class="dt">Car</span> <span class="ot">-&gt;</span> <span class="dt">AForm</span> <span class="dt">Handler</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">carAForm mcar <span class="fu">=</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="fu">&lt;$&gt;</span> areq textField    <span class="st">&quot;Model&quot;</span> (carModel <span class="fu">&lt;$&gt;</span> mcar)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    <span class="fu">&lt;*&gt;</span> areq carYearField <span class="st">&quot;Year&quot;</span>  (carYear  <span class="fu">&lt;$&gt;</span> mcar)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    <span class="fu">&lt;*&gt;</span> aopt textField    <span class="st">&quot;Color&quot;</span> (carColor <span class="fu">&lt;$&gt;</span> mcar)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="ot">    errorMessage ::</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">    errorMessage <span class="fu">=</span> <span class="st">&quot;Your car is too old, get a new one!&quot;</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"></a>
<a class="sourceLine" id="cb6-10" data-line-number="10">    carYearField <span class="fu">=</span> check validateYear intField</a>
<a class="sourceLine" id="cb6-11" data-line-number="11"></a>
<a class="sourceLine" id="cb6-12" data-line-number="12">    validateYear y</a>
<a class="sourceLine" id="cb6-13" data-line-number="13">        <span class="fu">|</span> y <span class="fu">&lt;</span> <span class="dv">1990</span> <span class="fu">=</span> <span class="dt">Left</span> errorMessage</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">        <span class="fu">|</span> otherwise <span class="fu">=</span> <span class="dt">Right</span> y</a></code></pre></div>
<p>ここでのトリックは <code>check</code> 関数です。 <code>check</code> 関数は関数 (<code>validateYear</code>) を取り、エラーメッセージか変更されたフィールド値を返します。 この例では、値は全く変更されていません。 それはよくあることです。 この種のチェックは非常に日常的なことなので checkBool という関数が用意されています。</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" data-line-number="1">carYearField <span class="fu">=</span> checkBool (<span class="fu">&gt;=</span> <span class="dv">1990</span>) errorMessage intField</a></code></pre></div>
<p><code>checkBool</code> は満たすべき条件と、もしそうでなかった場合に表示するエラーメッセージの2つの引数を取ります。</p>
<p><code>errorMessage</code> における明示的な <code>Text</code> 型注釈に気づいたでしょう。 <code>OverLoadedStrings</code> を利用している場合に必要となります。 i18n をサポートするために、メッセージは多くの異なるデータ型になれますが、GHCは <code>IsString</code> のどのインスタンスを使えば良いのか決定できません。</p>
<p>車があまり古すぎないことを確実にできることは素晴らしいです。 しかし、指定された値が将来のものでないことを確かめるにはどうしたら良いでしょうか？ 現在の年を探すために何らかの <code>IO</code> を実行する必要があります。 このような状況においては <code>checkM</code> を使うことで任意のアクションを実行する検証コードが書けるようになります。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" data-line-number="1">    carYearField <span class="fu">=</span> checkM inPast <span class="fu">$</span> checkBool (<span class="fu">&gt;=</span> <span class="dv">1990</span>) errorMessage intField</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">    inPast y <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">        thisYear <span class="ot">&lt;-</span> liftIO getCurrentYear</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">        return <span class="fu">$</span> <span class="kw">if</span> y <span class="fu">&lt;=</span> thisYear</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">            <span class="kw">then</span> <span class="dt">Right</span> y</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">            <span class="kw">else</span> <span class="dt">Left</span> (<span class="st">&quot;You have a time machine!&quot;</span><span class="ot"> ::</span> <span class="dt">Text</span>)</a>
<a class="sourceLine" id="cb8-8" data-line-number="8"></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="ot">getCurrentYear ::</span> <span class="dt">IO</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">getCurrentYear <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11">    now <span class="ot">&lt;-</span> getCurrentTime</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">    <span class="kw">let</span> today <span class="fu">=</span> utctDay now</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">    <span class="kw">let</span> (year, _, _) <span class="fu">=</span> toGregorian today</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">    return <span class="fu">$</span> fromInteger year</a></code></pre></div>
<p><code>inPast</code> は <code>Handler</code> モナドに包まれた <code>Either</code> 型の結果を返す関数です。 現在の年を得るために <code>liftIO getCurrentYear</code> を利用し、それをユーザの入力した年と比較しています。 また、複数の検証をつなぐことができることにも注目してください。</p>
<p><code>checkM</code> 検証機は <code>Handler</code> モナドの中で実行されるため、Yesod でたいてい扱われるような多くのものにアクセス可能である. これは特にデータベースアクションを実行する際に便利です。詳細は Persistent の章で扱います。</p>
<h2 id="more-sophisticated-fields">More sophisticated fields</h2>
<p>今回のカラーフィールドは良いものですが、十分にユーザーフレンドリーなものとは言えません。 ユーザが期待しているものはドロップダウンリストでしょう。</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">data</span> <span class="dt">Car</span> <span class="fu">=</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">    {<span class="ot"> carModel ::</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">    ,<span class="ot"> carYear ::</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    ,<span class="ot"> carColor ::</span> <span class="dt">Maybe</span> <span class="dt">Color</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    }</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="kw">deriving</span> <span class="dt">Show</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="kw">data</span> <span class="dt">Color</span> <span class="fu">=</span> <span class="dt">Red</span> <span class="fu">|</span> <span class="dt">Blue</span> <span class="fu">|</span> <span class="dt">Gray</span> <span class="fu">|</span> <span class="dt">Black</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">    <span class="kw">deriving</span> (<span class="dt">Show</span>, <span class="dt">Eq</span>, <span class="dt">Enum</span>, <span class="dt">Bounded</span>)</a>
<a class="sourceLine" id="cb9-10" data-line-number="10"></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="ot">carAForm ::</span> <span class="dt">Maybe</span> <span class="dt">Car</span> <span class="ot">-&gt;</span> <span class="dt">AForm</span> <span class="dt">Handler</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12">carAForm mcar <span class="fu">=</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13">    <span class="fu">&lt;$&gt;</span> areq textField <span class="st">&quot;Model&quot;</span> (carModel <span class="fu">&lt;$&gt;</span> mcar)</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">    <span class="fu">&lt;*&gt;</span> areq carYearField <span class="st">&quot;Year&quot;</span> (carYear <span class="fu">&lt;$&gt;</span> mcar)</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">    <span class="fu">&lt;*&gt;</span> aopt (selectFieldList colors) <span class="st">&quot;Color&quot;</span> (carColor <span class="fu">&lt;$&gt;</span> mcar)</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="ot">    colors ::</span> [(<span class="dt">Text</span>, <span class="dt">Color</span>)]</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">    colors <span class="fu">=</span> [(<span class="st">&quot;Red&quot;</span>, <span class="dt">Red</span>), (<span class="st">&quot;Blue&quot;</span>, <span class="dt">Blue</span>), (<span class="st">&quot;Gray&quot;</span>, <span class="dt">Gray</span>), (<span class="st">&quot;Black&quot;</span>, <span class="dt">Black</span>)]</a></code></pre></div>
<p><code>selectFieldList</code> はタプルのリストを取ります。 タプルの第1要素はドロップダウンリストでユーザに表示するテキストです。 また、第2要素は実際の Haskell 値です。 もちろん、上のようなコードはかなり繰り返しの多いものに見えます。 GHC が自動的に導出する Enum や Bounded インスタンスを使うことで同じ結果が得られます。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" data-line-number="1">colors <span class="fu">=</span> map (pack <span class="fu">.</span> show <span class="fu">&amp;&amp;&amp;</span> id) [minBound<span class="fu">..</span>maxBound]</a></code></pre></div>
<p><code>[minBound..maxBound]</code> は異なる <code>Color</code> 値のリストとなります。 <code>map</code> と <code>&amp;&amp;&amp;</code> (いわゆるファンアウト演算子) を適用することで、それをタプルのリストにしています。 また、さらにこれは yesod-form により提供される <code>optionsEnum</code> 関数を使ってさらに簡略化すると、最終的なコードは次のようになります。</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="ot">carAForm ::</span> <span class="dt">Maybe</span> <span class="dt">Car</span> <span class="ot">-&gt;</span> <span class="dt">AForm</span> <span class="dt">Handler</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">carAForm mcar <span class="fu">=</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">    <span class="fu">&lt;$&gt;</span> areq textField <span class="st">&quot;Model&quot;</span> (carModel <span class="fu">&lt;$&gt;</span> mcar)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">    <span class="fu">&lt;*&gt;</span> areq carYearField <span class="st">&quot;Year&quot;</span> (carYear <span class="fu">&lt;$&gt;</span> mcar)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">    <span class="fu">&lt;*&gt;</span> aopt (selectField optionsEnum) <span class="st">&quot;Color&quot;</span> (carColor <span class="fu">&lt;$&gt;</span> mcar)</a></code></pre></div>
<p>ドロップダウンリストよりもラジオボタンを好む人がいるかも知れません。 幸いなことに、これはただ1つのワードを変更するだけで済みます。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" data-line-number="1">carAForm <span class="fu">=</span> <span class="dt">Car</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">    <span class="fu">&lt;$&gt;</span> areq textField                    <span class="st">&quot;Model&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">    <span class="fu">&lt;*&gt;</span> areq intField                     <span class="st">&quot;Year&quot;</span>  <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">    <span class="fu">&lt;*&gt;</span> aopt (radioField optionsEnum) <span class="st">&quot;Color&quot;</span> <span class="dt">Nothing</span></a></code></pre></div>
<h2 id="running-forms">Running forms</h2>
<p>どこかのタイミングで、素晴らしいフォームを使って何らかの結果を作り出す必要があります。 このために用意されたいくつもの異なる関数が存在しそれぞれが独自の目的を持っています。 最も一般的なものからはじめて、それらを一通り見てみましょう。</p>
<h3 id="runformpost">runFormPost</h3>
<p>これは、提出された <code>POST</code> パラメータに対してフォームを実行します。 もし、これが <code>POST</code> 提出でなければ <code>FormMissing</code> が返ります。 これは自動的にセキュリティトークンを hidden フィールドとして挿入し <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">クロスサイトリクエストフォージェリ</a>(CSRF) 攻撃を回避します。</p>
<h2 id="runformget">runFormGet</h2>
<p>GETパラメータのための <code>runFormPost</code> です。 <code>GET</code> 提出による通常の <code>GET</code> によるページ読み込みと区別するために、<code>_hasdata</code> hidden フィールドをフォームに含めます。 <code>runFormPost</code> と異なる点は CSRF 保護がないことです</p>
<h3 id="runformpostnotoken">runFormPostNoToken</h3>
<p><code>runFormPost</code> と同じですが、CSRF セキュリティトークンを含みません (あるいは必要としません)。</p>
<h3 id="generateformpost">generateFormPost</h3>
<p>既存の <code>POST</code> パラメータを受け取る代わりに、あたかも何のパラメータもなかったかのように振る舞います。 これは、ウィザードの場合のように前のフォームが提出された後に新しいフォームを生成する場合にとても便利です。</p>
<h3 id="generateformget">generateFormGet</h3>
<p><code>generateFormPost</code> と同じですが <code>GET</code>用です。</p>
<p>はじめの3つにおける結果の型は <code>((FormResult a, Widget), Enctype)</code> です。 <code>Widget</code> はこの段階で検証エラーと前に提出された値を持っています。</p>
<p>なぜ特定のデータ型の代わりに、ネストしたタプルを用いるのでしょうか？ これは <code>runFormPostNoToken</code> と <code>runFormGet</code> が <code>FormResult</code> や <code>Widget</code> を返さないフォームで用いられるようにするためです。 これは (以下で論ずるような) より洗練されたモナドフォームを用いる場合に便利です。</p>
<h2 id="i18n">i18n</h2>
<p>今回 i18n は少ししか説明しませんが、別の章でより徹底的に取り上げます。 i18n は <code>yesod-form</code> にかなり深い影響をもたらすため、簡単に説明したいと思います。 Yesod において i18n の背景にあるアイデアは、データ型にメッセージを表現させることです。 各サイトは与えられたデータ型に対する <code>RenderMessage</code> のインスタンスを持てます。 それは、ユーザが許容する言語リストにもとづいてメッセージを翻訳するものです。 これら全ての結果として多少の注意すべきことがあります。</p>
<ul>
<li>全てのサイトは自動的に <code>Text</code> に対する <code>RenderMessage</code> のインスタンスになります。従って i18n サポートの心配をしなくてもプレーンな文字列を用いることができます。しかし、明示的な型注釈が必要なときもあります。</li>
<li><code>yesod-form</code> は全てのメッセージを <code>FormMessage</code> データ型として扱います。従って <code>yesod-form</code> を用いるためには、適切な <code>RenderMessage</code> インスタンス宣言をする必要があります。デフォルトの英語翻訳を用いる例は以下の通りです</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">RenderMessage</span> <span class="dt">App</span> <span class="dt">FormMessage</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">    renderMessage _ _ <span class="fu">=</span> defaultFormMessage</a></code></pre></div>
<p>これは scaffolded サイトでは、自動的に行われます。</p>
<h2 id="monadic-forms">Monadic Forms</h2>
<p>単純なフォームレイアウトで十分な場合はアプリカティブフォームを使うべきです。 しかし、フォームをもっとカスタマイズした見た目にしたいときもあるでしょう。</p>
<p>TODO: 画像入れる。</p>
<p>そういった時に、モナディックフォームを使います。 それらは、アプリカティブの場合よりも少し冗長になりますが、それを受け入れればフォームの見え方を完全にコントロールできるようになります。 上の画像のようなフォームを生成するためには、次のようにコーディングすれば良いでしょう。</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="ot">{-# LANGUAGE MultiParamTypeClasses #-}</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="ot">{-# LANGUAGE OverloadedStrings     #-}</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="ot">{-# LANGUAGE QuasiQuotes           #-}</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="ot">{-# LANGUAGE TemplateHaskell       #-}</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="ot">{-# LANGUAGE TypeFamilies          #-}</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="kw">import</span>           <span class="dt">Control.Applicative</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="kw">import</span>           <span class="dt">Data.Text</span>           (<span class="dt">Text</span>)</a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="kw">import</span>           <span class="dt">Yesod</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="kw">data</span> <span class="dt">App</span> <span class="fu">=</span> <span class="dt">App</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"></a>
<a class="sourceLine" id="cb14-12" data-line-number="12">mkYesod <span class="st">&quot;App&quot;</span> [parseRoutes|</a>
<a class="sourceLine" id="cb14-13" data-line-number="13">/ HomeR GET</a>
<a class="sourceLine" id="cb14-14" data-line-number="14">|]</a>
<a class="sourceLine" id="cb14-15" data-line-number="15"></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="kw">instance</span> <span class="dt">Yesod</span> <span class="dt">App</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="kw">instance</span> <span class="dt">RenderMessage</span> <span class="dt">App</span> <span class="dt">FormMessage</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19">    renderMessage _ _ <span class="fu">=</span> defaultFormMessage</a>
<a class="sourceLine" id="cb14-20" data-line-number="20"></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="kw">data</span> <span class="dt">Person</span> <span class="fu">=</span> <span class="dt">Person</span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22">    {<span class="ot"> personName ::</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb14-23" data-line-number="23">    ,<span class="ot"> personAge  ::</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb14-24" data-line-number="24">    }</a>
<a class="sourceLine" id="cb14-25" data-line-number="25">    <span class="kw">deriving</span> <span class="dt">Show</span></a>
<a class="sourceLine" id="cb14-26" data-line-number="26"></a>
<a class="sourceLine" id="cb14-27" data-line-number="27"><span class="ot">personForm ::</span> <span class="dt">Html</span> <span class="ot">-&gt;</span> <span class="dt">MForm</span> <span class="dt">Handler</span> (<span class="dt">FormResult</span> <span class="dt">Person</span>, <span class="dt">Widget</span>)</a>
<a class="sourceLine" id="cb14-28" data-line-number="28">personForm extra <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb14-29" data-line-number="29">    (nameRes, nameView) <span class="ot">&lt;-</span> mreq textField <span class="st">&quot;this is not used&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb14-30" data-line-number="30">    (ageRes, ageView) <span class="ot">&lt;-</span> mreq intField <span class="st">&quot;neither is this&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb14-31" data-line-number="31">    <span class="kw">let</span> personRes <span class="fu">=</span> <span class="dt">Person</span> <span class="fu">&lt;$&gt;</span> nameRes <span class="fu">&lt;*&gt;</span> ageRes</a>
<a class="sourceLine" id="cb14-32" data-line-number="32">    <span class="kw">let</span> widget <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb14-33" data-line-number="33">            toWidget</a>
<a class="sourceLine" id="cb14-34" data-line-number="34">                [lucius|</a>
<a class="sourceLine" id="cb14-35" data-line-number="35">                    ##{fvId ageView} {</a>
<a class="sourceLine" id="cb14-36" data-line-number="36">                        width: 3em;</a>
<a class="sourceLine" id="cb14-37" data-line-number="37">                    }</a>
<a class="sourceLine" id="cb14-38" data-line-number="38">                |]</a>
<a class="sourceLine" id="cb14-39" data-line-number="39">            [whamlet|</a>
<a class="sourceLine" id="cb14-40" data-line-number="40">                <span class="kw">#{</span>extra<span class="kw">}</span></a>
<a class="sourceLine" id="cb14-41" data-line-number="41">                <span class="kw">&lt;p&gt;</span></a>
<a class="sourceLine" id="cb14-42" data-line-number="42">                    Hello, my name is #</a>
<a class="sourceLine" id="cb14-43" data-line-number="43">                    <span class="kw">^{</span>fvInput nameView<span class="kw">}</span></a>
<a class="sourceLine" id="cb14-44" data-line-number="44">                    \ and I am #</a>
<a class="sourceLine" id="cb14-45" data-line-number="45">                    <span class="kw">^{</span>fvInput ageView<span class="kw">}</span></a>
<a class="sourceLine" id="cb14-46" data-line-number="46">                    \ years old. #</a>
<a class="sourceLine" id="cb14-47" data-line-number="47">                    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">submit</span><span class="ot"> value=</span><span class="st">&quot;Introduce myself&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb14-48" data-line-number="48">            |]</a>
<a class="sourceLine" id="cb14-49" data-line-number="49">    return (personRes, widget)</a>
<a class="sourceLine" id="cb14-50" data-line-number="50"></a>
<a class="sourceLine" id="cb14-51" data-line-number="51"><span class="ot">getHomeR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></a>
<a class="sourceLine" id="cb14-52" data-line-number="52">getHomeR <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb14-53" data-line-number="53">    ((res, widget), enctype) <span class="ot">&lt;-</span> runFormGet personForm</a>
<a class="sourceLine" id="cb14-54" data-line-number="54">    defaultLayout</a>
<a class="sourceLine" id="cb14-55" data-line-number="55">        [whamlet|</a>
<a class="sourceLine" id="cb14-56" data-line-number="56">            <span class="kw">&lt;p&gt;</span>Result: <span class="kw">#{</span>show res<span class="kw">}</span></a>
<a class="sourceLine" id="cb14-57" data-line-number="57">            <span class="kw">&lt;form</span><span class="ot"> enctype=</span><span class="kw">#{</span>enctype<span class="kw">}&gt;</span></a>
<a class="sourceLine" id="cb14-58" data-line-number="58">                <span class="kw">^{</span>widget<span class="kw">}</span></a>
<a class="sourceLine" id="cb14-59" data-line-number="59">        |]</a>
<a class="sourceLine" id="cb14-60" data-line-number="60"></a>
<a class="sourceLine" id="cb14-61" data-line-number="61"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb14-62" data-line-number="62">main <span class="fu">=</span> warp <span class="dv">3000</span> <span class="dt">App</span></a></code></pre></div>
<p>アプリカティブにおける <code>areq</code> と同じように、モナディックフォームには <code>mreq</code> を使います (また、任意フィールドの <code>mopt</code> もあります)。 大きな違いは <code>mreq</code> は値のペアを返すことです。 FieldView 値を隠して、自動的にそれをウィジットに挿入する代わりに好きな場所に挿入することができます。</p>
<p><code>FieldView</code>はいくつもの情報を持ちますが、最も重要なものは実際のフォームフィールドとなる <code>fvInput</code> です。 この例ではインプットタグの HTML に <code>id</code> 属性を追加する <code>fvId</code> も利用しました。 今回の例ではフィールドの幅を指定するために指定しました。</p>
<p>“これは使われていません” や “これも使われていません” の値は何になるのだろうかと不思議に思うでしょう。 <code>mreq</code> は <code>FieldSettings</code> を第2引数に取ります。 <code>FieldSettings</code> は <code>IsString</code> 型クラスのインスタンスであるので、コンパイラによって文字列は以下のように展開されます。</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb15-1" data-line-number="1">fromString <span class="st">&quot;this is not used&quot;</span> <span class="fu">==</span> <span class="dt">FieldSettings</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">    { fsLabel <span class="fu">=</span> <span class="st">&quot;this is not used&quot;</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">    , fsTooltip <span class="fu">=</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">    , fsId <span class="fu">=</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">    , fsName <span class="fu">=</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">    , fsAttrs <span class="fu">=</span> []</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">    }</a></code></pre></div>
<p>アプリカティブフォームの場合 <code>fsLabel</code> と <code>fsTooltip</code> の値は HTML を構築するために利用されました。 モナディックフォームの場合は HTML の “ラッパー” は生成されないため、これらの値は無視されます。 しかし、場合によっては <code>id</code> や <code>name</code> 属性を上書きするために <code>FieldSettings</code> パラメータを持ち続けます。</p>
<p>他に面白いものは <code>extra</code> の値です。 <code>GET</code> フォームは提出されたものであることを示すため、<code>POST</code> フォームは CSRF 攻撃を防ぐためにセキュリティトークンをこの値に持ちます。 もし、この追加的な hidden フィールドが含まれない場合、フォームの提出は失敗します。</p>
<p>それ以外は本当にそのままです。 <code>nameRes</code> と <code>ageRes</code> を組み合わせることで <code>personRes</code> の値を作り、 person とウィジェットのタプルを返します。 そして <code>getHomeR</code> 関数では全てはアプリカティブフォームと同様です。 実際に、モナディックフォームとアプリカティブフォームを交換してもコードは問題なく動きます。</p>
<h2 id="input-forms">Input forms</h2>
<p>アプリカティブフォームやモナディックフォームは共に HTML コードの生成とユーザ入力の構文解析を行います。 たまには、既にどこかに HTML フォームが存在したり、Javascript を使って動的にフォームを生成したいような場合やフォームの入力処理のみ行うことがあるかもしれません。 そのような場合にインプットフォームを用います。</p>
<p>これらは、多少の違いを除き大部分がアプリカティブフォームとモナディックフォームと同様に機能します。</p>
<ul>
<li><code>runInputPost</code> と <code>runInputGet</code> を利用します</li>
<li><code>ireq</code> と <code>iopt</code> を利用します。これらの関数は2つの引数しか取りません。フィールド型と該当するフィールドの名前 (すなわちHTMLの <code>name</code> 属性) です。</li>
<li>フォームを実行した後は値を返します。ウィジェットやエンコーディングタイプは返しません。</li>
<li>もし、何らかの検証エラーがあった場合、ページは “無効な引数” のエラーページを返します。</li>
</ul>
<p>インプットフォームを使って先ほどの例を再構築できます。 しかし、インプットバージョンはそれほどユーザーフレンドリーでないことに注意してください。 もし、アプリカティブフォームやモナディックフォームで入力を間違えた場合、前に入力した値と何を修正するかについての説明を持って、同じページに戻ることができます。 インプットフォームでは、ユーザにはエラーメッセージが表示されるのみです。</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="ot">{-# LANGUAGE MultiParamTypeClasses #-}</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="ot">{-# LANGUAGE OverloadedStrings     #-}</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="ot">{-# LANGUAGE QuasiQuotes           #-}</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="ot">{-# LANGUAGE TemplateHaskell       #-}</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="ot">{-# LANGUAGE TypeFamilies          #-}</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="kw">import</span>           <span class="dt">Control.Applicative</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="kw">import</span>           <span class="dt">Data.Text</span>           (<span class="dt">Text</span>)</a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="kw">import</span>           <span class="dt">Yesod</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="kw">data</span> <span class="dt">App</span> <span class="fu">=</span> <span class="dt">App</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"></a>
<a class="sourceLine" id="cb16-12" data-line-number="12">mkYesod <span class="st">&quot;App&quot;</span> [parseRoutes|</a>
<a class="sourceLine" id="cb16-13" data-line-number="13">/ HomeR GET</a>
<a class="sourceLine" id="cb16-14" data-line-number="14">/input InputR GET</a>
<a class="sourceLine" id="cb16-15" data-line-number="15">|]</a>
<a class="sourceLine" id="cb16-16" data-line-number="16"></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="kw">instance</span> <span class="dt">Yesod</span> <span class="dt">App</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="kw">instance</span> <span class="dt">RenderMessage</span> <span class="dt">App</span> <span class="dt">FormMessage</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb16-20" data-line-number="20">    renderMessage _ _ <span class="fu">=</span> defaultFormMessage</a>
<a class="sourceLine" id="cb16-21" data-line-number="21"></a>
<a class="sourceLine" id="cb16-22" data-line-number="22"><span class="kw">data</span> <span class="dt">Person</span> <span class="fu">=</span> <span class="dt">Person</span></a>
<a class="sourceLine" id="cb16-23" data-line-number="23">    {<span class="ot"> personName ::</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb16-24" data-line-number="24">    ,<span class="ot"> personAge  ::</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb16-25" data-line-number="25">    }</a>
<a class="sourceLine" id="cb16-26" data-line-number="26">    <span class="kw">deriving</span> <span class="dt">Show</span></a>
<a class="sourceLine" id="cb16-27" data-line-number="27"></a>
<a class="sourceLine" id="cb16-28" data-line-number="28"><span class="ot">getHomeR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></a>
<a class="sourceLine" id="cb16-29" data-line-number="29">getHomeR <span class="fu">=</span> defaultLayout</a>
<a class="sourceLine" id="cb16-30" data-line-number="30">    [whamlet|</a>
<a class="sourceLine" id="cb16-31" data-line-number="31">        <span class="kw">&lt;form</span><span class="ot"> action=</span><span class="kw">@{</span><span class="dt">InputR</span><span class="kw">}&gt;</span></a>
<a class="sourceLine" id="cb16-32" data-line-number="32">            <span class="kw">&lt;p&gt;</span></a>
<a class="sourceLine" id="cb16-33" data-line-number="33">                My name is</a>
<a class="sourceLine" id="cb16-34" data-line-number="34">                <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">text</span><span class="ot"> name=</span><span class="st">name</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb16-35" data-line-number="35">                and I am</a>
<a class="sourceLine" id="cb16-36" data-line-number="36">                <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">text</span><span class="ot"> name=</span><span class="st">age</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb16-37" data-line-number="37">                years old.</a>
<a class="sourceLine" id="cb16-38" data-line-number="38">                <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">submit</span><span class="ot"> value=</span><span class="st">&quot;Introduce myself&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb16-39" data-line-number="39">    |]</a>
<a class="sourceLine" id="cb16-40" data-line-number="40"></a>
<a class="sourceLine" id="cb16-41" data-line-number="41"><span class="ot">getInputR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></a>
<a class="sourceLine" id="cb16-42" data-line-number="42">getInputR <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb16-43" data-line-number="43">    person <span class="ot">&lt;-</span> runInputGet <span class="fu">$</span> <span class="dt">Person</span></a>
<a class="sourceLine" id="cb16-44" data-line-number="44">                <span class="fu">&lt;$&gt;</span> ireq textField <span class="st">&quot;name&quot;</span></a>
<a class="sourceLine" id="cb16-45" data-line-number="45">                <span class="fu">&lt;*&gt;</span> ireq intField <span class="st">&quot;age&quot;</span></a>
<a class="sourceLine" id="cb16-46" data-line-number="46">    defaultLayout [whamlet|<span class="kw">&lt;p&gt;#{</span>show person<span class="kw">}</span>|]</a>
<a class="sourceLine" id="cb16-47" data-line-number="47"></a>
<a class="sourceLine" id="cb16-48" data-line-number="48"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb16-49" data-line-number="49">main <span class="fu">=</span> warp <span class="dv">3000</span> <span class="dt">App</span></a></code></pre></div>
<h2 id="custom-fields">Custom fields</h2>
<p>Yesod が提供しているフィールドでかなり広範なフォームのニーズを満たすでしょう。 しかし、時にはそれで満足しないこともあるでしょう。その時は自分で Yesod に新規フィールドを作ることができます。 <code>Field</code>のコンストラクタは3つの値を取ります。 <code>fieldParse</code> はユーザが提出した値のリストを取り、次の3つのどれかを返します。</p>
<ul>
<li>検証が失敗したことを示すエラーメッセージ</li>
<li>パースされた値</li>
<li>Nothing、すなわちデータが与えられなかったことを表します</li>
</ul>
<p>最後のケースは驚くべきことのように聞こえるかも知れません。 インプットリストが空の時 Yesod が自動的に情報が与えられなかったと判断するように見えるからです。 しかし、実際にはあるフイールド型においてはインプットが無いことは実質的には妥当なインプットになります。 例えば、チェックボックスは空リストが送信されることでチェックされない状態を表します。</p>
<p>また、どうしてリストなのでしょうか？  <code>Maybe</code> の方が良いのではいのでしょうか？ そんなことはありません。グループ化されたチェックボックスや、複数選択リストについては同じ名前で複数のウィジッドを持ちます。 下の例では、このトリックを利用しています。</p>
<p>コンストラクタの2つ目の値は <code>fieldView</code> です。 これはウィジェットをレンダリングしてユーザに表示します。 この関数は次の引数を取ります。</p>
<ol type="1">
<li><code>id</code> 属性</li>
<li><code>name</code> 属性</li>
<li>他の任意の属性</li>
<li>結果は <code>Either</code> 値として返されます。これは (パーシングが失敗した場合は) まだパースが済んでいない入力かパースに成功した値をです。<code>intField</code> はこの機構を示す素晴らしい例です。 <code>42</code> を入力すれば結果の値は <code>Right 42</code> になりますが、<code>turtle</code> を入力すると結果は <code>Left &quot;turtle&quot;</code> になります。これらの値をインプットタグのvalue 属性に変更することでユーザビリティを損なわないようにできます</li>
<li>フィールドが必須かを示す <code>Bool</code> 値</li>
</ol>
<p>コンストラクタの最後の値は <code>fieldEnctype</code> で、ファイルアップロードを扱う場合に <code>Multipart</code> になり、その他の場合は <code>UrlEncoded</code> となります。</p>
<p>簡単な例として、フィールドのパスワードを確認するための新規フィールド型を作ってみましょう。 このフィールドは同じ属性の2つのテキスト入力ボックスがあり、値が一致しない場合にエラーメッセージを返します。 他のフィールドと違ってインプットタグに value 属性を設定しないことに注意してください。 なぜなら、HTML にユーザの入力したパスワードを再び表示したくないからです。</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="ot">passwordConfirmField ::</span> <span class="dt">Field</span> <span class="dt">Handler</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">passwordConfirmField <span class="fu">=</span> <span class="dt">Field</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3">    { fieldParse <span class="fu">=</span> \rawVals _fileVals <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">        <span class="kw">case</span> rawVals <span class="kw">of</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5">            [a, b]</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">                <span class="fu">|</span> a <span class="fu">==</span> b <span class="ot">-&gt;</span> return <span class="fu">$</span> <span class="dt">Right</span> <span class="fu">$</span> <span class="dt">Just</span> a</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">                <span class="fu">|</span> otherwise <span class="ot">-&gt;</span> return <span class="fu">$</span> <span class="dt">Left</span> <span class="st">&quot;Passwords don't match&quot;</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8">            [] <span class="ot">-&gt;</span> return <span class="fu">$</span> <span class="dt">Right</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9">            _ <span class="ot">-&gt;</span> return <span class="fu">$</span> <span class="dt">Left</span> <span class="st">&quot;You must enter two values&quot;</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10">    , fieldView <span class="fu">=</span> \idAttr nameAttr otherAttrs eResult isReq <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11">        [whamlet|</a>
<a class="sourceLine" id="cb17-12" data-line-number="12">            <span class="kw">&lt;input</span><span class="ot"> id=</span><span class="kw">#{</span>idAttr<span class="kw">}</span><span class="ot"> name=</span><span class="kw">#{</span>nameAttr<span class="kw">} </span><span class="er">*{otherAttrs}</span><span class="ot"> type=</span><span class="st">password</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13">            <span class="kw">&lt;div&gt;</span>Confirm:</a>
<a class="sourceLine" id="cb17-14" data-line-number="14">            <span class="kw">&lt;input</span><span class="ot"> id=</span><span class="kw">#{</span>idAttr<span class="kw">}</span><span class="er">-confirm</span><span class="ot"> name=</span><span class="kw">#{</span>nameAttr<span class="kw">} </span><span class="er">*{otherAttrs}</span><span class="ot"> type=</span><span class="st">password</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15">        |]</a>
<a class="sourceLine" id="cb17-16" data-line-number="16">    , fieldEnctype <span class="fu">=</span> <span class="dt">UrlEncoded</span></a>
<a class="sourceLine" id="cb17-17" data-line-number="17">    }</a>
<a class="sourceLine" id="cb17-18" data-line-number="18"></a>
<a class="sourceLine" id="cb17-19" data-line-number="19"><span class="ot">getHomeR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></a>
<a class="sourceLine" id="cb17-20" data-line-number="20">getHomeR <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb17-21" data-line-number="21">    ((res, widget), enctype) <span class="ot">&lt;-</span> runFormGet <span class="fu">$</span> renderDivs</a>
<a class="sourceLine" id="cb17-22" data-line-number="22">        <span class="fu">$</span> areq passwordConfirmField <span class="st">&quot;Password&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb17-23" data-line-number="23">    defaultLayout</a>
<a class="sourceLine" id="cb17-24" data-line-number="24">        [whamlet|</a>
<a class="sourceLine" id="cb17-25" data-line-number="25">            <span class="kw">&lt;p&gt;</span>Result: <span class="kw">#{</span>show res<span class="kw">}</span></a>
<a class="sourceLine" id="cb17-26" data-line-number="26">            <span class="kw">&lt;form</span><span class="ot"> enctype=</span><span class="kw">#{</span>enctype<span class="kw">}&gt;</span></a>
<a class="sourceLine" id="cb17-27" data-line-number="27">                <span class="kw">^{</span>widget<span class="kw">}</span></a>
<a class="sourceLine" id="cb17-28" data-line-number="28">                <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">submit</span><span class="ot"> value=</span><span class="st">&quot;Change password&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb17-29" data-line-number="29">        |]</a></code></pre></div>
<h2 id="values-that-dont-come-from-the-user">Values that don’t come from the user</h2>
<p>ブログホスティングウェブアプリケーションを書いていて、ユーザがブログ投稿を入力するためのフォームを作らなければならないとしましょう。 ブログ投稿は以下の4つの情報とします。</p>
<ul>
<li>タイトル</li>
<li>HTMLコンテンツ</li>
<li>著者のユーザID</li>
<li>公開日</li>
</ul>
<p>ユーザには始めの2つの値を入力してもらいたいですが、残り2つはそうではそうではありません。 ユーザ ID はユーザを認証すること (この話題についてはまだ触れていない) で自動的に決定されて欲しく、公開日は現在時刻となって欲しいです。 問題となるのはどのようにして単純なアプリカティブフォーム構文を保ちつつ、ユーザから入力されない情報を設定するかです。</p>
<p>答えとしては、2つの補助関数を利用することです。</p>
<ul>
<li><code>pure</code> を使えば、通常の値をアプリカティブフォームの値にラップできます</li>
<li><code>lift</code> を使えば、アプリカティブフォームで、任意の <code>Handler</code> アクションの実行が可能になります</li>
</ul>
<p>これら2つの関数を用いた例を見てみよう.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="ot">{-# LANGUAGE MultiParamTypeClasses #-}</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="ot">{-# LANGUAGE OverloadedStrings     #-}</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="ot">{-# LANGUAGE QuasiQuotes           #-}</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="ot">{-# LANGUAGE TemplateHaskell       #-}</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="ot">{-# LANGUAGE TypeFamilies          #-}</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="kw">import</span>           <span class="dt">Control.Applicative</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="kw">import</span>           <span class="dt">Data.Text</span>           (<span class="dt">Text</span>)</a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="kw">import</span>           <span class="dt">Data.Time</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="kw">import</span>           <span class="dt">Yesod</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">-- In the authentication chapter, we'll address this properly</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="kw">newtype</span> <span class="dt">UserId</span> <span class="fu">=</span> <span class="dt">UserId</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13">    <span class="kw">deriving</span> <span class="dt">Show</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="kw">data</span> <span class="dt">App</span> <span class="fu">=</span> <span class="dt">App</span></a>
<a class="sourceLine" id="cb18-16" data-line-number="16"></a>
<a class="sourceLine" id="cb18-17" data-line-number="17">mkYesod <span class="st">&quot;App&quot;</span> [parseRoutes|</a>
<a class="sourceLine" id="cb18-18" data-line-number="18">/ HomeR GET POST</a>
<a class="sourceLine" id="cb18-19" data-line-number="19">|]</a>
<a class="sourceLine" id="cb18-20" data-line-number="20"></a>
<a class="sourceLine" id="cb18-21" data-line-number="21"><span class="kw">instance</span> <span class="dt">Yesod</span> <span class="dt">App</span></a>
<a class="sourceLine" id="cb18-22" data-line-number="22"></a>
<a class="sourceLine" id="cb18-23" data-line-number="23"><span class="kw">instance</span> <span class="dt">RenderMessage</span> <span class="dt">App</span> <span class="dt">FormMessage</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb18-24" data-line-number="24">    renderMessage _ _ <span class="fu">=</span> defaultFormMessage</a>
<a class="sourceLine" id="cb18-25" data-line-number="25"></a>
<a class="sourceLine" id="cb18-26" data-line-number="26"><span class="kw">type</span> <span class="dt">Form</span> a <span class="fu">=</span> <span class="dt">Html</span> <span class="ot">-&gt;</span> <span class="dt">MForm</span> <span class="dt">Handler</span> (<span class="dt">FormResult</span> a, <span class="dt">Widget</span>)</a>
<a class="sourceLine" id="cb18-27" data-line-number="27"></a>
<a class="sourceLine" id="cb18-28" data-line-number="28"><span class="kw">data</span> <span class="dt">Blog</span> <span class="fu">=</span> <span class="dt">Blog</span></a>
<a class="sourceLine" id="cb18-29" data-line-number="29">    {<span class="ot"> blogTitle    ::</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb18-30" data-line-number="30">    ,<span class="ot"> blogContents ::</span> <span class="dt">Textarea</span></a>
<a class="sourceLine" id="cb18-31" data-line-number="31">    ,<span class="ot"> blogUser     ::</span> <span class="dt">UserId</span></a>
<a class="sourceLine" id="cb18-32" data-line-number="32">    ,<span class="ot"> blogPosted   ::</span> <span class="dt">UTCTime</span></a>
<a class="sourceLine" id="cb18-33" data-line-number="33">    }</a>
<a class="sourceLine" id="cb18-34" data-line-number="34">    <span class="kw">deriving</span> <span class="dt">Show</span></a>
<a class="sourceLine" id="cb18-35" data-line-number="35"></a>
<a class="sourceLine" id="cb18-36" data-line-number="36"><span class="ot">form ::</span> <span class="dt">UserId</span> <span class="ot">-&gt;</span> <span class="dt">Form</span> <span class="dt">Blog</span></a>
<a class="sourceLine" id="cb18-37" data-line-number="37">form userId <span class="fu">=</span> renderDivs <span class="fu">$</span> <span class="dt">Blog</span></a>
<a class="sourceLine" id="cb18-38" data-line-number="38">    <span class="fu">&lt;$&gt;</span> areq textField <span class="st">&quot;Title&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb18-39" data-line-number="39">    <span class="fu">&lt;*&gt;</span> areq textareaField <span class="st">&quot;Contents&quot;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb18-40" data-line-number="40">    <span class="fu">&lt;*&gt;</span> pure userId</a>
<a class="sourceLine" id="cb18-41" data-line-number="41">    <span class="fu">&lt;*&gt;</span> lift (liftIO getCurrentTime)</a>
<a class="sourceLine" id="cb18-42" data-line-number="42"></a>
<a class="sourceLine" id="cb18-43" data-line-number="43"><span class="ot">getHomeR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></a>
<a class="sourceLine" id="cb18-44" data-line-number="44">getHomeR <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb18-45" data-line-number="45">    <span class="kw">let</span> userId <span class="fu">=</span> <span class="dt">UserId</span> <span class="dv">5</span> <span class="co">-- again, see the authentication chapter</span></a>
<a class="sourceLine" id="cb18-46" data-line-number="46">    ((res, widget), enctype) <span class="ot">&lt;-</span> runFormPost <span class="fu">$</span> form userId</a>
<a class="sourceLine" id="cb18-47" data-line-number="47">    defaultLayout</a>
<a class="sourceLine" id="cb18-48" data-line-number="48">        [whamlet|</a>
<a class="sourceLine" id="cb18-49" data-line-number="49">            <span class="kw">&lt;p&gt;</span>Previous result: <span class="kw">#{</span>show res<span class="kw">}</span></a>
<a class="sourceLine" id="cb18-50" data-line-number="50">            <span class="kw">&lt;form</span><span class="ot"> method=</span><span class="st">post</span><span class="ot"> action=</span><span class="kw">@{</span><span class="dt">HomeR</span><span class="kw">}</span><span class="ot"> enctype=</span><span class="kw">#{</span>enctype<span class="kw">}&gt;</span></a>
<a class="sourceLine" id="cb18-51" data-line-number="51">                <span class="kw">^{</span>widget<span class="kw">}</span></a>
<a class="sourceLine" id="cb18-52" data-line-number="52">                <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">submit</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb18-53" data-line-number="53">        |]</a>
<a class="sourceLine" id="cb18-54" data-line-number="54"></a>
<a class="sourceLine" id="cb18-55" data-line-number="55"><span class="ot">postHomeR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></a>
<a class="sourceLine" id="cb18-56" data-line-number="56">postHomeR <span class="fu">=</span> getHomeR</a>
<a class="sourceLine" id="cb18-57" data-line-number="57"></a>
<a class="sourceLine" id="cb18-58" data-line-number="58"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb18-59" data-line-number="59">main <span class="fu">=</span> warp <span class="dv">3000</span> <span class="dt">App</span></a></code></pre></div>
<p>ここで紹介したトリックの1つは <code>GET</code> と <code>POST</code> リクエストメソッドで同じハンドラコードを利用することです。 これは <code>runFormPost</code> の実装が可能としています。 <code>runFormPost</code> は <code>GET</code> リクエストの場合に <code>generateFormPost</code> と全く同じように振る舞うからです。 両方のリクエストにおいて同じハンドラを利用することでボイラープレートを削減できmasu.</p>
<h2 id="summary">Summary</h2>
<p>Yesod におけるフォームは3つのグループに分けられる。 アプリカティブフォームは使いやすい API と共に素晴らしいユーザインターフェースを提供する。 そして最も一般的であるモナディックフォームはより強力ですが、使いづらいフォームです。 インプットフォームはユーザからのデータを処理するだけで、入力用のウィジットを生成したくない場合に便利です。</p>
<p>Yesod によリ提供される独創的なフィールドがたくさんあります。 これらをフォームで使うために、フォームの種類とフィールドが必須か任意かについて決める必要があり、全部で6つの補助関数 <code>areq</code>、<code>aopt</code>、<code>mreq</code>、<code>mopt</code>、<code>ireq</code>、<code>iopt</code> が用意されています。</p>
<p>フォームでは絶大な表現力が利用できます。 動的に Javascript を挿入することで jQuery UI デイトピッカーのような素晴らしいUIコントロールを利用できます。 また、フォームは完全に i18n に準拠するためグローバルユーザコミュニティをサポートできます。 さらに、より特別なニーズがある場合は存在するフィールドに対する検証関数を増強したり、ゼロから新しい関数を書くこともできます。</p>
      </article>

      <div class="pager">
      
      
      </div>

      <div class="row">
        <div class="col s6 offset-s6" style="position: relative; height: 100px;">
          <div class="fixed-action-btn horizontal" style="position: absolute; display: inline-block; right: 24px;">
  <a class="btn-floating btn-large red">
    <i class="large material-icons">share</i>
  </a>
  <ul>
    <li>
      <a class="btn-floating waves-effect waves-light blue tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Twitter" href="https://twitter.com/intent/tweet?text=Forms&url=https://haskell.e-bigmoon.com/yesod/book/ch08-forms.html"><i class="mdi mdi-twitter white-text"></i></a>
    </li>
    <li>
      <a class="btn-floating waves-effect waves-light indigo tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Facebook" href="https://facebook.com/sharer.php?u=https://haskell.e-bigmoon.com/yesod/book/ch08-forms.html"><i class="mdi mdi-facebook white-text"></i></a>
    </li>
    <li>
      <a class="btn-floating waves-effect waves-light red tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Google+" href="https://plus.google.com/share?url=https://haskell.e-bigmoon.com/yesod/book/ch08-forms.html"><i class="mdi mdi-google-plus white-text"></i></a>
    </li>
  </ul>
</div>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
    </div>

    <footer class="page-footer indigo lighten-1">

  <div class="footer-copyright">

    <div class="container">
      CopyRight © 2018 BIGMOON All Rights Reserved.&nbsp;
      Site proudly generated by <a class="red-text text-accent-1" href="http://jaspervdj.be/hakyll">Hakyll</a>,&nbsp;
      original Jekyll theme by <a class="red-text text-accent-1" href="https://github.com/mumuxme/materialize-jekyll">mumuxme</a>.
    </div>

  </div>

</footer>


    <!-- scrolltop button -->
    <button class="material-scrolltop waves-effect waves-light hide-on-small-only" type="button">
      <i class="mdi mdi-arrow-up-bold small white-text"></i>
    </button>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-19322672-9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-19322672-9');
    </script>

    <!-- jquery -->
    <script type="text/javascript" src="../../lib/jquery-min.js"></script>
    <!-- materialize -->
    <script src="../../lib/materialize/js/materialize.min.js"></script>
    <!-- <\!-- Material ScrollTop plugin -\-> -->
    <script src="../../lib/material-scrolltop/material-scrolltop.js"></script>
    <!-- main -->
    <script src="../../js/init.js"></script>
    <script src="../../js/main.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>

</html>
