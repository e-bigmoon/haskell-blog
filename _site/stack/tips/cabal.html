<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">

  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
  <!-- MUST in hex format, may the same as header-color. This color is for android chrome browser. -->
  <meta name="theme-color" content="#5c6bc0">

  <!-- Metadata. -->
  <meta name="keywords" content="haskell,blog,bigmoon" />
  <title>cabal コマンドとの対応表</title>
  <meta name="description" content="BIG MOON">
  <link rel="canonical" href="../../stack/tips/cabal.html">
  <link rel="alternate" type="application/atom+xml" title="cabal コマンドとの対応表" href="../../feed.xml" />
  <link rel="shortcut icon" href="../../images/favicon.ico" />
  <meta name="google-site-verification" content="X2YNboLvzw3_bclXLMvohyJDqj68D06_hPDMukRbgTs" />

  <!-- Stylesheets. -->
  <link rel="stylesheet" href="../../lib/materialize/css/materialize.min.css" />
  <link rel="stylesheet" href="../../css/main.css" />
  <link media="all" rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/3.3.92/css/materialdesignicons.min.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="../../lib/material-scrolltop/material-scrolltop.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />

  <!-- OGP -->
  <meta property="og:title" content="cabal コマンドとの対応表" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="/stack/tips/cabal.html" />
  <!-- <meta property="og:image" content=" サムネイル画像の URL" /> -->
  <meta property="og:site_name" content="cabal コマンドとの対応表" />
  <meta property="og:description" content="BIG MOON" />

  <meta name="twitter:card" content="summary" />
  <!-- <meta name="twitter:site" content="@[ Twitter ID]" /> -->
  <!-- <meta name="twitter:player" content="@[ Twitter ID]" /> -->

  <noscript>
  <div class="notice-warning noscript">You don't have javascript enabled. Good luck! :(</div>
</noscript>

<!--[if IE]>
  <div class="notice-warning">Oh, you are using Internet Explorer! Good luck... :(</div>
<![endif]-->

</head>


  <body>
    <header class="site-header">
      <nav class="nav-extended indigo lighten-1">
        <div class="nav-wrapper">
  <a href="../../"><span class="site-title">BIGMOON Haskeller's BLOG</span></a>
  <a href="#" data-activates="mobile-navbar" class="button-collapse">
    <i class="mdi mdi-menu white-text"></i>
  </a>

  <ul id="nav-mobile" class="right hide-on-med-and-down">
    <li>
      <a href="../../" class="white-text">
        <i class="mdi mdi-home left indigo-text text-lighten-3"></i>
        Home
      </a>
    </li>
    <li>
      <a href="../../about.html" class="white-text">
        <i class="mdi mdi-account-circle left indigo-text text-lighten-3"></i>
        About
      </a>
    </li>
    <li>
      <a href="../../stack/" class="white-text">
        <i class="mdi mdi-wrench left indigo-text text-lighten-3"></i>
        Development
      </a>
    </li>
    <li>
      <a href="../../quiz/index.html" class="white-text">
        <i class="mdi mdi-comment-question-outline left indigo-text text-lighten-3"></i>
        Quiz
      </a>
    </li>
    <li>
      <a href="../../libraries/" class="white-text">
        <i class="mdi mdi-package-variant left indigo-text text-lighten-3"></i>
        Libraries
      </a>
    </li>
    <li>
      <a href="../../yesod/" class="white-text">
        <i class="mdi mdi-earth left indigo-text text-lighten-3"></i>
        Yesod
      </a>
    </li>
    <li>
      <a href="../../contact.html" class="white-text">
        <i class="mdi mdi-lead-pencil left indigo-text text-lighten-3"></i>
        Contact
      </a>
    </li>
    <li>
      <a href="../../feed.xml" class="white-text">
        <i class="mdi mdi-rss left indigo-text text-lighten-3"></i>
        Feed
      </a>
    </li>
  </ul>

  <ul class="side-nav" id="mobile-navbar">
    <li>
      <a href="../../" class="waves-effect waves-teal black-text">
        <i class="mdi mdi-home left green-text"></i>
        Home
      </a>
    </li>
    <li>
      <a href="../../about.html" class="navbar-text-colour-mobile">
        <i class="mdi mdi-account-circle left blue-text"></i>
        About
      </a>
    </li>
    <li>
      <a href="../../stack/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-wrench left blue-text"></i>
        Development
      </a>
    </li>
    <li>
      <a href="../../quiz/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-comment-question-outline left blue-text"></i>
        Quiz
      </a>
    </li>
    <li>
      <a href="../../libraries/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-package-variant left blue-text"></i>
        Libraries
      </a>
    </li>
    <li>
      <a href="../../yesod/" class="navbar-text-colour-mobile">
        <i class="mdi mdi-earth left blue-text"></i>
        Yesod
      </a>
    </li>
    <li>
      <a href="../../contact.html" class="navbar-text-colour-mobile">
        <i class="mdi mdi-lead-pencil left blue-text"></i>
        Contact
      </a>
    </li>
  </ul>
</div>

      </nav>
    </header>

    <div class="site-container" id="tab-main">
      <div class="wrapper">
        <div class="post-ribbon"></div>

<div class="container page-container">
  <div class="post-page card-panel z-depth-2">
    <div class="post-section">
      <div class="post-heading">
        <h1 class="post-title">cabal コマンドとの対応表</h1>
        
        <span>最終更新日: 2019/11/25</span>
        
      </div>

      <article class="page-content">
        <h2 id="注意点">注意点</h2>
<p>このページの内容は <code>cabal HEAD</code> を追っているため、最新版の <code>cabal</code> ではまだ利用不可能な内容も含まれる場合があります。</p>
<h2 id="stack-と-cabal">stack と cabal</h2>
<pre class="shell"><code>$ stack --numeric-version
2.1.3

$ cabal --numeric-version
3.0.0.0</code></pre>
<table>
<thead>
<tr class="header">
<th>　</th>
<th>stack</th>
<th>cabal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ドキュメント</td>
<td><a href="https://docs.haskellstack.org/en/stable/README/">stack user guide</a></td>
<td><a href="https://www.haskell.org/cabal/users-guide/">Cabal User Guide</a></td>
</tr>
<tr class="even">
<td>repo</td>
<td><a href="https://github.com/commercialhaskell/stack/tree/stable">commercialhaskell/stack</a></td>
<td><a href="https://github.com/haskell/cabal">haskell/cabal</a></td>
</tr>
<tr class="odd">
<td>コマンド名</td>
<td>stack</td>
<td>cabal (正式には cabal-install と呼ばれているもの)</td>
</tr>
</tbody>
</table>
<h2 id="stack-と-cabal-の違い">stack と cabal の違い</h2>
<ul>
<li><code>extra-lib-dirs</code> や <code>extra-include-dirs</code> などで依存するライブラリが変化した時
<ul>
<li>stack: <code>~/.stack/snapshots/</code> 以下を手動で削除し、リビルドする必要がある</li>
<li>cabal: <code>nix-style</code> を採用しているため、リビルドするだけで良い</li>
</ul></li>
<li>パッケージをリビルドするタイミング
<ul>
<li>stack: <code>resolver</code> が変化した際に、パッケージを新たに全てリビルドする必要がある</li>
<li>cabal: <code>compiler</code> が変化した際に、パッケージを新たに全てリビルドする必要がある</li>
</ul></li>
</ul>
<h3 id="個人的な意見">個人的な意見</h3>
<ul>
<li>stack はエラーメッセージ等が初心者に優しい (ユーザフレンドリー)</li>
<li>cabal は stack よりも明らかにビルドが速い</li>
</ul>
<h2 id="v1-build-と-v2-build-コマンドの違い">v1-build と v2-build コマンドの違い</h2>
<ul>
<li><code>cabal v2-build</code> は <a href="https://cabal.readthedocs.io/en/latest/nix-local-build-overview.html">Nix-style Local Builds</a></li>
<li><code>cabal build</code> は <code>cabal v1-build</code> のエイリアス</li>
<li><code>cabal new-build</code> は <code>cabal v2-build</code> のエイリアス</li>
<li><code>cabal v3.0.0.0</code> からは <code>cabal v2-build</code> が <code>cabal build</code> のエイリアス (<a href="https://github.com/haskell/cabal/pull/5800">#5800</a>)</li>
</ul>
<table>
<thead>
<tr class="header">
<th>cabal version</th>
<th>cabal build</th>
<th>cabal new-build</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>v3.0.0.0</td>
<td>v2-build</td>
<td>v2-build</td>
</tr>
<tr class="even">
<td>v2.4.1.0</td>
<td><strong>v1</strong>-build</td>
<td>v2-build</td>
</tr>
</tbody>
</table>
<h2 id="コマンド対応表">コマンド対応表</h2>
<table>
<colgroup>
<col style="width: 28%" />
<col style="width: 38%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>stack</th>
<th>cabal</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>stack init</code></td>
<td><code>cabal init -n --is-executable</code> <br> <code>cabal init --simple</code> <br> <code>cabal init --lib</code> <br> <code>cabal init --exe</code> <br> <code>cabal init --libandexe</code></td>
<td><a href="https://github.com/haskell/cabal/pull/5707">#5707</a>, <a href="https://github.com/haskell/cabal/pull/5759">#5759</a>, <a href="https://github.com/haskell/cabal/pull/5864">#5864</a></td>
</tr>
<tr class="even">
<td><code>stack build</code></td>
<td><code>cabal build</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>stack test</code></td>
<td><code>cabal test</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>stack repl</code> <br> <code>stack ghci</code></td>
<td><code>cabal repl</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>stack repl --package &lt;pkg1&gt; &lt;pkg2&gt;</code></td>
<td><code>cabal repl --build-dep &lt;pkg1&gt;, &lt;pkg2&gt;</code> <br> <code>cabal repl -b &lt;pkg1&gt;, &lt;pkg2&gt;</code></td>
<td><a href="https://github.com/haskell/cabal/pull/5845">#5845</a></td>
</tr>
<tr class="even">
<td><code>stack clean</code></td>
<td><code>cabal clean</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>stack run</code></td>
<td><code>cabal run</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>stack --version</code></td>
<td><code>cabal --version</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>stack --numeric-version</code></td>
<td><code>cabal --numeric-version</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>stack upgrade</code></td>
<td><code>cabal install cabal-install</code></td>
<td>ghcup を使う</td>
</tr>
<tr class="odd">
<td>?</td>
<td><code>cabal haddock</code></td>
<td></td>
</tr>
<tr class="even">
<td>?</td>
<td><code>cabal sdist</code></td>
<td></td>
</tr>
<tr class="odd">
<td>?</td>
<td><code>cabal check</code></td>
<td></td>
</tr>
<tr class="even">
<td>?</td>
<td><code>cabal upload</code> <br> <code>cabal upload --publish</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>stack update</code></td>
<td><code>cabal update</code></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="オプション対応表">オプション対応表</h3>
<table>
<thead>
<tr class="header">
<th>stack</th>
<th>cabal</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>local-bin-path</code></td>
<td><code>installdir</code></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="どちらか一方にしかないコマンドやオプション">どちらか一方にしかないコマンドやオプション</h3>
<table>
<thead>
<tr class="header">
<th>stack</th>
<th>cabal</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>stack build --file-watch</code></td>
<td><a href="https://github.com/haskell/cabal/issues/5252">#5252</a></td>
<td></td>
</tr>
<tr class="even">
<td>-</td>
<td><code>cabal format</code></td>
<td><a href="https://github.com/haskell/cabal/issues/2460">#2460</a>, <a href="https://github.com/haskell/cabal/issues/5306">#5306</a>, <a href="https://github.com/haskell/cabal/issues/5734">#5734</a>, <a href="https://haskell.e-bigmoon.com/posts/2019/10-07-cabal-fmt.html">cabal-fmt の紹介</a></td>
</tr>
<tr class="odd">
<td><code>stack path</code></td>
<td><a href="https://github.com/haskell/cabal/issues/3850">#3850</a>, <a href="https://github.com/haskell/cabal/issues/4661">#4661</a></td>
<td></td>
</tr>
<tr class="even">
<td><code>stack setup</code></td>
<td>_</td>
<td><a href="https://github.com/haskell/ghcup">ghcup</a> を利用する</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/commercialhaskell/stack/issues/3420">#3420</a></td>
<td><code>cabal build --enable-executable-static</code></td>
<td><a href="https://github.com/haskell/cabal/pull/5446">#5446</a></td>
</tr>
<tr class="even">
<td>-</td>
<td><code>-w</code> オプション。<code>cabal repl -w ghc-8.6.5</code></td>
<td>コンパイラを指定できる</td>
</tr>
</tbody>
</table>
<h2 id="設定ファイル等のパス対応表-初期値">設定ファイル等のパス対応表 (初期値)</h2>
<table>
<thead>
<tr class="header">
<th>stack</th>
<th>cabal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>~/.stack/</code></td>
<td><code>~/.cabal/</code></td>
</tr>
<tr class="even">
<td><code>~/.local/bin</code></td>
<td><code>~/.cabal/bin</code></td>
</tr>
<tr class="odd">
<td>?</td>
<td><code>~/.cabal/store</code></td>
</tr>
<tr class="even">
<td><code>~/.stack/config.yaml</code>, <code>~/.stack/global-project/stack.yaml</code></td>
<td><code>~/.cabal/config</code></td>
</tr>
</tbody>
</table>
<h2 id="tips">Tips</h2>
<h3 id="install-コマンドの挙動">install コマンドの挙動</h3>
<p>例えば、<code>cabal.project</code>が以下のようなパッケージ構成になっていて、<code>executable</code> (mainExe1, mainExe2, subExe1, subExe2) が定義されているとする。</p>
<pre><code>packages:
  ./              -- name: app,  executable: mainExe1, executable: mainExe2
  ./subs/pkg1     -- name: pkg1, executable: subExe1
  ./subs/pkg2     -- name: pkg2, executable: subExe2</code></pre>
<h4 id="stack">stack</h4>
<table>
<thead>
<tr class="header">
<th>コマンド</th>
<th>インストールされるもの</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>stack install</code></td>
<td><code>mainExe1</code>, <code>mainExe2</code>, <code>subExe1</code>, <code>subExe2</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>stack install .</code></td>
<td><code>mainExe1</code>, <code>mainExe2</code>, <code>subExe1</code>, <code>subExe2</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>stack install app</code></td>
<td><code>mainExe1</code>, <code>mainExe2</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>stack install pkg1</code></td>
<td><code>subExe1</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>stack install pkg2</code></td>
<td><code>subExe2</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>stack install . pkg1 pkg2</code></td>
<td>-</td>
<td>パーズエラーで実行できない</td>
</tr>
<tr class="odd">
<td><code>stack install app pkg1 pkg2</code></td>
<td><code>mainExe1</code>, <code>mainExe2</code>, <code>subExe1</code>, <code>subExe2</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>stack install all</code></td>
<td>-</td>
<td><code>Unknown package: all</code> となる。</td>
</tr>
</tbody>
</table>
<h4 id="cabal">cabal</h4>
<table>
<colgroup>
<col style="width: 21%" />
<col style="width: 54%" />
<col style="width: 24%" />
</colgroup>
<thead>
<tr class="header">
<th>コマンド</th>
<th>インストールされるもの</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>cabal install</code></td>
<td><code>mainExe1</code>, <code>mainExe2</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>cabal install .</code></td>
<td><code>mainExe1</code>, <code>mainExe2</code></td>
<td><code>cabal install</code> と同じ</td>
</tr>
<tr class="odd">
<td><code>cabal install app</code></td>
<td><code>mainExe1</code>, <code>mainExe2</code></td>
<td><code>cabal install</code> と同じ</td>
</tr>
<tr class="even">
<td><code>cabal install pkg1</code></td>
<td><code>subExe1</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>cabal install pkg2</code></td>
<td><code>subExe2</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>cabal install . pkg1 pkg2</code></td>
<td><code>mainExe1</code>, <code>mainExe2</code>, <code>subExe1</code>, <code>subExe2</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>cabal install app pkg1 pkg2</code></td>
<td><code>mainExe1</code>, <code>mainExe2</code>, <code>subExe1</code>, <code>subExe2</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>cabal install all</code></td>
<td><code>mainExe1</code>, <code>mainExe2</code>, <code>subExe1</code>, <code>subExe2</code></td>
<td>全てのパッケージに <code>executable</code> が含まれている場合に限り実行可能</td>
</tr>
<tr class="odd">
<td><code>cabal install exes</code></td>
<td><code>mainExe1</code>, <code>mainExe2</code></td>
<td></td>
</tr>
<tr class="even">
<td><code>cabal install all:exes</code></td>
<td><code>mainExe1</code>, <code>mainExe2</code>, <code>subExe1</code>, <code>subExe2</code></td>
<td><code>stack install</code> に相当するコマンド</td>
</tr>
</tbody>
</table>
<ul>
<li><code>cabal install all</code> で <code>executable</code> が含まれていないパッケージがある場合は以下のエラーが出る</li>
</ul>
<pre><code>cabal: Cannot build the executables in the package pkg2 because it does not
contain any executables. Check the .cabal file for the package and make sure
that it properly declares the components that you expect.</code></pre>
<table>
<thead>
<tr class="header">
<th>オプション</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>--install-method=copy</code></td>
<td>シンボリックリンクではなく、実体がコピーされる。Docker にバイナリをコピーする際などで利用することがある。</td>
</tr>
<tr class="even">
<td><code>--overwrite-policy=always</code></td>
<td>すでにファイルが存在する場合でも、常に上書きする</td>
</tr>
</tbody>
</table>
<p><code>--overwrite-policy=always</code> を毎回指定するのが面倒な場合は <code>cabal user-config update -a overwrite-policy:always</code> とすることで <code>~/.cabal/config</code> に設定できる。</p>
<h3 id="コマンドの自動補完">コマンドの自動補完</h3>
<h4 id="stack-1">stack</h4>
<ul>
<li><a href="https://docs.haskellstack.org/en/stable/shell_autocompletion/#shell-auto-completion">Shell Auto-completion</a></li>
</ul>
<pre class="shell"><code>$ echo 'eval &quot;$(stack --bash-completion-script stack)&quot;' &gt;&gt; ~/.bashrc</code></pre>
<h4 id="cabal-1">cabal</h4>
<ul>
<li><a href="https://github.com/haskell/cabal/blob/master/cabal-install/bash-completion/cabal">bash-completion script</a></li>
</ul>
<pre class="shell"><code>$ curl https://raw.githubusercontent.com/haskell/cabal/master/cabal-install/bash-completion/cabal -O
$ sudo mv cabal /usr/share/bash-completion/completions/</code></pre>
<h3 id="マルチパッケージプロジェクト">マルチパッケージプロジェクト</h3>
<h4 id="stack-2">stack</h4>
<pre class="shell"><code># stack.yaml
packages:
- .
- ./package1
- ./package2
- ./package3</code></pre>
<p>実行方法</p>
<pre class="shell"><code># 全てのパッケージ
$ stack build
$ stack repl

# 個別のパッケージ
$ stack build package1
$ stack repl package1</code></pre>
<h4 id="cabal-2">cabal</h4>
<pre class="shell"><code>-- cabal.project
packages:
  ./
  package1
  package2
  package3</code></pre>
<p>実行方法</p>
<pre class="shell"><code># 全てのパッケージ
$ cabal build all
$ cabal repl

# 個別のパッケージ
$ cabal build package1
$ cabal repl basic</code></pre>
<h3 id="リモートリポジトリ">リモートリポジトリ</h3>
<h4 id="stack-3">stack</h4>
<ul>
<li><a href="https://docs.haskellstack.org/en/stable/yaml_configuration/#git-and-mercurial-repos">Git and Mercurial repos</a></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># stack.yaml</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">extra-deps</span><span class="kw">:</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="kw">-</span><span class="at"> </span><span class="fu">github</span><span class="kw">:</span><span class="at"> fumieval/extensible</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="at">  </span><span class="fu">commit</span><span class="kw">:</span><span class="at"> 81ccac73f7480ea66e6008e660972bfee9e83976</span></span></code></pre></div>
<p>複数パッケージになっている場合は <code>subdirs</code> を指定する</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># stack.yaml</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">extra-deps</span><span class="kw">:</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="kw">-</span><span class="at"> </span><span class="fu">github</span><span class="kw">:</span><span class="at"> gtk2hs/gtk2hs</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="at">  </span><span class="fu">commit</span><span class="kw">:</span><span class="at"> 7bccd432e2f962d80b2b804fa2a59712e402753c</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="at">  </span><span class="fu">subdirs</span><span class="kw">:</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cairo</span></span></code></pre></div>
<p>複数のパッケージを指定する場合は <code>subdirs</code> に追加するだけで良い。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># stack.yaml</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">extra-deps</span><span class="kw">:</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="kw">-</span><span class="at"> </span><span class="fu">github</span><span class="kw">:</span><span class="at"> gtk2hs/gtk2hs</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="at">  </span><span class="fu">commit</span><span class="kw">:</span><span class="at"> 7bccd432e2f962d80b2b804fa2a59712e402753c</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="at">  </span><span class="fu">subdirs</span><span class="kw">:</span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cairo</span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="at">  </span><span class="kw">-</span><span class="at"> gtk</span></span></code></pre></div>
<h4 id="cabal-3">cabal</h4>
<ul>
<li><a href="https://cabal.readthedocs.io/en/latest/nix-local-build.html#specifying-packages-from-remote-version-control-locations">Specifying Packages from Remote Version Control Locations</a></li>
<li>リポジトリに <code>cabal</code> ファイルが含まれていない場合は <code>NoCabalFileFound</code> となる。リポジトリに含めるしかない。
<ul>
<li><a href="https://github.com/haskell/cabal/issues/5785">Specifying remote Git repositories without .cabal file? #5785</a></li>
</ul></li>
</ul>
<pre class="cabal"><code># cabal.project
source-repository-package
  type: git
  location: https://github.com/fumieval/extensible
  tag: 81ccac73f7480ea66e6008e660972bfee9e83976</code></pre>
<p>リポジトリにパッケージが複数含まれる場合は <code>subdir</code> を指定する</p>
<pre class="cabal"><code># cabal.project
source-repository-package
  type: git
  location: https://github.com/gtk2hs/gtk2hs
  tag: 7bccd432e2f962d80b2b804fa2a59712e402753c
  subdir: cairo</code></pre>
<p>複数のパッケージを指定する場合、<code>cabal-3.1.0.0</code> からは以下のように <code>subdir</code> に複数のパッケージを並べて書けるようになった。</p>
<pre class="cabal"><code># cabal.project
source-repository-package
  type: git
  location: https://github.com/gtk2hs/gtk2hs
  tag: 7bccd432e2f962d80b2b804fa2a59712e402753c
  subdir: cairo gtk</code></pre>
<p><code>cabal-3.0.0.0</code>以前は<code>stack</code> の <code>subdirs</code> のような書き方はできないため、<code>source-repository-package</code> を複数記述しなければならない。(<a href="https://github.com/haskell/cabal/issues/5472">#5472</a>)</p>
<pre class="cabal"><code># cabal.project
source-repository-package
  type: git
  location: https://github.com/gtk2hs/gtk2hs
  tag: 7bccd432e2f962d80b2b804fa2a59712e402753c
  subdir: cairo
  
source-repository-package
  type: git
  location: https://github.com/gtk2hs/gtk2hs
  tag: 7bccd432e2f962d80b2b804fa2a59712e402753c
  subdir: gtk</code></pre>
<h3 id="プロファイリング">プロファイリング</h3>
<h4 id="stack-4">stack</h4>
<pre class="shell"><code>$ stack build --profile</code></pre>
<h4 id="cabal-4">cabal</h4>
<pre><code>profiling: True</code></pre>
<p><code>cabal.project.local</code> に上記の内容を追加し、<code>cabal build</code> すれば良い。</p>
<ul>
<li><a href="https://cabal.readthedocs.io/en/latest/nix-local-build.html#how-can-i-profile-my-library-application">How can I profile my library/application?</a></li>
</ul>
<h3 id="プロジェクトで利用する-ghc-を強制する方法">プロジェクトで利用する ghc を強制する方法</h3>
<h4 id="cabal-5">cabal</h4>
<p><code>cabal.project</code> に <code>with-compiler</code> を追記する</p>
<pre><code>with-compiler: ghc-8.6.2</code></pre>
<h3 id="build-depends-で利用するバージョン制約の指定方法">build-depends で利用するバージョン制約の指定方法</h3>
<ul>
<li><a href="https://cabal-version-calculator.netlify.com/">Cabal Version Calculator</a></li>
<li><a href="https://www.haskell.org/cabal/users-guide/developing-packages.html#build-information">3.3.2.9. Build information</a></li>
</ul>
<table>
<thead>
<tr class="header">
<th>利用可能な演算子</th>
<th>記号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>比較演算子</td>
<td><code>==</code>, <code>&gt;=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>^&gt;=</code></td>
</tr>
<tr class="even">
<td>条件演算子</td>
<td><code>&amp;&amp;</code>, <code>\|\|</code></td>
</tr>
</tbody>
</table>
<h4 id="良くある指定方法">良くある指定方法</h4>
<pre class="cabal"><code>pkgname &gt;= n
pkgname ^&gt;= n
pkgname &gt;= n &amp;&amp; &lt; m
pkgname == n.*</code></pre>
<h4 id="省略形">省略形</h4>
<table>
<thead>
<tr class="header">
<th>省略形</th>
<th>展開後</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>foo == 4.*</code></td>
<td><code>foo &gt;= 4 &amp;&amp; &lt; 5</code></td>
</tr>
<tr class="even">
<td><code>foo == 1.2.*</code></td>
<td><code>foo &gt;= 1.2 &amp;&amp; &lt; 1.3</code></td>
</tr>
<tr class="odd">
<td><code>foo ^&gt;= x</code></td>
<td><code>foo &gt;= x &amp;&amp; &lt; x.1</code></td>
</tr>
<tr class="even">
<td><code>foo ^&gt;= x.y</code></td>
<td><code>foo &gt;= x.y &amp;&amp; &lt; x.(y+1)</code></td>
</tr>
<tr class="odd">
<td><code>foo ^&gt;= x.y.z</code></td>
<td><code>foo &gt;= x.y.z &amp;&amp; &lt; x.(y+1)</code></td>
</tr>
<tr class="even">
<td><code>foo ^&gt;= x.y.z.u</code></td>
<td><code>foo &gt;= x.y.z.u &amp;&amp; &lt; x.(y+1)</code></td>
</tr>
</tbody>
</table>
<h4 id="備考">備考</h4>
<ul>
<li>ワイルドカードは <code>Cabal 1.6</code> から利用可能</li>
<li><code>^&gt;=</code> は <code>Cabal 2.0</code> から利用可能 (キャレット)</li>
<li><code>foo == 1.0.*</code> は <code>foo-1</code> にはマッチしないので注意 (<code>^&gt;=</code> の利用を推奨)</li>
</ul>
<h3 id="集合記法">集合記法</h3>
<ul>
<li>Cabal 3.0 から使える</li>
<li><code>==</code> と <code>^&gt;=</code> 演算子が対応している</li>
<li><a href="https://github.com/haskell/cabal/pull/5906">caret operator accepts a set of versions #5906</a></li>
</ul>
<pre><code>tested-with: GHC == 8.6.3, GHC == 8.4.4, GHC == 8.2.2, GHC == 8.0.2,
             GHC == 7.10.3, GHC == 7.8.4, GHC == 7.6.3, GHC == 7.4.2

build-depends: network ^&gt;= 2.6.3.6 || ^&gt;= 2.7.0.2 || ^&gt;= 2.8.0.0 || ^&gt;= 3.0.1.0</code></pre>
<p>こんな感じで書き直せる</p>
<pre><code>tested-with: GHC == { 8.6.3, 8.4.4, 8.2.2, 8.0.2, 7.10.3, 7.8.4, 7.6.3, 7.4.2 }

build-depends: network ^&gt;= { 2.6.3.6, 2.7.0.2, 2.8.0.0, 3.0.1.0 }</code></pre>
<h3 id="cabal.project.local-の設定">cabal.project.local の設定</h3>
<pre class="shell"><code>$ cabal configure -j</code></pre>
<h3 id="スクリプト形式">スクリプト形式</h3>
<h4 id="stack-5">stack</h4>
<ul>
<li><a href="https://haskell.e-bigmoon.com/stack/tips/script-interpreter.html">script interpreter + stack script でスクリプティング！</a></li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb24-1"><a href="#cb24-1"></a><span class="pp">#!/usr/bin/env stack</span></span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="ot">{-# LANGUAGE OverloadedStrings     #-}</span></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="ot">{-# LANGUAGE QuasiQuotes           #-}</span></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="ot">{-# LANGUAGE TemplateHaskell       #-}</span></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="ot">{-# LANGUAGE TypeFamilies          #-}</span></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="kw">import</span>           <span class="dt">Yesod</span></span>
<span id="cb24-8"><a href="#cb24-8"></a></span>
<span id="cb24-9"><a href="#cb24-9"></a><span class="kw">data</span> <span class="dt">HelloWorld</span> <span class="ot">=</span> <span class="dt">HelloWorld</span></span>
<span id="cb24-10"><a href="#cb24-10"></a></span>
<span id="cb24-11"><a href="#cb24-11"></a>mkYesod <span class="st">&quot;HelloWorld&quot;</span> [parseRoutes|</span>
<span id="cb24-12"><a href="#cb24-12"></a>/ HomeR GET</span>
<span id="cb24-13"><a href="#cb24-13"></a>|]</span>
<span id="cb24-14"><a href="#cb24-14"></a></span>
<span id="cb24-15"><a href="#cb24-15"></a><span class="kw">instance</span> <span class="dt">Yesod</span> <span class="dt">HelloWorld</span></span>
<span id="cb24-16"><a href="#cb24-16"></a></span>
<span id="cb24-17"><a href="#cb24-17"></a><span class="ot">getHomeR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></span>
<span id="cb24-18"><a href="#cb24-18"></a>getHomeR <span class="ot">=</span> defaultLayout [whamlet|Hello World!|]</span>
<span id="cb24-19"><a href="#cb24-19"></a></span>
<span id="cb24-20"><a href="#cb24-20"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb24-21"><a href="#cb24-21"></a>main <span class="ot">=</span> warp <span class="dv">3000</span> <span class="dt">HelloWorld</span></span></code></pre></div>
<p>実行方法</p>
<pre class="shell"><code>$ stack script --resolver lts-13.1 Script.hs</code></pre>
<h4 id="cabal-6">cabal</h4>
<ul>
<li><a href="https://www.haskell.org/cabal/users-guide/nix-local-build.html#cabal-new-run">5.4.5. cabal new-run</a></li>
<li><a href="https://github.com/haskell/cabal/issues/3843">RFC: Add support for "#! /usr/bin/env cabal #3843</a></li>
<li><a href="https://github.com/haskell/cabal/pull/5483">Add cabal scripting support #5483</a></li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb26-1"><a href="#cb26-1"></a><span class="pp">#!/usr/bin/env cabal</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="co">{- cabal:</span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="co">build-depends: base   ^&gt;= 4.12</span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="co">             , yesod  ^&gt;= 1.6.0</span></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="co">-}</span></span>
<span id="cb26-6"><a href="#cb26-6"></a></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="ot">{-# LANGUAGE OverloadedStrings     #-}</span></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="ot">{-# LANGUAGE QuasiQuotes           #-}</span></span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="ot">{-# LANGUAGE TemplateHaskell       #-}</span></span>
<span id="cb26-10"><a href="#cb26-10"></a><span class="ot">{-# LANGUAGE TypeFamilies          #-}</span></span>
<span id="cb26-11"><a href="#cb26-11"></a><span class="kw">import</span>           <span class="dt">Yesod</span></span>
<span id="cb26-12"><a href="#cb26-12"></a></span>
<span id="cb26-13"><a href="#cb26-13"></a><span class="kw">data</span> <span class="dt">HelloWorld</span> <span class="ot">=</span> <span class="dt">HelloWorld</span></span>
<span id="cb26-14"><a href="#cb26-14"></a></span>
<span id="cb26-15"><a href="#cb26-15"></a>mkYesod <span class="st">&quot;HelloWorld&quot;</span> [parseRoutes|</span>
<span id="cb26-16"><a href="#cb26-16"></a>/ HomeR GET</span>
<span id="cb26-17"><a href="#cb26-17"></a>|]</span>
<span id="cb26-18"><a href="#cb26-18"></a></span>
<span id="cb26-19"><a href="#cb26-19"></a><span class="kw">instance</span> <span class="dt">Yesod</span> <span class="dt">HelloWorld</span></span>
<span id="cb26-20"><a href="#cb26-20"></a></span>
<span id="cb26-21"><a href="#cb26-21"></a><span class="ot">getHomeR ::</span> <span class="dt">Handler</span> <span class="dt">Html</span></span>
<span id="cb26-22"><a href="#cb26-22"></a>getHomeR <span class="ot">=</span> defaultLayout [whamlet|Hello World!|]</span>
<span id="cb26-23"><a href="#cb26-23"></a></span>
<span id="cb26-24"><a href="#cb26-24"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb26-25"><a href="#cb26-25"></a>main <span class="ot">=</span> warp <span class="dv">3000</span> <span class="dt">HelloWorld</span></span></code></pre></div>
<p>実行方法</p>
<pre class="shell"><code>$ cabal run Script.hs
$ cabal run Script.hs -- --arg1 # 引数有り</code></pre>
<h2 id="便利ツール">便利ツール</h2>
<ul>
<li><a href="http://hackage.haskell.org/package/cabal-plan">cabal-plan list-bins</a></li>
<li><a href="https://hackage.haskell.org/package/cabal-fmt">cabal-fmt</a></li>
<li>cabal-env
<ul>
<li><a href="https://github.com/phadej/cabal-env">phadej/cabal-env</a></li>
<li><a href="https://github.com/hvr/cabal-env">hvr/cabal-env</a></li>
</ul></li>
</ul>
<h2 id="参考">参考</h2>
<ul>
<li><a href="http://blog.ezyang.com/2016/05/announcing-cabal-new-build-nix-style-local-builds/">Announcing cabal new-build: Nix-style local builds</a></li>
<li><a href="https://haskell-at-work.com/episodes/2018-05-13-introduction-to-cabal.html">Introduction to Cabal</a></li>
</ul>
      </article>

      <div class="pager">
      
      
      </div>

      <div class="row">
        <div class="col s6 offset-s6" style="position: relative; height: 100px;">
          <div class="fixed-action-btn horizontal" style="position: absolute; display: inline-block; right: 24px;">
  <a class="btn-floating btn-large red">
    <i class="large material-icons">share</i>
  </a>
  <ul>
    <li>
      <a class="btn-floating waves-effect waves-light blue tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Twitter" href="https://twitter.com/intent/tweet?text=cabal コマンドとの対応表&url=https://haskell.e-bigmoon.com/stack/tips/cabal.html"><i class="mdi mdi-twitter white-text"></i></a>
    </li>
    <li>
      <a class="btn-floating waves-effect waves-light indigo tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Facebook" href="https://facebook.com/sharer.php?u=https://haskell.e-bigmoon.com/stack/tips/cabal.html"><i class="mdi mdi-facebook white-text"></i></a>
    </li>
    <li>
      <a class="btn-floating waves-effect waves-light red tooltipped" data-position="bottom" data-delay="20" data-tooltip="Share on Google+" href="https://plus.google.com/share?url=https://haskell.e-bigmoon.com/stack/tips/cabal.html"><i class="mdi mdi-google-plus white-text"></i></a>
    </li>
  </ul>
</div>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
    </div>

    <footer class="page-footer indigo lighten-1">

  <div class="footer-copyright">

    <div class="container">
      © 2017-2019 BIGMOON&nbsp;
      Site proudly generated by <a class="red-text text-accent-1" href="http://jaspervdj.be/hakyll">Hakyll</a>,&nbsp;
      original Jekyll theme by <a class="red-text text-accent-1" href="https://github.com/mumuxme/materialize-jekyll">mumuxme</a>.
    </div>

  </div>

</footer>


    <!-- scrolltop button -->
    <button class="material-scrolltop waves-effect waves-light hide-on-small-only" type="button">
      <i class="mdi mdi-arrow-up-bold small white-text"></i>
    </button>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-19322672-9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-19322672-9');
    </script>

    <!-- jquery -->
    <script type="text/javascript" src="../../lib/jquery-min.js"></script>
    <!-- materialize -->
    <script src="../../lib/materialize/js/materialize.min.js"></script>
    <!-- <\!-- Material ScrollTop plugin -\-> -->
    <script src="../../lib/material-scrolltop/material-scrolltop.js"></script>
    <!-- main -->
    <script src="../../js/init.js"></script>
    <script src="../../js/main.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>

</html>
